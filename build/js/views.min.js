homeView = function(e, t) {
    this.container = e, this.dispatcher = void 0 !== t ? t : new Dispatcher, this.device = Detectizr.device.type, this.sections = ["home", "story", "castncrew", "gallery", "videos", "tickets"]
}, homeView.prototype = {
    constructor: homeView,
    init: function() {
        this.dispatcher.dispatch("ANALYTICS", {
            hitType: "pageview",
            page: "www.mylink"
        }), this.dispatcher.dispatch("ANALYTICS", {
            hitType: "event",
            eventCategory: "Videos",
            eventAction: "play",
            eventLabel: "Fall Campaign"
        }), this.addYoutubeVideo(), "mobile" != Detectizr.device.type ? this.initPreload() : (this.initPreloadMobile(), $("#splash").show(), $("body").removeClass("noscroll"), 
        document.getElementById("splash_trailer").addEventListener("click", function() {
            app.dispatcher.dispatch("SHOW_TRAILER")
        }),
        document.getElementById("splash_trailer2").addEventListener("click", function() {
            app.dispatcher.dispatch("SHOW_TRAILER")
        }),
        document.getElementById("splash_trailer3").addEventListener("click", function() {
            app.dispatcher.dispatch("SHOW_TRAILER")
        }),
        document.getElementById("splash_trailer4").addEventListener("click", function() {
            app.dispatcher.dispatch("SHOW_TRAILER")
        })),
        "desktop" !== app.device && "safari" == app.browser && this.onIOSdevice(app.device)
    },
    onSplashHide: function() {
        document.removeEventListener("touchmove", app.onScroll, !1), $("#splash").hide(), this.initPreload(), $("body").removeClass("noscroll")
    },
    onLoadComplete: function() {
       this.populate(), window.scrollTo(0, 0)
    },
    onIntroComplete: function() {
        app.preloader.startLoad()
    },

    preventScroll: function(e) {
        e.preventDefault(), e.stopPropagation()
    },
    populate: function() {
        for (i = 0; i < data.home.tout.length; i++) $("#touts").append('<li class="tout" id="tout' + (i + 1) + '"><a href="' + data.home.tout[i].link + '" target="_blank"> <div class="tout_border"></div> <img src="' + data.home.tout[i].img + '" />  <div class="tout_inner"><h1>' + data.home.tout[i].label + "</h1></div></a></li>");

        TweenMax.delayedCall(1, this.homeAnimate.bind(this)), this.bindEvents()
    },
    homeAnimate: function() {
        document.getElementById("tout_video").play();
        var e = new TimelineMax;
        e.set($("#btn_scroll_outer"), {
            transformOrign: "50% 50%"
        }).set($("#btn_scroll_middle"), {
            transformOrign: "50% 50%"
        }).set($("#btn_scroll_inner"), {
            transformOrign: "50% 50%"
        }).fromTo($("#btn_scroll_outer"), .5, {
            scale: 0
        }, {
            scale: 1,
            ease: Back.easeOut.config(2)
        }, "grp").fromTo($("#btn_scroll_middle"), .35, {
            scale: 0
        }, {
            scale: 1,
            delay: .1,
            ease: Back.easeOut.config(2)
        }, "grp").fromTo($("#btn_scroll_inner"), .25, {
            scale: 0
        }, {
            scale: 1,
            delay: .3,
            ease: Circ.easeOut
        }, "grp").fromTo($("#btn_scroll_text"), .25, {
            y: 20,
            opacity: 0
        }, {
            y: 10,
            opacity: 1,
            delay: .5,
            ease: Power2.easeOut,
            onComplete: function() {
            
                $("#btn_scroll").mouseenter(function() {
                    TweenMax.fromTo($("#btn_scroll_text"), .5, {
                        y: 10
                    }, {
                        y: 5,
                        ease: Circ.easeInOut
                    }), TweenMax.to($("#btn_scroll_divider"), .25, {
                        clip: "rect(0px, 10px, 1px, 0px)",
                        delay: .1,
                        ease: Circ.easeInOut
                    }), TweenMax.to($("#btn_scroll_outer"), .35, {
                        scale: 1.1,
                        delay: .05,
                        ease: Power2.easeInOut
                    }), TweenMax.to($("#btn_scroll_middle"), .25, {
                        scale: 1.05,
                        opacity: .9,
                        ease: Power2.easeInOut
                    }), TweenMax.to($("#btn_scroll_inner"), .25, {
                        scale: 1.1,
                        ease: Power2.easeInOut
                    })
                }).mouseleave(function() {
                    TweenMax.to($("#btn_scroll_divider"), .25, {
                        clip: "rect(0px, 5px, 1px, 5px)",
                        ease: Circ.easeInOut
                    }), TweenMax.fromTo($("#btn_scroll_text"), .25, {
                        y: 5
                    }, {
                        y: 10,
                        delay: .1,
                        ease: Circ.easeInOut
                    }), TweenMax.to($("#btn_scroll_outer"), .5, {
                        scale: 1,
                        ease: Power2.easeInOut
                    }), TweenMax.to($("#btn_scroll_middle"), .35, {
                        scale: 1,
                        opacity: .75,
                        delay: .1,
                        ease: Power2.easeInOut
                    }), TweenMax.to($("#btn_scroll_inner"), .35, {
                        scale: 1,
                        delay: .15,
                        ease: Power2.easeInOut
                    })
                }), document.getElementById("btn_scroll").addEventListener("click", function() {
                    TweenMax.to($("body"), 1, {
                        scrollTo: {
                            y: window.innerHeight * 1.1
                        },
                        ease: Power4.easeInOut
                    })
                }.bind(this))
            }.bind(this)
        }, "grp");
        var t = new TimelineMax({
            delay: 2,
            repeat: -1
        });
        t.staggerFromTo($("#btn_scroll_arrows img"), .15, {
            y: -3,
            opacity: 0
        }, {
            y: 0,
            opacity: 1,
            ease: Power3.easeOut
        }, .05).staggerFromTo($("#btn_scroll_arrows img"), .15, {
            y: 0,
            opacity: 1
        }, {
            y: 3,
            opacity: 0,
            delay: 1.5,
            ease: Power3.easeOut
        }, .05);
        var s = new TimelineMax({
            repeat: -1
        });
        
    },
    initPreload: function() {
        app.preloader = new AssetManager(settings.initialManifest, app.dispatcher), this.dispatcher.addEventlistener("AM_COMPLETE_G", this.onLoadComplete.bind(this)), this.dispatcher.addEventlistener("INTRO_DONE_EVENT", this.onIntroComplete.bind(this)), this.preloadView = new PreloadView(app.dispatcher), this.preloadView.intro()
    },
    initPreloadMobile: function() {
           app.preloader = new AssetManager(settingsmobile.initialManifest, app.dispatcher), this.dispatcher.addEventlistener("AM_COMPLETE_G", this.onLoadComplete.bind(this)), this.dispatcher.addEventlistener("INTRO_DONE_EVENT", this.onIntroComplete.bind(this)), this.preloadView = new PreloadView(app.dispatcher), this.preloadView.intro()
    },
    bindEvents: function() {
        for (i = 0; i < this.sections.length; i++) TweenMax.set($("#nav-" + this.sections[i] + " .nav-margin-top"), {
            clip: "rect(0px, 0px, 1px, 0px)"
        }), TweenMax.set($("#nav-" + this.sections[i] + " .nav-margin-bottom"), {
            clip: "rect(0px, 0px, 1px, " + $("#nav-" + this.sections[i]).width() + "px)"
        });
        $(".navbar-main li").mouseenter(function() {
            TweenMax.to($(this).find(".nav-margin-top"), .35, {
                clip: "rect(0px, " + ((this.offsetWidth - 40) / 2 + 5) + "px, 1px, 0px)",
                ease: Circ.easeIn
            }), TweenMax.to($(this).find(".nav-margin-top"), .25, {
                clip: "rect(0px, " + ((this.offsetWidth - 40) / 2 + 5) + "px, 1px, " + ((this.offsetWidth - 40) / 2 - 5) + "px)",
                delay: .35,
                ease: Circ.easeOut
            }), TweenMax.to($(this).find(".nav-margin-bottom"), .35, {
                clip: "rect(0px, " + (this.offsetWidth - 40) + "px, 1px, " + ((this.offsetWidth - 40) / 2 - 5) + "px)",
                ease: Circ.easeIn
            }), TweenMax.to($(this).find(".nav-margin-bottom"), .25, {
                clip: "rect(0px, " + ((this.offsetWidth - 40) / 2 + 5) + "px, 1px, " + ((this.offsetWidth - 40) / 2 - 5) + "px)",
                delay: .35,
                ease: Circ.easeOut
            })
        }).mouseleave(function() {
            TweenMax.to($(this).find(".nav-margin-top"), .35, {
                clip: "rect(0px, " + (this.offsetWidth - 40) + "px, 1px, " + ((this.offsetWidth - 40) / 2 - 5) + "px)",
                ease: Circ.easeIn
            }), TweenMax.to($(this).find(".nav-margin-top"), .25, {
                clip: "rect(0px, " + (this.offsetWidth - 40) + "px, 1px, " + (this.offsetWidth - 40) + "px)",
                delay: .35,
                ease: Circ.easeOut
            }), TweenMax.set($(this).find(".nav-margin-top"), {
                clip: "rect(0px, 0px, 1px, 0px)",
                delay: .6
            }), TweenMax.to($(this).find(".nav-margin-bottom"), .35, {
                clip: "rect(0px, " + ((this.offsetWidth - 40) / 2 + 5) + "px, 1px, 0px)",
                ease: Circ.easeIn
            }), TweenMax.to($(this).find(".nav-margin-bottom"), .25, {
                clip: "rect(0px, 0px, 1px, 0px)",
                delay: .35,
                ease: Circ.easeOut
            }), TweenMax.set($(this).find(".nav-margin-bottom"), {
                clip: "rect(0px, 0px, 1px, " + (this.offsetWidth - 40) + "px)",
                delay: .6
            })
        }),  $("#tout_trailer").mouseenter(function() {
            TweenMax.set($("#tout_trailer_btn_over"), {
                transformOrign: "50% 50%"
            }), TweenMax.to($(this).find(".tout_border"), .25, {
                "border-width": "4px",
                ease: Power4.easeOut
            }), TweenMax.to($(this).find("#tout_trailer_btn_over"), .15, {
                scale: 1,
                ease: Power4.easeOut
            }), TweenMax.to($(this).find("#tout_trailer_btn_over img"), .15, {
                x: 34,
                delay: .15,
                ease: Power4.easeOut
            })
        }).mouseleave(function() {
            TweenMax.to($(this).find(".tout_border"), .25, {
                "border-width": "2px",
                ease: Power4.easeOut
            }), TweenMax.to($(this).find("#tout_trailer_btn_over img"), .15, {
                x: 0,
                ease: Power4.easeOut
            }), TweenMax.to($(this).find("#tout_trailer_btn_over"), .15, {
                scale: 0,
                delay: .15,
                ease: Power4.easeOut
            })
        }), $(".tout").mouseenter(function() {
            TweenMax.to($(this).find(".tout_border"), .25, {
                "border-width": "4px",
                ease: Power4.easeOut
            }), TweenMax.fromTo($(this).find("h1"), .2, {
                y: 0,
                opacity: 1
            }, {
                y: 6,
                opacity: 0,
                ease: Power3.easeOut
            }), TweenMax.fromTo($(this).find("h1"), .2, {
                y: -6,
                opacity: 0
            }, {
                y: 0,
                opacity: 1,
                delay: .2,
                ease: Power3.easeOut
            })
        }).mouseleave(function() {
            TweenMax.to($(this).find(".tout_border"), .25, {
                "border-width": "2px",
                ease: Power4.easeOut
            }), TweenMax.fromTo($(this).find("h1"), .2, {
                y: 0,
                opacity: 1
            }, {
                y: -6,
                opacity: 0,
                ease: Power3.easeOut
            }), TweenMax.fromTo($(this).find("h1"), .2, {
                y: 6,
                opacity: 0
            }, {
                y: 0,
                opacity: 1,
                delay: .2,
                ease: Power3.easeOut
            })
        })
    },
   
    addYoutubeVideo: function() {
        var e = {
                playBtn: "yt-playtoggle",
                scrubber: "yt-progress-holder",
                soundBtn: "yt-soundtoggle",
                prevBtn: "yt-previous",
                nextBtn: "yt-next"
            },
            t = {
                containerID: "trailer_overlay",
                id: "AEBIJRAkujM",
                closeBtn: "yt-close",
                list: !0,
                index: 0,
                showinfo: 0,
                autoplay: 0,
                controls: 0,
                loop: 1,
                customControls: !0,
                customBackground: !0,
                dispatcher: app.dispatcher,
                customButtons: e
            };
        this.yt = new Trailer(t, app.dispatcher), this.yt.add(), document.getElementById("nav_trailer").addEventListener("click", function() {
            "desktop" !== this.device && $(".navbar-toggle").click(), app.dispatcher.dispatch("SHOW_TRAILER")
        }.bind(this)), document.getElementById("tout_trailer").addEventListener("click", function() {
            app.dispatcher.dispatch("SHOW_TRAILER")
        })
    }
}, PreloadView = function(e) {
    this.vh = -1 * window.innerHeight, this.view = document.getElementById("preloader"), this.content = document.getElementById("preloader-content"), this.dispatcher = void 0 !== e ? e : new Dispatcher, this.device = Detectizr.device.type, this.tl = new TimelineMax({
        delay: .5
    }), this.split = new SplitText("#preloader-text", {
        type: "chars"
    }), this.init()
}, PreloadView.prototype = {
    constructor: PreloadView,
    init: function() {
        this.bindEvents(), this.intro(), chars = this.split.chars, $('#preloader').addClass('animating') ,this.tl.set($("#preloader-indicator"), {
            clip: "rect(0px, " + $("#preloader-indicator").width() * 2 + "px, 2px, " + $("#preloader-indicator").width() * 2 + "px)"
        }).set($("#preloader-content h1"), {
            opacity: 1
        }).to($("#preloader-indicator"), .5, {
            clip: "rect(0px, " + $("#preloader-indicator").width() + "px, 2px, 0px)",
            ease: Power1.easeInOut
        }).set($("#preloader-indicator-bg"), {
            opacity: 1
        }).fromTo($("#preloader-tt-1"), 0.9, {
            opacity: 0,
            y: 80
        }, {
            opacity: 1,
            y: 0,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-2"), 2.0, {
            opacity: 0,
            y: 80
        }, {
            opacity: 1,
            y: 0,
            delay: .1,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-3"), 0.7, {
            opacity: 0,
            y: 20
        }, {
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-4"), 1.7, {
            opacity: 0,
            y: 40
        },{
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-5"), 1.2, {
            opacity: 0,
            y: 50
        },
        {
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-6"), 0.8, {
            opacity: 0,
            y: 60
        },
        {
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-7"), 2.5, {
            opacity: 0,
            y: 70
        }, 
        {
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-8"), 0.9, {
            opacity: 0,
            y: 80
        },  
         {
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-9"), 0.5, {
            opacity: 0,
            y: -90
        },
         {
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-10"), 1.7, {
            opacity: 0,
            y: -60
        },
         {
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power3.easeOut
        }, "grp1").fromTo($("#preloader-tt-11"), 1.1, {
            opacity: 0,
            y: -80
        },
         {
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power4.easeOut
        }, "grp1").fromTo($("#preloader-tt-12"), 2.1, {
            opacity: 0,
            y: -60
        },  {
            opacity: 1,
            y: 0,
            delay: .3,
            ease: Power3.easeOut,
            onComplete: function() {
                this.dispatcher.dispatch("INTRO_DONE_EVENT")
            }.bind(this)
        }, "grp1").staggerFromTo(chars, .75, {
            opacity: 0,
            y: -10
        }, {
            opacity: 1,
            y: 0,
            delay: .2,
            ease: Power3.easeOut
        }, .05, "grp1").to($("#preloader-indicator"), .5, {
            clip: "rect(0px, " + $("#preloader-indicator").width() * -200 + "px, 2px, " + $("#preloader-indicator").width() * -200 + "px)",
            delay: .2,
            ease: Power1.easeInOut
        }, "grp1")
    },
    updateProgress: function(e, t) {
        TweenMax.to($("#preloader-indicator"), .25, {
            clip: "rect(200px, " + (t / -100 * $("#preloader-indicator").width() * -200 + $("#preloader-indicator").width() * -200) + "px, 2px, " + ($("#preloader-indicator").width() * -200 + t / 100 * $("#preloader-indicator").width() * 200) + "px)"
        })
    },
    onLoaded: function(e, t) {
        this.outro(), this.dispatcher.removeEventlistener(this.progressEvent), this.dispatcher.removeEventlistener(this.completeEvent),

        (function(window) {



    // Helper vars and functions.
    function extend( a, b ) {
        for( var key in b ) { 
            if( b.hasOwnProperty( key ) ) {
                a[key] = b[key];
            }
        }
        return a;
    }
    // From https://davidwalsh.name/javascript-debounce-function.
    function debounce(func, wait, immediate) {
        var timeout;
        return function() {
            var context = this, args = arguments;
            var later = function() {
                timeout = null;
                if (!immediate) func.apply(context, args);
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) func.apply(context, args);
        };
    };
    // Creates a sorted array of random numbers between minVal and maxVal with a length = size.
    function createRandIntOrderedArray(minVal, maxVal, size) {
        var arr = [];
        for(var i=0; i<size; ++i) {
            arr.push(anime.random(minVal, maxVal));
        }
        arr.sort(function(a, b){ return a-b });
        return arr;
    }
    // Checks if an object is empty.
    function isObjEmpty(obj) {
        return Object.getOwnPropertyNames(obj).length > 0;
    }
    // Concatenate JS objs.
    // From http://stackoverflow.com/a/2454315.
    function collect() {
        var ret = {};
        var len = arguments.length;
        for (var i=0; i<len; i++) {
            for (var p in arguments[i]) {
                if (arguments[i].hasOwnProperty(p)) {
                    ret[p] = arguments[i][p];
                }
            }
        }
        return ret;
    }
    // Check if clip-path is supported. From http://stackoverflow.com/a/30041538.
    function areClipPathShapesSupported() {
        var base = 'clipPath',
            prefixes = [ 'webkit', 'moz', 'ms', 'o' ],
            properties = [ base ],
            testElement = document.createElement( 'testelement' ),
            attribute = 'polygon(50% 0%, 0% 100%, 100% 100%)';

        // Push the prefixed properties into the array of properties.
        for ( var i = 0, l = prefixes.length; i < l; i++ ) {
            var prefixedProperty = prefixes[i] + base.charAt( 0 ).toUpperCase() + base.slice( 1 ); // remember to capitalize!
            properties.push( prefixedProperty );
        }

        // Interate over the properties and see if they pass two tests.
        for ( var i = 0, l = properties.length; i < l; i++ ) {
            var property = properties[i];

            // First, they need to even support clip-path (IE <= 11 does not)...
            if ( testElement.style[property] === '' ) {

                // Second, we need to see what happens when we try to create a CSS shape...
                testElement.style[property] = attribute;
                if ( testElement.style[property] !== '' ) {
                    return true;
                }
            }
        }
        return false;
    };

    /**
     * Segmenter obj.
     */
    function Segmenter(el, options) {
        this.el = el;
        this.options = extend({}, this.options);
        extend(this.options, options);
        // Preload main image.
        var self = this;
        imagesLoaded(this.el, { background: true }, function() {
            self._init();
            self._initEvents();
            self.options.onReady();
        });
    }

    Segmenter.prototype.options = {
        // Number of pieces.
        pieces: 4, 
        // Show pieces already styled.
        renderOnLoad: false,
        // Add an element for the shadow.
        shadows: true,
        // Animations for the shadow (valid properties: opacity, translateX, translateY).
        shadowsAnimation: {
            opacity: 1,
            // translateX: 20,
            // translateY: 20
        },
        // Parrallax effect for the pieces.
        parallax: false,
        // Movements for the parallax effect.
        parallaxMovement: {min: 10, max: 40},
        // Animation for the pieces (valid properties: duration, easing, delay, opacity, translate[XYZ]).
        animation: {
            duration: 1500,
            easing: 'easeOutQuad',
            delay: 0, // Delay increment per piece.
            // opacity: 0.5,
            translateZ: {min: 10, max: 65}, // We can also use an integer for a specific value.
            // translateX: {min: -100, max: 100}, // We can also use an integer for a specific value.
            // translateY: {min: -100, max: 100} // We can also use an integer for a specific value.
        },
        // Callbacks
        onReady: function() { return false; },
        onAnimationComplete: function() { return false; },
        onAnimationStart: function() { return false; },
        // The positions of the pieces in percentage values. 
        // We can also use random values by setting options.positions to "random".
        positions: [
            {top: 80, left: 10, width: 30, height: 20},
            {top: 2, left: 2, width: 40, height: 40},
            {top: 30, left: 60, width: 30, height: 60},
            {top: 10, left: 20, width: 50, height: 60}
        ]
    };

    /**
     * Init!
     */
    Segmenter.prototype._init = function() {
        // The dimensions of the main element.
        this.dimensions = {
            width: this.el.offsetWidth,
            height: this.el.offsetHeight
        };
        
        // The source of the main image.
        var background = this.el.style.backgroundImage;
        this.imgsrc = background.replace('url(','').replace(')','').replace(/\"/gi, "");;
        
        // Create the layout.
        this._layout();

        var self = this;
        this.pieces = [].slice.call(this.el.querySelectorAll('.segmenter__piece-wrap'));
        this.pieces.forEach(function(piece, pos) {
            // Bugfix for Chrome. The translateZ needs an initial value otherwise the animation will not work. (this seems to be a anime.js bug - letÂ´s wait for the next version..)
            piece.style.WebkitTransform = piece.style.transform = 'translateZ(0.0001px)';

            // If we want to render the different pieces on load then:
            if( self.options.renderOnLoad ) {
                self._renderPiece(piece);
            }
        });
        // Flag to indicate the pieces are already rendered/styled either on load or after the animation.
        if( this.options.renderOnLoad ) {
            this.active = true;
        }
    };

    /**
     * Creates the layout.
     */
    Segmenter.prototype._layout = function() {
        // clip-path support
        var clipPath = areClipPathShapesSupported();

        var segBgEl = document.createElement('div');
        segBgEl.className = 'segmenter__background';
        segBgEl.style.backgroundImage = 'url(' + this.imgsrc + ')';

        var segPieces = document.createElement('div'),
            segPiecesHTML = '',
            positionsTotal = this.options.positions.length;

        segPieces.className = 'segmenter__pieces';

        for(var i = 0, len = this.options.pieces; i < len; ++i) {
            if( this.options.parallax ) {
                segPiecesHTML += '<div class="segmenter__piece-parallax">';
            }

            segPiecesHTML += '<div class="segmenter__piece-wrap">';
            
            var top, left, width, height, clipTop, clipLeft, clipRight, clipBottom,
                pos = i <= positionsTotal - 1 ? i : 0,
                isRandom = this.options.positions === 'random';

            top = isRandom ? anime.random(0,100) : this.options.positions[pos].top;
            left = isRandom ? anime.random(0,100) : this.options.positions[pos].left;
            width = isRandom ? anime.random(0,100) : this.options.positions[pos].width;
            height = isRandom ? anime.random(0,100) : this.options.positions[pos].height;
            
            if( !clipPath ) {
                clipTop = isRandom ? top/100 * this.dimensions.height : this.options.positions[pos].top/100 * this.dimensions.height;
                clipLeft = isRandom ? left/100 * this.dimensions.width : this.options.positions[pos].left/100 * this.dimensions.width;
                clipRight = isRandom ? width/100 * this.dimensions.width + clipLeft : this.options.positions[pos].width/100 * this.dimensions.width + clipLeft;
                clipBottom = isRandom ? height/100 * this.dimensions.height + clipTop : this.options.positions[pos].height/100 * this.dimensions.height + clipTop;
            }

            if( this.options.shadows ) {
                segPiecesHTML += '<div class="segmenter__shadow" style="top: ' + top + '%; left: ' + left + '%; width: ' + width + '%; height: ' + height + '%"></div>';        
            }

            segPiecesHTML += clipPath ?
                            '<div class="segmenter__piece" style="background-image: url(' + this.imgsrc + '); -webkit-clip-path: polygon(' + left + '% ' + top + '%, ' + (left + width) + '% ' + top + '%, ' + (left + width) + '% ' + (top + height) + '%, ' + left + '% ' + (top + height) + '%); clip-path: polygon(' + left + '% ' + top + '%, ' + (left + width) + '% ' + top + '%, ' + (left + width) + '% ' + (top + height) + '%, ' + left + '% ' + (top + height) + '%)"></div>' :
                            '<div class="segmenter__piece" style="background-image: url(' + this.imgsrc + '); clip: rect(' + clipTop + 'px,' + clipRight + 'px,' + clipBottom + 'px,' + clipLeft + 'px)"></div>';

            segPiecesHTML += '</div>'
            if( this.options.parallax ) {
                segPiecesHTML += '</div>';
            }
        }

        segPieces.innerHTML = segPiecesHTML;

        this.el.innerHTML = '';
        this.el.appendChild(segBgEl);
        this.el.appendChild(segPieces);
    };

    /**
     * Renders/Styles a piece with the options that are passed in the initialization.
     */
    Segmenter.prototype._renderPiece = function(piece) {
        var idx = this.pieces.indexOf(piece);
        var self = this;
        if( self.options.animation.translateZ != undefined ) {
            if( typeof self.options.animation.translateZ === 'object' ) {
                var randArr = createRandIntOrderedArray(self.options.animation.translateZ.min, self.options.animation.translateZ.max, self.options.pieces);
                piece.style.transform = piece.style.WebkitTransform = 'translateZ(' + randArr[idx] + 'px)';
            }
            else {
                piece.style.transform = piece.style.WebkitTransform = 'translateZ(' + self.options.animation.translateZ + 'px)';
            }
        }
        if( self.options.animation.translateY != undefined ) {
            if( typeof self.options.animation.translateY === 'object' ) {
                var randArr = createRandIntOrderedArray(self.options.animation.translateY.min, self.options.animation.translateY.max, self.options.pieces);
                piece.style.transform = piece.style.WebkitTransform = 'translateY(' + randArr[idx] + 'px)';
            }
            else {
                piece.style.transform = piece.style.WebkitTransform = 'translateY(' + self.options.animation.translateY + 'px)';
            }
        }
        if( self.options.animation.translateX != undefined ) {
            if( typeof self.options.animation.translateX === 'object' ) {
                var randArr = createRandIntOrderedArray(self.options.animation.translateX.min, self.options.animation.translateX.max, self.options.pieces);
                piece.style.transform = piece.style.WebkitTransform = 'translateX(' + randArr[idx] + 'px)';
            }
            else {
                piece.style.transform = piece.style.WebkitTransform = 'translateX(' + self.options.animation.translateX + 'px)';
            }
        }
        if( self.options.animation.opacity != undefined ) {
            piece.style.opacity = self.options.animation.opacity;
        }

        if( self.options.shadows && isObjEmpty(self.options.shadowsAnimation) ) {
            var shadowEl = piece.querySelector('.segmenter__shadow');
            shadowEl.style.opacity = self.options.shadowsAnimation.opacity != undefined ? self.options.shadowsAnimation.opacity : 0;
            shadowEl.style.transform = shadowEl.style.WebkitTransform = 'translateX(' + (self.options.shadowsAnimation.translateX != undefined ? self.options.shadowsAnimation.translateX : 0) + 'px) translateY(' + (self.options.shadowsAnimation.translateY != undefined ? self.options.shadowsAnimation.translateY : 0) + 'px)';
        }
    };

    /**
     * Animates the pieces with the options passed (with anime.js).
     */
    Segmenter.prototype.animate = function() {
        if( this.active ) {
            return false;
        }
        this.active = true;

        var self = this,
            animProps = {
                targets: this.pieces,
                duration: this.options.animation.duration,
                delay: function(el, index) { return (self.options.pieces - index - 1) * self.options.animation.delay; },
                easing: this.options.animation.easing,
                begin: this.options.onAnimationStart,
                complete: this.options.onAnimationComplete
            };
        
        if( this.options.animation.translateZ != undefined ) {
            var randArr = createRandIntOrderedArray(this.options.animation.translateZ.min, this.options.animation.translateZ.max, this.options.pieces);
            animProps.translateZ = typeof this.options.animation.translateZ === 'object' ? function(el, index) {
                return randArr[index];
            } : this.options.animation.translateZ;
        }
        if( this.options.animation.translateX != undefined ) {
            animProps.translateX = typeof this.options.animation.translateX === 'object' ? function(el, index) {
                return anime.random(self.options.animation.translateX.min, self.options.animation.translateX.max);
            } : this.options.animation.translateX;
        }
        if( this.options.animation.translateY != undefined ) {
            animProps.translateY = typeof this.options.animation.translateY === 'object' ? function(el, index) {
                return anime.random(self.options.animation.translateY.min, self.options.animation.translateY.max);
            } : this.options.animation.translateY;
        }
        if( this.options.animation.opacity != undefined ) {
            animProps.opacity = this.options.animation.opacity;
        }

        anime(animProps);

        // Also animate the shadow element.
        if( this.options.shadows && isObjEmpty(this.options.shadowsAnimation) ) {
            anime(collect({
                targets: this.el.querySelectorAll('.segmenter__shadow'),
                duration: this.options.animation.duration,
                delay: function(el, index) { return (self.options.pieces - index - 1) * self.options.animation.delay; },
                easing: this.options.animation.easing
            }, this.options.shadowsAnimation));
        }
    };

    /**
     * Init/Bind events.
     */
    Segmenter.prototype._initEvents = function() {
        var self = this;
        
        // Window resize.
        this.debounceResize = debounce(function(ev) {
            var positionsTotal = self.options.positions.length;

            // Recalculate dimensions.
            self.dimensions = {
                width: self.el.offsetWidth,
                height: self.el.offsetHeight
            };

            // Recalculate clip values..
            // todo: DRY
            // todo: If random is true then save the initial values. Should not recalculate for this case.
            self.pieces.forEach(function(piece, position) {
                var clipTop, clipLeft, clipRight, clipBottom,
                    segmenterPiece = piece.querySelector('.segmenter__piece');

                if( self.options.positions === 'random' ) {
                    var randT = anime.random(0,100), randL = anime.random(0,100), randW = anime.random(0,100), randH = anime.random(0,100);
                    clipTop = randT/100 * self.dimensions.height;
                    clipLeft = randL/100 * self.dimensions.width;
                    clipRight = randW/100 * self.dimensions.width + clipLeft;
                    clipBottom = randH/100 * self.dimensions.height + clipTop;
                }
                else {
                    var pos = position <= positionsTotal - 1 ? position : 0;
                    clipTop = self.options.positions[pos].top/100 * self.dimensions.height;
                    clipLeft = self.options.positions[pos].left/100 * self.dimensions.width;
                    clipRight = self.options.positions[pos].width/100 * self.dimensions.width + clipLeft;
                    clipBottom = self.options.positions[pos].height/100 * self.dimensions.height + clipTop;
                }

                segmenterPiece.style.clip = 'rect(' + clipTop + 'px,' + clipRight + 'px,' + clipBottom + 'px,' + clipLeft + 'px)';
            });
        }, 10);
        window.addEventListener('resize', this.debounceResize);
        
        // Mousemove and Deviceorientation:
        if( this.options.parallax ) {
            var arrRand = createRandIntOrderedArray(this.options.parallaxMovement.min, this.options.parallaxMovement.max, this.options.pieces);
            this.pieces.forEach(function(piece, pos) {
                piece.setAttribute('data-parallax-translation', typeof self.options.parallaxMovement === 'object' ? arrRand[pos] : self.options.parallaxMovement );
            });
            this.mousemove = function(ev) {
                if( !self.active ) {
                    return false;
                }
                requestAnimationFrame(function() {
                    self.pieces.forEach(function(piece) {
                        var t = piece.getAttribute('data-parallax-translation'),
                            transX = t/(self.dimensions.width)*ev.clientX - t/2,
                            transY = t/(self.dimensions.height)*ev.clientY - t/2;

                        piece.parentNode.style.transform = piece.parentNode.style.WebkitTransform = 'translate3d(' + transX + 'px,' + transY + 'px,0)';
                    });
                });
            };
            window.addEventListener('mousemove', this.mousemove);

            this.handleOrientation = function() {
                if( !self.active ) {
                    return false;
                }
                var y = event.gamma;
                // To make computation easier we shift the range of x and y to [0,180]
                y += 90;
                
                requestAnimationFrame(function() {
                    self.pieces.forEach(function(piece) {
                        var t = piece.getAttribute('data-parallax-translation'),
                            transX = t/(self.dimensions.width)*y - t/2,
                            transY = t/(self.dimensions.height)*y - t/2;

                        piece.parentNode.style.transform = piece.parentNode.style.WebkitTransform = 'translate3d(' + transX + 'px,' + transY + 'px,0)';
                    });
                });
            }
            window.addEventListener('deviceorientation', this.handleOrientation);
        }
    };

    window.Segmenter = Segmenter;

})(window);

               function imageAnimation() {
          var headline = document.querySelector('.trigger-headline');
          var headlinetom = document.querySelector('.trigger-headline-tom'),
            
          trigger = document.querySelector('.home'),
          segmenter = new Segmenter(document.querySelector('.segmenter'), {
            pieces: 9,
            positions: [
            {top: 30, left: 5, width: 40, height: 80},
            {top: 50, left: 25, width: 30, height: 30},
            {top: 5, left: 75, width: 40, height: 20},
            {top: 30, left: 45, width: 40, height: 20},
            {top: 45, left: 15, width: 50, height: 40},
            {top: 10, left: 40, width: 10, height: 20},
            {top: 20, left: 50, width: 30, height: 70},
            {top: 0, left: 10, width: 50, height: 60},
            {top: 70, left: 40, width: 30, height: 30}
            ],
            animation: {
              duration: 2000,
              easing: 'easeInOutCubic',
              delay: 0,
              opacity: 1,
              translateZ: 85,
              translateX: {min: -20, max: 20},
              translateY: {min: -20, max: 20}
            },
            parallax: true,
            parallaxMovement: {min: -10, max: -5},
            onReady: function() {
              if ($('#home_sec').css('top') <= '0px') {
                setTimeout(function() {
                 headline.classList.remove('trigger-headline--hidden');
                  setTimeout(function() {
                 headlinetom.classList.remove('trigger-headline-tom--hidden');
                 segmenter.animate();
                       }, 350)
               }, 1000)
              }          
            },
            onAnimationComplete: function () {

            }

          });
          trigger.addEventListener('click', function() {
           headline.classList.add('trigger-headline--hidden');
             setTimeout(function() {
            headlinetom.classList.add('trigger-headline-tom--hidden');
                    }, 200)
           setTimeout(function() {
            segmenter.active = false;
            setTimeout(function() {

              headline.classList.remove('trigger-headline--hidden');
               setTimeout(function() {
              headlinetom.classList.remove('trigger-headline-tom--hidden');
                    }, 350)
              segmenter.animate();
            }, 1000)  

          }, 1000)                   
         });
        }

        imageAnimation(); 
    },
    onIntroComplete: function(e) {
        TweenMax.set(this.view, {
            opacity: 1
        })
    },
    onOutroComplete: function(e) {
        TweenMax.set(this.view, {
            display: "none"
        }), this.dispatcher.dispatch("OUTRO_DONE_EVENT")
    },
    bindEvents: function() {
        this.progressEvent = this.dispatcher.addEventlistener("AM_PROGRESS_G", this.updateProgress.bind(this)), this.completeEvent = this.dispatcher.addEventlistener("AM_COMPLETE_G", this.onLoaded.bind(this))
    },
    intro: function() {
        TweenMax.fromTo(this.view, 1, {
            opacity: 1
        }, {
            opacity: 1,
            onComplete: this.onIntroComplete.bind(this)
        })
    },
    outro: function() {
        TweenMax.fromTo(this.view, .75, {
            y: 0
        }, {
            y: this.vh,
            delay: .75,
            ease: Power4.easeOut,
            onComplete: this.onOutroComplete.bind(this)
        }), TweenMax.fromTo($("#dimmer"), .75, {
            opacity: 1
        }, {
            opacity: 0,
            delay: .5,
            ease: Power4.easeIn,
            onComplete: function() {
                $("#dimmer").css({
                    "z-index": 9,
                    opacity: "0"
                })
            }.bind(this)
        })
    }
}, scrollView = function(e) {
    this.dispatcher = void 0 !== e ? e : new Dispatcher, this.device = Detectizr.device.type, this.controller = new ScrollMagic.Controller, this.sections = ["home_sec", "story_sec", "castncrew_sec", "gallery_sec", "videos_sec", "tickets_sec"], this.sectionNames = ["home", "story", "castncrew", "gallery", "videos", "tickets"], this.curSection = 0, this.scrollHeight = 0, this.scrollOffset = 0, this.scenes = [], this.navScenes = [], this.clientHeight, this.scrollTo, this.scrollPos
}, scrollView.prototype = {
    constructor: scrollView,
    init: function() {
        if (this.dispatcher.dispatch("SCROLL_INIT"), this.bindEvents(), this.setbodyHeight(), 
            this.createNavScene("navbar", this.scrollHeight - document.getElementById(this.sections[0]).clientHeight, document.getElementById(this.sections[0]).clientHeight, "navbar", ".navbar", "nav-darken"),
            this.createNavScene("footer", this.scrollHeight - document.getElementById(this.sections[0]).clientHeight, document.getElementById(this.sections[0]).clientHeight, "footer", ".footer", "nav-darken"), "desktop" == this.device)
            this.createScene("home_secScroll", document.getElementById("home_sec").clientHeight, document.getElementById("home_sec").clientHeight, this.getOffset(0), this.sections[0], "#nav-" + this.sectionNames[0], "active", 0), 
            this.createScene("story_secScroll", document.getElementById("story_sec").clientHeight, document.getElementById("story_sec").clientHeight, this.getOffset(1), this.sections[1], "#nav-" + this.sectionNames[1], "active", 1),
            this.createScene("castncrew_secScroll", document.getElementById("castncrew_sec").clientHeight, document.getElementById("castncrew_sec").clientHeight, this.getOffset(2), this.sections[2], "#nav-" + this.sectionNames[2], "active", 2),
            this.createScene("gallery_secScroll", document.getElementById("gallery_sec").clientHeight, document.getElementById("gallery_sec").clientHeight, this.getOffset(3), this.sections[3], "#nav-" + this.sectionNames[3], "active", 3), 
            this.createScene("videos_secScroll", document.getElementById("videos_sec").clientHeight, document.getElementById("videos_sec").clientHeight, this.getOffset(4), this.sections[4], "#nav-" + this.sectionNames[4], "active", 4),
            this.createScene("tickets_secScroll", document.getElementById("tickets_sec").clientHeight, document.getElementById("tickets_sec").clientHeight, this.getOffset(5), this.sections[5], "#nav-" + this.sectionNames[5], "active", 5);
        else
            for (i = 0; i < this.sections.length; i++) this.createMobileScene(this.sections[i] + "Scroll", document.getElementById(this.sections[i]).clientHeight, this.getOffset(i), this.sections[i], "#nav-" + this.sectionNames[i], "active", i)
    },
    bindEvents: function() {
        this.hashEvent = this.dispatcher.addEventlistener("HASH_EVENT", this.onHashEvent.bind(this)), "desktop" == this.device && $(window).resize(this.resize.bind(this)), $(".navbar-main li").click(this.navigateOnClick.bind(this)), $(".navbar-toggle").click(function() {
            $(this).toggleClass("open");

        });
        this.hashEvent = this.dispatcher.addEventlistener("HASH_EVENT", this.onHashEvent.bind(this)), "desktop" == this.device && $(window).resize(this.resize.bind(this)), $(".navbar-right li").click(this.navigateOnClick.bind(this)), $(".navbar-toggle").click(function() {
            $(this).toggleClass("open")
        });

   

  

    $("#story-wrapper").click(function() {
              TweenMax.to($("body"), 1, {
                        scrollTo: {
                            y: window.innerHeight * 6.785
                        },
                        ease: Power4.easeInOut,
                    })
                })
    },
    onHashEvent: function(e, t) {
        this.scrollTo = t, this.navigateTo(this.scrollTo)
    },
    setbodyHeight: function() {
        for (this.scrollHeight = 0, i = 0; i < this.sections.length; i++) this.scrollHeight = this.scrollHeight + document.getElementById(this.sections[i]).clientHeight;
        $("body").css("height", this.scrollHeight + "px")
    },
    createScene: function(e, t, s, o, n, a, r, c) {
        var d = new TimelineMax;
        "story_secScroll" === e ? d.to(document.getElementById(n), 1, {
            top: -1 * s + "px",
            onUpdate: function() {
                this.dispatcher.dispatch("STORY_SCROLL_EVENT", parseInt(document.getElementById("story_sec").style.top))
            }.bind(this),
            force3D: !0,
            autoRound: !1,
            ease: Power0.easeNone
        }) : d.to(document.getElementById(n), 1, {
            top: -1 * s + "px",
            force3D: !0,
            autoRound: !1,
            ease: Power0.easeNone
        });
        var e = new ScrollMagic.Scene({
            triggerElement: "body",
            triggerHook: "onLeave",
            duration: t,
            offset: o,
            reverse: !0
        }).setTween(d).setClassToggle(a, r).on("leave", function(e) {
            "FORWARD" === e.target.controller().info("scrollDirection") ? (this.curSection++, this.curSection > 6 && (this.curSection = 6), window.location.hash = this.sectionNames[this.curSection]) : (this.curSection--, this.curSection < 0 && (this.curSection = 0), window.location.hash = this.sectionNames[this.curSection])
        }.bind(this)).addTo(this.controller);
        e.indicator = n, e.ch = document.getElementById(n).clientHeight, e.id = document.getElementById(n), e.index = i, this.scenes.push(e)
    },
    createMobileScene: function(e, t, i, s, o, n, a) {
        new ScrollMagic.Scene({
            triggerElement: "body",
            triggerHook: "onLeave",
            duration: t,
            offset: i,
            reverse: !0
        }).setClassToggle(o, n).on("leave", function(e) {
            "FORWARD" === e.target.controller().info("scrollDirection") ? this.curSection++ : this.curSection--
        }.bind(this)).addTo(this.controller)
    },
    createNavScene: function(e, t, s, o, n, a) {
        var e = new ScrollMagic.Scene({
            triggerElement: "body",
            triggerHook: "onLeave",
            duration: t,
            offset: s,
            reverse: !0
        }).setClassToggle(n, a).on("leave", function(e) {
            $(".navbar").addClass("nav-lighten"), $("#footer").addClass("nav-lighten"), "desktop" == this.device && TweenMax.fromTo($(".navbar-brand"), .5, {
                opacity: 1,
                x: 0
            }, {
                opacity: 0,
                x: -25,
                ease: Power3.easeOut
            })
        }.bind(this)).on("enter", function(e) {
            $(".navbar").removeClass("nav-lighten"), $("#footer").removeClass("nav-lighten"), "desktop" == this.device && TweenMax.fromTo($(".navbar-brand"), .5, {
                opacity: 0,
                x: -25
            }, {
                opacity: 1,
                delay: .5,
                x: 0,
                ease: Power3.easeOut
            })
        }.bind(this)).addTo(this.controller);
        e.indicator = o, e.ch = document.getElementById(o).clientHeight, e.id = document.getElementById(o), e.index = i, this.navScenes.push(e)
    },
    navigateOnClick: function(e) {
        "desktop" !== this.device && $(".navbar-toggle").click(), this.scrollTo = $(e.currentTarget).attr("id"), this.scrollTo = this.sectionNames.indexOf(this.scrollTo.substring(4)), this.navigateTo(this.scrollTo)
            if ($('#home_sec').css('top') <= '0px') { 

             ($('#nav-overlay').css('opacity', '0')); 

        }

          if ($('#story_sec').css('top') <= '-100%' || ($('#s1_text1').css('opacity') == '1')) { 

             ($('#nav-overlay').css('opacity', '0')); 

        }

        if ($('#story_sec').css('top') <= '-100%' || ($('#s1_text1').css('opacity') == '0')) {
             ($('#nav-overlay').css('opacity', '1')); 
        }
    },
    navigateTo: function(e) {
        for (this.scrollPos = 0, i = 0; i < this.scrollTo; i++) this.scrollPos = this.scrollPos + document.getElementById(this.sections[i]).clientHeight;
        "mobile" !== app.device && (window.location.hash = this.sectionNames[i]), "desktop" == this.device ? e < this.curSection ? (TweenMax.set($("#nav-lock"), {
            "z-index": "11"
        }), TweenMax.fromTo($("#nav-mask"), .75, {
            clip: "rect(0px, " + window.innerWidth + "px, 0px, 0px)"
        }, {
            clip: "rect(0px, " + window.innerWidth + "px, " + window.innerHeight + "px, 0px)",
            ease: Power3.easeInOut,
            onComplete: function() {
                $("body").scrollTop(this.scrollPos), TweenMax.fromTo($("#nav-mask"), 1, {
                    opacity: 1
                }, {
                    opacity: 0,
                    ease: Power1.easeOut,
                    onComplete: function() {

                        TweenMax.set($("#nav-mask"), {
                            clip: "rect(0px, " + window.innerWidth + "px, 0px, 0px)",
                            opacity: 1
                        }), TweenMax.set($("#nav-lock"), {
                            "z-index": "1"
                        })
                    }
                })
            }.bind(this)
        })) : e > this.curSection ? (TweenMax.set($("#nav-lock"), {
            "z-index": "11"
        }), TweenMax.fromTo($("#nav-mask"), .75, {
            clip: "rect(" + window.innerHeight + "px, " + window.innerWidth + "px, " + window.innerHeight + "px, 0px)"
        }, {
            clip: "rect(0px, " + window.innerWidth + "px, " + window.innerHeight + "px, 0px)",
            ease: Power3.easeInOut,
            onComplete: function() {
                $("body").scrollTop(this.scrollPos), TweenMax.fromTo($("#nav-mask"), 1, {
                    opacity: 1
                }, {
                    opacity: 0,
                    ease: Power1.easeOut,
                    onComplete: function() {
                        TweenMax.set($("#nav-mask"), {
                            clip: "rect(0px, " + window.innerWidth + "px, 0px, 0px)",
                            opacity: 1
                        }), TweenMax.set($("#nav-lock"), {
                            "z-index": "1"
                        })
                    }
                })
            }.bind(this)
        })) : e === this.curSection : $("body").scrollTop(this.scrollPos)
    },
    getTween: function(e) {
        return TweenMax.fromTo(document.getElementById(e), 1, {
            top: "0px"
        }, {
            top: -1 * document.getElementById(e).clientHeight + "px",
            force3D: !0,
            autoRound: !1,
            ease: Power0.easeNone
        })
    },
    getOffset: function(e) {
        var t = 0;
        for (i = 0; i < e; i++) t += document.getElementById(this.sections[i]).clientHeight;
        return t
    },
    resize: function() {
        this.setbodyHeight()
        if (!window.screenTop && !window.screenY) {
    window.location.reload();
}

    },
    updateFixedValues: function() {

        this.scenes.forEach(function(e, t) {
            var i = this.getTween(e.indicator);
            i.progress(0), e.setTween(i), e.offset(this.getOffset(e.index)), e.duration(e.id.clientHeight), e.refresh(), e.update(!0)
        }.bind(this));
        var e = new TimelineMax;
        e.to(document.getElementById("story_sec"), 1, {
            top: -1 * document.getElementById("story_sec").clientHeight + "px",
            onUpdate: function() {
                this.dispatcher.dispatch("STORY_SCROLL_EVENT", parseInt(document.getElementById("story_sec").style.top))

            }.bind(this),
            force3D: !0,
            autoRound: !1,
            ease: Power0.easeNone
        }), this.scenes[i].setTween(e), this.scenes[i].refresh(), this.scenes[i].update(!0), this.navScenes.forEach(function(e, t) {
            e.offset(document.getElementById(this.sections[0]).clientHeight), e.duration($(window).height() - document.getElementById(this.sections[0]).clientHeight), e.refresh(), e.update(!0)
        }.bind(this))
    }
}, footerView = function(e) {
    this.dispatcher = void 0 !== e ? e : new Dispatcher, this.device = Detectizr.device.type
}, footerView.prototype = {
    constructor: footerView,
    init: function() {
        this.bindEvents()
    },
    populate: function() {
        for (i = 0; i < data.footer.billingBlock.length; i++) $(".footer_billingblock_container").append('<i class="footer_billingblock am-icon ' + data.footer.billingBlock[i] + '"></i>');
        for ($("#footer_logos").append('<p>' + data.footer.footerText + '</p>'), i = 0; i < data.footer.footerLinks.length; i++) data.footer.footerLinks[i].hasOwnProperty("link") ? $("#footer_links").append('<li><a href="' + data.footer.footerLinks[i].link + '" target="_blank">' + data.footer.footerLinks[i].label + "</a></li>") : $("#footer_links").append("<li>" + data.footer.footerLinks[i].label + "</li>")
    },
    bindEvents: function() {
        $("#btn_sound").mouseenter(function() {
            TweenMax.to($(this).find(".btn_footer_inner"), .25, {
                border: "1px solid rgba(116, 140, 132, 1)",
                ease: Power3.easeOut
            })
        }).mouseleave(function() {
            TweenMax.to($(this).find(".btn_footer_inner"), .25, {
                border: "1px solid rgba(116, 140, 132, 0.5)",
                ease: Power3.easeOut
            })
        }), $("#btn_legal").mouseenter(function() {
            TweenMax.to($(this).find(".btn_footer_inner"), .25, {
                border: "1px solid rgba(116, 140, 132, 1)",
                ease: Power3.easeOut
            }), TweenMax.fromTo($(this).find("p"), .2, {
                y: 0,
                opacity: 1
            }, {
                y: 6,
                opacity: 0,
                ease: Power3.easeOut
            }), TweenMax.fromTo($(this).find("p"), .2, {
                y: -6,
                opacity: 0
            }, {
                y: 0,
                opacity: 1,
                delay: .2,
                ease: Power3.easeOut
            })
        }).mouseleave(function() {
            TweenMax.to($(this).find(".btn_footer_inner"), .25, {
                border: "1px solid rgba(116, 140, 132, 0.5)",
                ease: Power3.easeOut
            }), TweenMax.fromTo($(this).find("p"), .2, {
                y: 0,
                opacity: 1
            }, {
                y: -6,
                opacity: 0,
                ease: Power3.easeOut
            }), TweenMax.fromTo($(this).find("p"), .2, {
                y: 6,
                opacity: 0
            }, {
                y: 0,
                opacity: 1,
                delay: .2,
                ease: Power3.easeOut
            })
        }), $("#footer_close").mouseenter(function() {
            TweenMax.set($(this).find(".close-outer"), {
                transformOrigin: "50% 50%"
            }), TweenMax.set($(this).find(".close-inner"), {
                transformOrigin: "50% 50%"
            }), TweenMax.set($(this).find(".close-img"), {
                transformOrigin: "50% 50%"
            }), TweenMax.to($(this).find(".close-outer"), .25, {
                scale: 1.2,
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".close-inner"), .25, {
                scale: 1.15,
                border: "1px solid rgba(255, 254, 237, 0.75)",
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".close-img"), .4, {
                rotation: 90,
                ease: Power3.easeOut
            })
        }).mouseleave(function() {
            TweenMax.to($(this).find(".close-outer"), .25, {
                scale: 1,
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".close-inner"), .25, {
                scale: 1,
                border: "1px solid rgba(255, 254, 237, 0.2)",
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".close-img"), .4, {
                rotation: 0,
                ease: Power3.easeOut
            })
        }), $("#btn_legal").click(this.footerExpand.bind(this)), $("#nav_legal").click(this.footerExpand.bind(this)), $("#footer_close").click(this.footerCollapse.bind(this)), this.completeEvent = this.dispatcher.addEventlistener("AM_COMPLETE_G", this.populate.bind(this)), $("#footer-overlay").mouseleave(this.footerCollapse.bind(this)), $("#btn_sound").click(function() {
            $(".bar").toggleClass("barOn")
        })
    },
    footerExpand: function(e) {
        "mobile" == this.device ? ($(".navbar-toggle").click(), $("#footer-overlay").hasClass("mobile_footer_expanded") ? this.footerCollapse() : ($("#footer-overlay").removeClass("mobile_footer_collapsed"), $("#footer-overlay").addClass("mobile_footer_expanded"))) : $("#footer-overlay").hasClass("footer_expanded") ? this.footerCollapse() : ($("#footer-overlay").removeClass("footer_collapsed"), $("#footer-overlay").addClass("footer_expanded"))
    },
    footerCollapse: function() {
        "mobile" == this.device ? $("#footer-overlay").hasClass("mobile_footer_expanded") && $("#footer-overlay").removeClass("mobile_footer_expanded").addClass("mobile_footer_collapsed") : $("#footer-overlay").hasClass("footer_expanded") && $("#footer-overlay").removeClass("footer_expanded").addClass("footer_collapsed")
    }
},  storyView = function(e) {
    this.dispatcher = void 0 !== e ? e : new Dispatcher, this.device = Detectizr.device.type, this.controller = new ScrollMagic.Controller, this.scenes = []
}, storyView.prototype = {
    constructor: storyView,
    init: function() {
        this.bindEvents()
    },
    bindEvents: function() {
        this.completeEvent = this.dispatcher.addEventlistener("AM_COMPLETE_G", this.populate.bind(this)), this.scrollUpdate = this.dispatcher.addEventlistener("STORY_SCROLL_EVENT", this.updateBind.bind(this)), "desktop" == this.device && $(window).resize(this.updateFixedValues.bind(this))
    },
    updateBind: function(e, t) {
          if ($('#story_sec').css('top') <= '-100%' || ($('#s1_text1').css('opacity') == '1')) { 

             ($('#nav-overlay').css('opacity', '0')); 

        }

        if ($('#story_sec').css('top') <= '-100%' || ($('#s1_text1').css('opacity') == '0')) {
             ($('#nav-overlay').css('opacity', '1')); 
        }

      
        
       TweenMax.set(".s1_text1B", {
            top: "calc( 50vh + " + Math.abs(t) + "px)"
        }), TweenMax.set("#s5_text_a", {
            "margin-top": "calc(" + Math.abs(t) + "px - 525vh)"
        })
    },
    populate: function() {
            $("#story1").css("background-image", "url('" + app.preloader.getAsset("story1bg").src + "')"),
            $("#s1_fg").attr("src", app.preloader.getAsset("story1fg").src),
            $("#s1_cloud1").attr("src", app.preloader.getAsset("story1cloud1").src),
            $("#s1_cloud2").attr("src", app.preloader.getAsset("story1cloud2").src),
            $("#s1_cloud3").attr("src", app.preloader.getAsset("story1cloud3").src),


            $("#story6").css("background-image", "url('" + app.preloader.getAsset("story6bg").src + "')"),
            $("#s6_fg").attr("src", app.preloader.getAsset("story6fg").src),
            $("#story7").css("background-image", "url('" + app.preloader.getAsset("story7bg").src + "')"), "mobile" !== this.device ? ($("#story2").vide(app.preloader.getAsset("story2vid").src, {
            posterType: "jpg",
            autoplay: !0,
            loop: !0
        }), $("#story3").vide(app.preloader.getAsset("story3vid").src, {
            posterType: "jpg",
            autoplay: !0,
            loop: !0
        })) : ($("#story2").css("background-image", "url(" + app.preloader.getAsset("story2bg_mob").src + ")"), $("#story4").css("background-image", "url(" + app.preloader.getAsset("story4bg_mob").src + ")")),
         "desktop" == this.device ? tween1_1=TweenMax.fromTo(".s1_text1", .5, {
            opacity: 1, y: 0
        },{
            opacity: 0,
            y: 50,
            ease: Power4.easeOut,
            onComplete: function() {
                TweenMax.set(".s1_text1", {
                    opacity: 0
                })
            }
        }
        ):tween1_1=TweenMax.fromTo(".s1_text1", .5, {
            y: 0,
            opacity: 1
        },{
            y: document.getElementById("story1").clientHeight-window.innerHeight, opacity: 0
        }
        ), "desktop" == this.device ? tween1_2 = TweenMax.fromTo(".s1_text1B", .5, {
            opacity: 0,
            y: 500,
            

        }, {
            opacity: 4,
            y: document.getElementById("home_sec").clientHeight-window.innerHeight / 1.7,
            ease: Power1.easeOut,
            onComplete: function() {

                TweenMax.set(".s1_text1B", {
                    opacity: 1,
                   
                })
            }
        }) : tween1_2 = TweenMax.fromTo(".s1_text1B", .5, {
            opacity: 0,
            y: 0
        }, {
            opacity: 1,
            y: document.getElementById("story1").clientHeight-window.innerHeight,
        }), tween1_3 = TweenMax.fromTo("#s1_text2", .5, {
            y: 0,
            opacity: 1
        }, {
            y: document.getElementById("story1").clientHeight - window.innerHeight,
            opacity: 0
        }), {
            opacity: 1
        }, tween1_5 = TweenMax.fromTo("#btn_scroll", .5, {
            y: 0,
            opacity: 1
        }, {
            y: (document.getElementById("story1").clientHeight / 3) - window.innerHeight,
            opacity: 0
        }), {
            opacity: 1
        },  tween2_1 = new TimelineMax, tween2_1.fromTo("#s2_text h1", .5, {
            opacity: 0
        }, {
            opacity: 1,
            ease: Power4.easeInOut
        }, "group").fromTo("#s2_text div", .5, {
            scale: 0
        }, {
            scale: 1,
            delay: .3,
            ease: Power2.easeInOut
        }, "group").fromTo("#s2_text p", .5, {
            opacity: 0
        }, {
            opacity: 1,
            delay: .9,
            ease: Power2.easeInOut
        }, "group").fromTo("#s2_text h2", .5, {
            opacity: 0
        }, {
            opacity: 1,
            delay: .9,
            ease: Power2.easeInOut
        }, "group"),
          tween6_1 = new TimelineMax, tween6_1.fromTo("#s6_text h1", 0.5, {
            opacity: 0
        }, {
            opacity: 1,
            ease: Power4.easeInOut
        }, "group").fromTo("#s6_text div", .5, {
            scale: 0
        }, {
            scale: 1,
            delay: .3,
            ease: Power2.easeInOut
        }, "group").fromTo("#s6_text p", .5, {
            opacity: 0
        }, {
            opacity: 1,
            delay: .6,
            ease: Power2.easeInOut
        }, "group").fromTo("#s6_text h2", .5, {
            opacity: 0
        }, {
            opacity: 1,
            delay: .6,
            ease: Power2.easeInOut
        }, "group"), tween1_4 = new TimelineMax, tween1_4.fromTo("#s1_text", .5, {
            y: 0
        }, {
            y: -130
        }, "grp1").fromTo("#s1_cloud1", .5, {
            x: .05 * window.innerWidth
        }, {
            x: -.05 * window.innerWidth
        }, "grp1").fromTo("#s1_cloud2", .5, {
            x: .02 * window.innerWidth
        }, {
            x: -.02 * window.innerWidth
        }, "grp1").fromTo("#s1_cloud3", .5, {
            x: 50
        }, {
            x: -50
        }, "grp1"), tween7 = new TimelineMax, tween7.fromTo("#s7_text", .5, {
            opacity: 0
        }, {
            opacity: 1,
            ease: Power4.easeInOut
        }).fromTo("#s7_text div", .5, {
            scale: 0
        }, {
            scale: 1,
            ease: Power2.easeInOut
        }).fromTo("#s7_text h4", .5, {
            opacity: 0
        }, {
            opacity: 1,
            ease: Power2.easeInOut
        }).fromTo("#s7_text p", .5, {
            opacity: 0
        }, {
            opacity: 1,
            ease: Power2.easeInOut
        }),

        this.createScene("story1_1", 150, document.getElementById("story1").clientHeight-window.innerHeight, tween1_1, "story1"),
        this.createScene("story1_2", document.getElementById("story1").clientHeight/4, document.getElementById("story1").clientHeight-1.25*window.innerHeight, tween1_2, "story1"),
        this.createScene("story1_3", document.getElementById("story1").clientHeight/1.5, 2*document.getElementById("s1_text2").clientHeight, tween1_3, "story1"),
        this.createScene("story1_4", document.getElementById("story1").clientHeight / 2, document.getElementById("story1").clientHeight - 1.25 * window.innerHeight, tween1_4, "story1"),
        this.createScene("story1_5", 150, document.getElementById("story1").clientHeight - window.innerHeight, tween1_5, "story1"),
        this.createScene("story2_1", -1 * (document.getElementById("story2").clientHeight / 4), 0, tween2_1, "story2"),
        this.createScene("story6_1", -1 * (document.getElementById("story6").clientHeight / 2), 0, tween6_1, "story6"), 

        this.createScene("story7", -1 * (document.getElementById("story7").clientHeight / 2), 0, tween7, "story7"),
        this.updateBind()
    },
    createScene: function(e, t, s, o, n) {
        var e = new ScrollMagic.Scene({
            triggerElement: "#" + n,
            triggerHook: "onLeave",
            offset: t,
            duration: s,
            reverse: !0
        }).setTween(o).addTo(this.controller);
        e.indicator = n, e.ch = document.getElementById(n).clientHeight, e.id = document.getElementById(n), e.index = i, this.scenes.push(e)
    },
    updateFixedValues: function() {
       
                for(this.scenes[0].duration(document.getElementById("story1").clientHeight-window.innerHeight),
                 this.scenes[1].offset(document.getElementById("story1").clientHeight/4),
                  this.scenes[1].duration(document.getElementById("story1").clientHeight-1.25*window.innerHeight),
                    this.scenes[2].duration(2*document.getElementById("s1_text2").clientHeight),
                    this.scenes[3].offset(-1 * (document.getElementById("story1").clientHeight )),
                    this.scenes[4].offset(-1 * (document.getElementById("story6").clientHeight-1.25*window.innerHeight)),
                    this.scenes[4].duration(document.getElementById("s1_text2").clientHeight),
                    this.scenes[5].offset(-1 * (document.getElementById("story6").clientHeight )),
                    this.scenes[6].offset(-1 * (document.getElementById("story6").clientHeight )),
                     this.scenes[6].duration(1.5 * document.getElementById("story6").clientHeight),
                      this.scenes[7].offset(-1 * (document.getElementById("story7").clientHeight )), i = 0; i < this.scenes.length; i++) this.scenes[i].refresh(), this.scenes[i].update(!0)
                 this.updateBind();
    }
}, castncrewView = function(e) {
    this.dispatcher = void 0 !== e ? e : new Dispatcher, this.device = Detectizr.device.type, this.controller = new ScrollMagic.Controller, this.label, this.split = !0, this.sections = [], this.scenes = [], this.bodyPos = 0
}, castncrewView.prototype = {
    constructor: castncrewView,
    init: function() {
        this.bindEvents()
    },
    bindEvents: function() {
        this.completeEvent = this.dispatcher.addEventlistener("AM_COMPLETE_G", this.populate.bind(this))
    },
    populate: function() {
        if ("desktop" === this.device || "tablet" === this.device)
            for ($("#castncrew-header").html('<div class="cover"><img src="' + 
                data.castncrew.header.desktopBackgroundImage +
                 '" class="cover" /><h1 id="castncrew-header-text">' + 
                 data.castncrew.header.text + '</h1><img src="' + 
                 data.castncrew.header.desktopForegroundImage + '" class="cover" /></div>'), i = 0; i < data.castncrew.list.length; i++)
                this.sections.push("cnc_" + data.castncrew.list[i].label), "half" == data.castncrew.list[i].type ? (this.split && $("#castncrew-list").append('<li class="cnc_split"></li>'),
                this.split = !1, $(".cnc_split").append('<div id="cnc_' + data.castncrew.list[i].label + '" class="cnc_' + data.castncrew.list[i].type + '"><div class="cover cnc_cover"><img src="' + 
                    app.preloader.getAsset(data.castncrew.list[i].desktopImage).src + '" class="cover" /></div><div class="cnc_text_container"><div class="cnc_text"><h1 class="cnc_actor">' + 
                    data.castncrew.list[i].name + '</h1><h1 class="cnc_character">' + 
                    data.castncrew.list[i].role + '</h1><div class="cnc_btn btn_scroll" data-bio="' + 
                    data.castncrew.list[i].label + '"><div class="btn_scroll_outer"><div class="btn_scroll_middle"><div class="btn_scroll_inner"></div></div> </div><h1 class="btn_scroll_text">Bio</h1></div></div>')) : 
                    $("#castncrew-list").append('<li id="cnc_' + data.castncrew.list[i].label + '"><div class="cover cnc_cover"><img src="' + 
                    app.preloader.getAsset(data.castncrew.list[i].desktopImage).src + '" class="cover" /></div><div class="cnc_text_container"><div class="cnc_text"><h1 class="cnc_actor">' + 
                    data.castncrew.list[i].name + '</h1><p>is</p><h1 class="cnc_character">' + 
                    data.castncrew.list[i].role + '</h1><div class="cnc_btn btn_scroll" data-bio="' + 
                    data.castncrew.list[i].label + '"><div class="btn_scroll_outer"><div class="btn_scroll_middle"><div class="btn_scroll_inner"></div></div></div><h1 class="btn_scroll_text">Bio</h1></div></div></div></li>');
        
        else if ("mobile" === this.device)
            for ($("#castncrew-header").html('<div class="cover"><img src="' + 
            data.castncrew.header.mobileBackgroundImage + '" class="cover" /><h1 id="castncrew-header-text">' +
            data.castncrew.header.text + '</h1><img src="' + data.castncrew.header.mobileForegroundImage + '" class="cover" /></div>'), i = 0; i < data.castncrew.list.length; i++)
            this.sections.push("cnc_" + data.castncrew.list[i].label), "half" == data.castncrew.list[i].type ? $("#castncrew-list").append('<li id="cnc_' + data.castncrew.list[i].label + '"><div class="cover"><img src="' + 
                app.preloader.getAsset(data.castncrew.list[i].mobileImage).src + '" class="cover" /></div><div class="cnc_text_container"><div class="cnc_text"><h1 class="cnc_actor">' + 
                data.castncrew.list[i].name + '</h1></br></br> <h1 class="cnc_character">' + data.castncrew.list[i].role + 
                '</h1><div class="cnc_btn" data-bio="' + data.castncrew.list[i].label + '"><img src="img/btn_bio.png"></div></div></div></li>') : 
                $("#castncrew-list").append('<li id="cnc_' + data.castncrew.list[i].label + '"><div class="cover"><img src="' + 
                app.preloader.getAsset(data.castncrew.list[i].mobileImage).src + '" class="cover" /></div><div class="cnc_text_container"><div class="cnc_text"><h1 class="cnc_actor">' + 
                data.castncrew.list[i].name + '</h1><p>is</p><h1 class="cnc_character">' + 
                data.castncrew.list[i].role + '</h1><div class="cnc_btn" data-bio="' + 
                data.castncrew.list[i].label + '"><img src="img/btn_bio.png"></div></div></div></li>');

        $("#cnc_close").mouseenter(function() {
            TweenMax.set($(this).find(".close-outer"), {
                transformOrigin: "50% 50%"
            }), TweenMax.set($(this).find(".close-inner"), {
                transformOrigin: "50% 50%"
            }), TweenMax.set($(this).find(".close-img"), {
                transformOrigin: "50% 50%"
            }), TweenMax.to($(this).find(".close-outer"), .25, {
                scale: 1.2,
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".close-inner"), .25, {
                scale: 1.15,
                border: "1px solid rgba(255, 254, 237, 0.75)",
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".close-img"), .4, {
                rotation: 90,
                ease: Power3.easeOut
            })
        }).mouseleave(function() {
            TweenMax.to($(this).find(".close-outer"), .25, {
                scale: 1,
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".close-inner"), .25, {
                scale: 1,
                border: "1px solid rgba(255, 254, 237, 0.2)",
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".close-img"), .4, {
                rotation: 0,
                ease: Power3.easeOut
            })
        }), $(".cnc_btn").click(this.show), $("#cnc_close").click(this.hide), $(".btn_scroll").mouseenter(function() {
            TweenMax.to($(this).parents("li").find(".cnc_cover"), .55, {
                opacity: .5,
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".btn_scroll_outer"), .35, {
                scale: 1.1,
                delay: .05,
                ease: Power2.easeInOut
            }), TweenMax.to($(this).find(".btn_scroll_middle"), .25, {
                scale: 1.05,
                opacity: .9,
                ease: Power2.easeInOut
            }), TweenMax.to($(this).find(".btn_scroll_inner"), .25, {
                scale: 1.1,
                ease: Power2.easeInOut
            })
        }).mouseleave(function() {
            TweenMax.to($(this).parents("li").find(".cnc_cover"), .55, {
                opacity: 1,
                ease: Power3.easeOut
            }), TweenMax.to($(this).find(".btn_scroll_outer"), .5, {
                scale: 1,
                ease: Power2.easeInOut
            }), TweenMax.to($(this).find(".btn_scroll_middle"), .35, {
                scale: 1,
                opacity: .75,
                delay: .1,
                ease: Power2.easeInOut
            }), TweenMax.to($(this).find("#btn_scroll_inner"), .35, {
                scale: 1,
                delay: .15,
                ease: Power2.easeInOut
            })
        }), this.createScene("cnc_tomcruise", 2), this.createScene("cnc_domhallgleeson", 1), this.createScene("cnc_sarahwright", 1), this.createScene("cnc_dougliman", 1), this.createScene("cnc_garyspinelli", 1)
    },
    createScene: function(e, t) {
        var e = new ScrollMagic.Scene({
            triggerElement: "#" + e,
            triggerHook: "onLeave",
            offset: -1 * document.getElementById(e).clientHeight / t,
            duration: 3 * document.getElementById(e).clientHeight,
            reverse: !0
        }).setTween(TweenMax.fromTo($("#" + e).find(".cnc_cover img"), 1, {
            transform: "translateY(-50px)"
        }, {
            transform: "translateY(50px)"
        })).addTo(this.controller);
        e.indicator = e, e.index = i, this.scenes.push(e)
    },
    show: function() {
    

                
        for ($("body").addClass("noscroll"), "desktop" !== this.device && (app.bodyPos = $("body").scrollTop()),

        this.label = $(this).data("bio"), document.getElementById("cnc_container").scrollTop = 0, i = 0; i < data.castncrew.list.length; i++) 
        this.label == data.castncrew.list[i].label && ($("#cnc_header h1").html(data.castncrew.list[i].name),
        $("#cnc_text").html("<p>" + data.castncrew.list[i].text  + "</p>"),

   
        $("#cnc_image1").attr("src", app.preloader.getAsset(data.castncrew.list[i].video).src ),

        $("#cnc_char").css("background-image", "url(" + app.preloader.getAsset(data.castncrew.list[i].overlayImage).src + ")")) ;

        TweenMax.set($("#cnc_overlay"), {
            visibility: "visible",
            onComplete: function() {
                $("body").addClass("noscroll")
            }.bind(this)
        }), TweenMax.fromTo($("#cnc_overlay"), .75, {
            left: "-100vw"
        }, {
            left: "0vw",
            ease: Power3.easeOut
        }), TweenMax.fromTo($("#cnc_char"), .75, {
            left: "-60%"
        }, {
            left: "0%",
            ease: Power2.easeOut
        })
    },
    hide: function() {

        $("body").removeClass("noscroll"), "desktop" !== this.device && $("body").scrollTop(app.bodyPos), TweenMax.fromTo($("#cnc_char"), .75, {
            left: "0%"
        }, {
            left: "-60%",
            ease: Power2.easeOut
        }), TweenMax.fromTo($("#cnc_overlay"), .75, {
            left: "0vw"
        }, {
            left: "-100vw",
            ease: Power3.easeOut,
            onComplete: function() {
                $("body").removeClass("noscroll"), TweenMax.set($("#cnc_overlay"), {
                    visibility: "hidden"
                })
            }.bind(this)
        })
    }
}, galleryView = function(e) {
    this.dispatcher = void 0 !== e ? e : new Dispatcher, this.device = Detectizr.device.type
}, galleryView.prototype = {
    constructor: galleryView,
    init: function() {
        this.bindEvents()
    },
    populate: function() {
      
    },
    bindEvents: function() {
        this.completeEvent = this.dispatcher.addEventlistener("AM_COMPLETE_G", this.populate.bind(this))
    }
}, videosView = function(e) {
    this.dispatcher = void 0 !== e ? e : new Dispatcher, this.device = Detectizr.device.type
}, videosView.prototype = {
    constructor: videosView,
    init: function() {
        this.bindEvents()
    },
    populate: function() {
        if ("mobile" == this.device)
            for ($("#videos_bg img").attr("src", "img/videos_mobile_bg.jpg"), i = 0; i < data.videos.list.length; i++) data.videos.list[i].show && $("#videos-list").append('<li class="video_active"><div class="video_border"></div><div class="video_label"><h1>' + data.videos.list[i].name + '</h1></div><img class="video_btn_out" src="img/arrow_trailer_out.svg" /><div class="video_btn_over"><img class="video_arrow" src="img/arrow_trailer_over.svg" /></div><img class="video_poster" src="' + data.videos.list[i].poster + '" /></li>');
        else
            for (i = 0; i < data.videos.list.length; i++) data.videos.list[i].show ? $("#videos-list").append('<li class="video_active"><div class="video_border"></div><div class="video_label"><h1>' + data.videos.list[i].name + '</h1></div><img class="video_btn_out" src="img/arrow_trailer_out.svg" /><div class="video_btn_over"><img class="video_arrow" src="img/arrow_trailer_over.svg" /></div><video class="video_video" loop muted poster="' + data.videos.list[i].poster + '"><source src="' + data.videos.list[i].video + '" type="video/mp4"></video></li>') : $("#videos-list").append('<li class="video_hidden"><div></div></li>');
        this.attachEventListeners()
    },
    bindEvents: function() {
        this.completeEvent = this.dispatcher.addEventlistener("AM_COMPLETE_G", this.populate.bind(this))
    },
    attachEventListeners: function() {
        $("#videos-list li").mouseenter(function(e) {
            $(this).hasClass("video_hidden") === !1 && $(this).find(".video_video").get(0).play(), TweenMax.set($(this).find(".video_btn_over"), {
                transformOrign: "50% 50%"
            }), TweenMax.to($(this).find(".video_border"), .25, {
                "border-width": "8px",
                ease: Power4.easeOut
            }), TweenMax.to($(this).find(".video_btn_over"), .15, {
                scale: 1,
                ease: Power4.easeOut
            }), TweenMax.to($(this).find(".video_btn_over img"), .15, {
                x: 34,
                delay: .15,
                ease: Power4.easeOut
            })
        }).mouseleave(function() {
            $(this).hasClass("video_hidden") === !1 && $(this).find(".video_video").get(0).pause(), TweenMax.to($(this).find(".video_border"), .25, {
                "border-width": "5px",
                ease: Power4.easeOut
            }), TweenMax.to($(this).find(".video_btn_over img"), .15, {
                x: 0,
                ease: Power4.easeOut
            }), TweenMax.to($(this).find(".video_btn_over"), .15, {
                scale: 0,
                delay: .15,
                ease: Power4.easeOut
            })
        }), $("#videos-list li.video_active").click(function() {
            var e = Array.prototype.slice.call(document.getElementById("videos-list").children),
                t = e.indexOf(this);
            switch (t) {
                case 0:
                    console.log(0), app.dispatcher.dispatch("CUE_PLAYLIST_INDEX", 0);
                    break;
                case 1:
                    console.log(1), app.dispatcher.dispatch("CUE_PLAYLIST_INDEX", 1);
                    break;
                case 2:
                    console.log(2), app.dispatcher.dispatch("CUE_PLAYLIST_INDEX", 2);
                    break;
                case 3:
                    console.log(3), app.dispatcher.dispatch("CUE_PLAYLIST_INDEX", 5);
                    break;
                case 4:
                    console.log(4), app.dispatcher.dispatch("CUE_PLAYLIST_INDEX", 6);
                    break;
                case 5:
                    console.log(5), app.dispatcher.dispatch("CUE_PLAYLIST_INDEX", 11)
            }
            app.dispatcher.dispatch("SHOW_TRAILER")
        })
    }
}, ticketsView = function(e) {
    this.dispatcher = void 0 !== e ? e : new Dispatcher, this.device = Detectizr.device.type
}, ticketsView.prototype = {
    constructor: ticketsView,
    init: function() {
        this.bindEvents()
    },
    populate: function() {
      
    },
    bindEvents: function() {
        this.completeEvent = this.dispatcher.addEventlistener("AM_COMPLETE_G", this.populate.bind(this))
    }
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJ2aWV3cy5taW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaG9tZVZpZXcgPSBmdW5jdGlvbihlLCB0KSB7XG4gICAgdGhpcy5jb250YWluZXIgPSBlLCB0aGlzLmRpc3BhdGNoZXIgPSB2b2lkIDAgIT09IHQgPyB0IDogbmV3IERpc3BhdGNoZXIsIHRoaXMuZGV2aWNlID0gRGV0ZWN0aXpyLmRldmljZS50eXBlLCB0aGlzLnNlY3Rpb25zID0gW1wiaG9tZVwiLCBcInN0b3J5XCIsIFwiY2FzdG5jcmV3XCIsIFwiZ2FsbGVyeVwiLCBcInZpZGVvc1wiLCBcInRpY2tldHNcIl1cbn0sIGhvbWVWaWV3LnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogaG9tZVZpZXcsXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hlci5kaXNwYXRjaChcIkFOQUxZVElDU1wiLCB7XG4gICAgICAgICAgICBoaXRUeXBlOiBcInBhZ2V2aWV3XCIsXG4gICAgICAgICAgICBwYWdlOiBcInd3dy5teWxpbmtcIlxuICAgICAgICB9KSwgdGhpcy5kaXNwYXRjaGVyLmRpc3BhdGNoKFwiQU5BTFlUSUNTXCIsIHtcbiAgICAgICAgICAgIGhpdFR5cGU6IFwiZXZlbnRcIixcbiAgICAgICAgICAgIGV2ZW50Q2F0ZWdvcnk6IFwiVmlkZW9zXCIsXG4gICAgICAgICAgICBldmVudEFjdGlvbjogXCJwbGF5XCIsXG4gICAgICAgICAgICBldmVudExhYmVsOiBcIkZhbGwgQ2FtcGFpZ25cIlxuICAgICAgICB9KSwgdGhpcy5hZGRZb3V0dWJlVmlkZW8oKSwgXCJtb2JpbGVcIiAhPSBEZXRlY3RpenIuZGV2aWNlLnR5cGUgPyB0aGlzLmluaXRQcmVsb2FkKCkgOiAodGhpcy5pbml0UHJlbG9hZE1vYmlsZSgpLCAkKFwiI3NwbGFzaFwiKS5zaG93KCksICQoXCJib2R5XCIpLnJlbW92ZUNsYXNzKFwibm9zY3JvbGxcIiksIFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNwbGFzaF90cmFpbGVyXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFwcC5kaXNwYXRjaGVyLmRpc3BhdGNoKFwiU0hPV19UUkFJTEVSXCIpXG4gICAgICAgIH0pLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNwbGFzaF90cmFpbGVyMlwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBhcHAuZGlzcGF0Y2hlci5kaXNwYXRjaChcIlNIT1dfVFJBSUxFUlwiKVxuICAgICAgICB9KSxcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzcGxhc2hfdHJhaWxlcjNcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYXBwLmRpc3BhdGNoZXIuZGlzcGF0Y2goXCJTSE9XX1RSQUlMRVJcIilcbiAgICAgICAgfSksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3BsYXNoX3RyYWlsZXI0XCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFwcC5kaXNwYXRjaGVyLmRpc3BhdGNoKFwiU0hPV19UUkFJTEVSXCIpXG4gICAgICAgIH0pKSxcbiAgICAgICAgXCJkZXNrdG9wXCIgIT09IGFwcC5kZXZpY2UgJiYgXCJzYWZhcmlcIiA9PSBhcHAuYnJvd3NlciAmJiB0aGlzLm9uSU9TZGV2aWNlKGFwcC5kZXZpY2UpXG4gICAgfSxcbiAgICBvblNwbGFzaEhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIGFwcC5vblNjcm9sbCwgITEpLCAkKFwiI3NwbGFzaFwiKS5oaWRlKCksIHRoaXMuaW5pdFByZWxvYWQoKSwgJChcImJvZHlcIikucmVtb3ZlQ2xhc3MoXCJub3Njcm9sbFwiKVxuICAgIH0sXG4gICAgb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgIHRoaXMucG9wdWxhdGUoKSwgd2luZG93LnNjcm9sbFRvKDAsIDApXG4gICAgfSxcbiAgICBvbkludHJvQ29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHAucHJlbG9hZGVyLnN0YXJ0TG9hZCgpXG4gICAgfSxcblxuICAgIHByZXZlbnRTY3JvbGw6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpLCBlLnN0b3BQcm9wYWdhdGlvbigpXG4gICAgfSxcbiAgICBwb3B1bGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBkYXRhLmhvbWUudG91dC5sZW5ndGg7IGkrKykgJChcIiN0b3V0c1wiKS5hcHBlbmQoJzxsaSBjbGFzcz1cInRvdXRcIiBpZD1cInRvdXQnICsgKGkgKyAxKSArICdcIj48YSBocmVmPVwiJyArIGRhdGEuaG9tZS50b3V0W2ldLmxpbmsgKyAnXCIgdGFyZ2V0PVwiX2JsYW5rXCI+IDxkaXYgY2xhc3M9XCJ0b3V0X2JvcmRlclwiPjwvZGl2PiA8aW1nIHNyYz1cIicgKyBkYXRhLmhvbWUudG91dFtpXS5pbWcgKyAnXCIgLz4gIDxkaXYgY2xhc3M9XCJ0b3V0X2lubmVyXCI+PGgxPicgKyBkYXRhLmhvbWUudG91dFtpXS5sYWJlbCArIFwiPC9oMT48L2Rpdj48L2E+PC9saT5cIik7XG5cbiAgICAgICAgVHdlZW5NYXguZGVsYXllZENhbGwoMSwgdGhpcy5ob21lQW5pbWF0ZS5iaW5kKHRoaXMpKSwgdGhpcy5iaW5kRXZlbnRzKClcbiAgICB9LFxuICAgIGhvbWVBbmltYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3V0X3ZpZGVvXCIpLnBsYXkoKTtcbiAgICAgICAgdmFyIGUgPSBuZXcgVGltZWxpbmVNYXg7XG4gICAgICAgIGUuc2V0KCQoXCIjYnRuX3Njcm9sbF9vdXRlclwiKSwge1xuICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ246IFwiNTAlIDUwJVwiXG4gICAgICAgIH0pLnNldCgkKFwiI2J0bl9zY3JvbGxfbWlkZGxlXCIpLCB7XG4gICAgICAgICAgICB0cmFuc2Zvcm1PcmlnbjogXCI1MCUgNTAlXCJcbiAgICAgICAgfSkuc2V0KCQoXCIjYnRuX3Njcm9sbF9pbm5lclwiKSwge1xuICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ246IFwiNTAlIDUwJVwiXG4gICAgICAgIH0pLmZyb21UbygkKFwiI2J0bl9zY3JvbGxfb3V0ZXJcIiksIC41LCB7XG4gICAgICAgICAgICBzY2FsZTogMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgICAgIGVhc2U6IEJhY2suZWFzZU91dC5jb25maWcoMilcbiAgICAgICAgfSwgXCJncnBcIikuZnJvbVRvKCQoXCIjYnRuX3Njcm9sbF9taWRkbGVcIiksIC4zNSwge1xuICAgICAgICAgICAgc2NhbGU6IDBcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgc2NhbGU6IDEsXG4gICAgICAgICAgICBkZWxheTogLjEsXG4gICAgICAgICAgICBlYXNlOiBCYWNrLmVhc2VPdXQuY29uZmlnKDIpXG4gICAgICAgIH0sIFwiZ3JwXCIpLmZyb21UbygkKFwiI2J0bl9zY3JvbGxfaW5uZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgc2NhbGU6IDBcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgc2NhbGU6IDEsXG4gICAgICAgICAgICBkZWxheTogLjMsXG4gICAgICAgICAgICBlYXNlOiBDaXJjLmVhc2VPdXRcbiAgICAgICAgfSwgXCJncnBcIikuZnJvbVRvKCQoXCIjYnRuX3Njcm9sbF90ZXh0XCIpLCAuMjUsIHtcbiAgICAgICAgICAgIHk6IDIwLFxuICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICB5OiAxMCxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBkZWxheTogLjUsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjIuZWFzZU91dCxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgJChcIiNidG5fc2Nyb2xsXCIpLm1vdXNlZW50ZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIFR3ZWVuTWF4LmZyb21UbygkKFwiI2J0bl9zY3JvbGxfdGV4dFwiKSwgLjUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IDEwXG4gICAgICAgICAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IDUsXG4gICAgICAgICAgICAgICAgICAgICAgICBlYXNlOiBDaXJjLmVhc2VJbk91dFxuICAgICAgICAgICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJChcIiNidG5fc2Nyb2xsX2RpdmlkZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xpcDogXCJyZWN0KDBweCwgMTBweCwgMXB4LCAwcHgpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogLjEsXG4gICAgICAgICAgICAgICAgICAgICAgICBlYXNlOiBDaXJjLmVhc2VJbk91dFxuICAgICAgICAgICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJChcIiNidG5fc2Nyb2xsX291dGVyXCIpLCAuMzUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAxLjEsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogLjA1LFxuICAgICAgICAgICAgICAgICAgICAgICAgZWFzZTogUG93ZXIyLmVhc2VJbk91dFxuICAgICAgICAgICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJChcIiNidG5fc2Nyb2xsX21pZGRsZVwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogMS4wNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IC45LFxuICAgICAgICAgICAgICAgICAgICAgICAgZWFzZTogUG93ZXIyLmVhc2VJbk91dFxuICAgICAgICAgICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJChcIiNidG5fc2Nyb2xsX2lubmVyXCIpLCAuMjUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAxLjEsXG4gICAgICAgICAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjIuZWFzZUluT3V0XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSkubW91c2VsZWF2ZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgVHdlZW5NYXgudG8oJChcIiNidG5fc2Nyb2xsX2RpdmlkZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xpcDogXCJyZWN0KDBweCwgNXB4LCAxcHgsIDVweClcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2U6IENpcmMuZWFzZUluT3V0XG4gICAgICAgICAgICAgICAgICAgIH0pLCBUd2Vlbk1heC5mcm9tVG8oJChcIiNidG5fc2Nyb2xsX3RleHRcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgeTogNVxuICAgICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB5OiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiAuMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2U6IENpcmMuZWFzZUluT3V0XG4gICAgICAgICAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKFwiI2J0bl9zY3JvbGxfb3V0ZXJcIiksIC41LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMi5lYXNlSW5PdXRcbiAgICAgICAgICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQoXCIjYnRuX3Njcm9sbF9taWRkbGVcIiksIC4zNSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAuNzUsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogLjEsXG4gICAgICAgICAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjIuZWFzZUluT3V0XG4gICAgICAgICAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKFwiI2J0bl9zY3JvbGxfaW5uZXJcIiksIC4zNSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogLjE1LFxuICAgICAgICAgICAgICAgICAgICAgICAgZWFzZTogUG93ZXIyLmVhc2VJbk91dFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJ0bl9zY3JvbGxcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBUd2Vlbk1heC50bygkKFwiYm9keVwiKSwgMSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG86IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiB3aW5kb3cuaW5uZXJIZWlnaHQgKiAxLjFcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjQuZWFzZUluT3V0XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgIH0sIFwiZ3JwXCIpO1xuICAgICAgICB2YXIgdCA9IG5ldyBUaW1lbGluZU1heCh7XG4gICAgICAgICAgICBkZWxheTogMixcbiAgICAgICAgICAgIHJlcGVhdDogLTFcbiAgICAgICAgfSk7XG4gICAgICAgIHQuc3RhZ2dlckZyb21UbygkKFwiI2J0bl9zY3JvbGxfYXJyb3dzIGltZ1wiKSwgLjE1LCB7XG4gICAgICAgICAgICB5OiAtMyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICB9LCAuMDUpLnN0YWdnZXJGcm9tVG8oJChcIiNidG5fc2Nyb2xsX2Fycm93cyBpbWdcIiksIC4xNSwge1xuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgeTogMyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICBkZWxheTogMS41LFxuICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgfSwgLjA1KTtcbiAgICAgICAgdmFyIHMgPSBuZXcgVGltZWxpbmVNYXgoe1xuICAgICAgICAgICAgcmVwZWF0OiAtMVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgfSxcbiAgICBpbml0UHJlbG9hZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGFwcC5wcmVsb2FkZXIgPSBuZXcgQXNzZXRNYW5hZ2VyKHNldHRpbmdzLmluaXRpYWxNYW5pZmVzdCwgYXBwLmRpc3BhdGNoZXIpLCB0aGlzLmRpc3BhdGNoZXIuYWRkRXZlbnRsaXN0ZW5lcihcIkFNX0NPTVBMRVRFX0dcIiwgdGhpcy5vbkxvYWRDb21wbGV0ZS5iaW5kKHRoaXMpKSwgdGhpcy5kaXNwYXRjaGVyLmFkZEV2ZW50bGlzdGVuZXIoXCJJTlRST19ET05FX0VWRU5UXCIsIHRoaXMub25JbnRyb0NvbXBsZXRlLmJpbmQodGhpcykpLCB0aGlzLnByZWxvYWRWaWV3ID0gbmV3IFByZWxvYWRWaWV3KGFwcC5kaXNwYXRjaGVyKSwgdGhpcy5wcmVsb2FkVmlldy5pbnRybygpXG4gICAgfSxcbiAgICBpbml0UHJlbG9hZE1vYmlsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgIGFwcC5wcmVsb2FkZXIgPSBuZXcgQXNzZXRNYW5hZ2VyKHNldHRpbmdzbW9iaWxlLmluaXRpYWxNYW5pZmVzdCwgYXBwLmRpc3BhdGNoZXIpLCB0aGlzLmRpc3BhdGNoZXIuYWRkRXZlbnRsaXN0ZW5lcihcIkFNX0NPTVBMRVRFX0dcIiwgdGhpcy5vbkxvYWRDb21wbGV0ZS5iaW5kKHRoaXMpKSwgdGhpcy5kaXNwYXRjaGVyLmFkZEV2ZW50bGlzdGVuZXIoXCJJTlRST19ET05FX0VWRU5UXCIsIHRoaXMub25JbnRyb0NvbXBsZXRlLmJpbmQodGhpcykpLCB0aGlzLnByZWxvYWRWaWV3ID0gbmV3IFByZWxvYWRWaWV3KGFwcC5kaXNwYXRjaGVyKSwgdGhpcy5wcmVsb2FkVmlldy5pbnRybygpXG4gICAgfSxcbiAgICBiaW5kRXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuc2VjdGlvbnMubGVuZ3RoOyBpKyspIFR3ZWVuTWF4LnNldCgkKFwiI25hdi1cIiArIHRoaXMuc2VjdGlvbnNbaV0gKyBcIiAubmF2LW1hcmdpbi10b3BcIiksIHtcbiAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIDBweCwgMXB4LCAwcHgpXCJcbiAgICAgICAgfSksIFR3ZWVuTWF4LnNldCgkKFwiI25hdi1cIiArIHRoaXMuc2VjdGlvbnNbaV0gKyBcIiAubmF2LW1hcmdpbi1ib3R0b21cIiksIHtcbiAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIDBweCwgMXB4LCBcIiArICQoXCIjbmF2LVwiICsgdGhpcy5zZWN0aW9uc1tpXSkud2lkdGgoKSArIFwicHgpXCJcbiAgICAgICAgfSk7XG4gICAgICAgICQoXCIubmF2YmFyLW1haW4gbGlcIikubW91c2VlbnRlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5uYXYtbWFyZ2luLXRvcFwiKSwgLjM1LCB7XG4gICAgICAgICAgICAgICAgY2xpcDogXCJyZWN0KDBweCwgXCIgKyAoKHRoaXMub2Zmc2V0V2lkdGggLSA0MCkgLyAyICsgNSkgKyBcInB4LCAxcHgsIDBweClcIixcbiAgICAgICAgICAgICAgICBlYXNlOiBDaXJjLmVhc2VJblxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5uYXYtbWFyZ2luLXRvcFwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgY2xpcDogXCJyZWN0KDBweCwgXCIgKyAoKHRoaXMub2Zmc2V0V2lkdGggLSA0MCkgLyAyICsgNSkgKyBcInB4LCAxcHgsIFwiICsgKCh0aGlzLm9mZnNldFdpZHRoIC0gNDApIC8gMiAtIDUpICsgXCJweClcIixcbiAgICAgICAgICAgICAgICBkZWxheTogLjM1LFxuICAgICAgICAgICAgICAgIGVhc2U6IENpcmMuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5uYXYtbWFyZ2luLWJvdHRvbVwiKSwgLjM1LCB7XG4gICAgICAgICAgICAgICAgY2xpcDogXCJyZWN0KDBweCwgXCIgKyAodGhpcy5vZmZzZXRXaWR0aCAtIDQwKSArIFwicHgsIDFweCwgXCIgKyAoKHRoaXMub2Zmc2V0V2lkdGggLSA0MCkgLyAyIC0gNSkgKyBcInB4KVwiLFxuICAgICAgICAgICAgICAgIGVhc2U6IENpcmMuZWFzZUluXG4gICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiLm5hdi1tYXJnaW4tYm90dG9tXCIpLCAuMjUsIHtcbiAgICAgICAgICAgICAgICBjbGlwOiBcInJlY3QoMHB4LCBcIiArICgodGhpcy5vZmZzZXRXaWR0aCAtIDQwKSAvIDIgKyA1KSArIFwicHgsIDFweCwgXCIgKyAoKHRoaXMub2Zmc2V0V2lkdGggLSA0MCkgLyAyIC0gNSkgKyBcInB4KVwiLFxuICAgICAgICAgICAgICAgIGRlbGF5OiAuMzUsXG4gICAgICAgICAgICAgICAgZWFzZTogQ2lyYy5lYXNlT3V0XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KS5tb3VzZWxlYXZlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiLm5hdi1tYXJnaW4tdG9wXCIpLCAuMzUsIHtcbiAgICAgICAgICAgICAgICBjbGlwOiBcInJlY3QoMHB4LCBcIiArICh0aGlzLm9mZnNldFdpZHRoIC0gNDApICsgXCJweCwgMXB4LCBcIiArICgodGhpcy5vZmZzZXRXaWR0aCAtIDQwKSAvIDIgLSA1KSArIFwicHgpXCIsXG4gICAgICAgICAgICAgICAgZWFzZTogQ2lyYy5lYXNlSW5cbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIubmF2LW1hcmdpbi10b3BcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIFwiICsgKHRoaXMub2Zmc2V0V2lkdGggLSA0MCkgKyBcInB4LCAxcHgsIFwiICsgKHRoaXMub2Zmc2V0V2lkdGggLSA0MCkgKyBcInB4KVwiLFxuICAgICAgICAgICAgICAgIGRlbGF5OiAuMzUsXG4gICAgICAgICAgICAgICAgZWFzZTogQ2lyYy5lYXNlT3V0XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXguc2V0KCQodGhpcykuZmluZChcIi5uYXYtbWFyZ2luLXRvcFwiKSwge1xuICAgICAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIDBweCwgMXB4LCAwcHgpXCIsXG4gICAgICAgICAgICAgICAgZGVsYXk6IC42XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiLm5hdi1tYXJnaW4tYm90dG9tXCIpLCAuMzUsIHtcbiAgICAgICAgICAgICAgICBjbGlwOiBcInJlY3QoMHB4LCBcIiArICgodGhpcy5vZmZzZXRXaWR0aCAtIDQwKSAvIDIgKyA1KSArIFwicHgsIDFweCwgMHB4KVwiLFxuICAgICAgICAgICAgICAgIGVhc2U6IENpcmMuZWFzZUluXG4gICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiLm5hdi1tYXJnaW4tYm90dG9tXCIpLCAuMjUsIHtcbiAgICAgICAgICAgICAgICBjbGlwOiBcInJlY3QoMHB4LCAwcHgsIDFweCwgMHB4KVwiLFxuICAgICAgICAgICAgICAgIGRlbGF5OiAuMzUsXG4gICAgICAgICAgICAgICAgZWFzZTogQ2lyYy5lYXNlT3V0XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXguc2V0KCQodGhpcykuZmluZChcIi5uYXYtbWFyZ2luLWJvdHRvbVwiKSwge1xuICAgICAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIDBweCwgMXB4LCBcIiArICh0aGlzLm9mZnNldFdpZHRoIC0gNDApICsgXCJweClcIixcbiAgICAgICAgICAgICAgICBkZWxheTogLjZcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLCAgJChcIiN0b3V0X3RyYWlsZXJcIikubW91c2VlbnRlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFR3ZWVuTWF4LnNldCgkKFwiI3RvdXRfdHJhaWxlcl9idG5fb3ZlclwiKSwge1xuICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9yaWduOiBcIjUwJSA1MCVcIlxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi50b3V0X2JvcmRlclwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgXCJib3JkZXItd2lkdGhcIjogXCI0cHhcIixcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjQuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIiN0b3V0X3RyYWlsZXJfYnRuX292ZXJcIiksIC4xNSwge1xuICAgICAgICAgICAgICAgIHNjYWxlOiAxLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyNC5lYXNlT3V0XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiI3RvdXRfdHJhaWxlcl9idG5fb3ZlciBpbWdcIiksIC4xNSwge1xuICAgICAgICAgICAgICAgIHg6IDM0LFxuICAgICAgICAgICAgICAgIGRlbGF5OiAuMTUsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXI0LmVhc2VPdXRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLm1vdXNlbGVhdmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIudG91dF9ib3JkZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgIFwiYm9yZGVyLXdpZHRoXCI6IFwiMnB4XCIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXI0LmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIjdG91dF90cmFpbGVyX2J0bl9vdmVyIGltZ1wiKSwgLjE1LCB7XG4gICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjQuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIiN0b3V0X3RyYWlsZXJfYnRuX292ZXJcIiksIC4xNSwge1xuICAgICAgICAgICAgICAgIHNjYWxlOiAwLFxuICAgICAgICAgICAgICAgIGRlbGF5OiAuMTUsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXI0LmVhc2VPdXRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLCAkKFwiLnRvdXRcIikubW91c2VlbnRlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi50b3V0X2JvcmRlclwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgXCJib3JkZXItd2lkdGhcIjogXCI0cHhcIixcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjQuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LmZyb21UbygkKHRoaXMpLmZpbmQoXCJoMVwiKSwgLjIsIHtcbiAgICAgICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICB5OiA2LFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC5mcm9tVG8oJCh0aGlzKS5maW5kKFwiaDFcIiksIC4yLCB7XG4gICAgICAgICAgICAgICAgeTogLTYsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgICBkZWxheTogLjIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLm1vdXNlbGVhdmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIudG91dF9ib3JkZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgIFwiYm9yZGVyLXdpZHRoXCI6IFwiMnB4XCIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXI0LmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC5mcm9tVG8oJCh0aGlzKS5maW5kKFwiaDFcIiksIC4yLCB7XG4gICAgICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgeTogLTYsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LmZyb21UbygkKHRoaXMpLmZpbmQoXCJoMVwiKSwgLjIsIHtcbiAgICAgICAgICAgICAgICB5OiA2LFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgICAgZGVsYXk6IC4yLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH0sXG4gICBcbiAgICBhZGRZb3V0dWJlVmlkZW86IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZSA9IHtcbiAgICAgICAgICAgICAgICBwbGF5QnRuOiBcInl0LXBsYXl0b2dnbGVcIixcbiAgICAgICAgICAgICAgICBzY3J1YmJlcjogXCJ5dC1wcm9ncmVzcy1ob2xkZXJcIixcbiAgICAgICAgICAgICAgICBzb3VuZEJ0bjogXCJ5dC1zb3VuZHRvZ2dsZVwiLFxuICAgICAgICAgICAgICAgIHByZXZCdG46IFwieXQtcHJldmlvdXNcIixcbiAgICAgICAgICAgICAgICBuZXh0QnRuOiBcInl0LW5leHRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHQgPSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVySUQ6IFwidHJhaWxlcl9vdmVybGF5XCIsXG4gICAgICAgICAgICAgICAgaWQ6IFwiQUVCSUpSQWt1ak1cIixcbiAgICAgICAgICAgICAgICBjbG9zZUJ0bjogXCJ5dC1jbG9zZVwiLFxuICAgICAgICAgICAgICAgIGxpc3Q6ICEwLFxuICAgICAgICAgICAgICAgIGluZGV4OiAwLFxuICAgICAgICAgICAgICAgIHNob3dpbmZvOiAwLFxuICAgICAgICAgICAgICAgIGF1dG9wbGF5OiAwLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xzOiAwLFxuICAgICAgICAgICAgICAgIGxvb3A6IDEsXG4gICAgICAgICAgICAgICAgY3VzdG9tQ29udHJvbHM6ICEwLFxuICAgICAgICAgICAgICAgIGN1c3RvbUJhY2tncm91bmQ6ICEwLFxuICAgICAgICAgICAgICAgIGRpc3BhdGNoZXI6IGFwcC5kaXNwYXRjaGVyLFxuICAgICAgICAgICAgICAgIGN1c3RvbUJ1dHRvbnM6IGVcbiAgICAgICAgICAgIH07XG4gICAgICAgIHRoaXMueXQgPSBuZXcgVHJhaWxlcih0LCBhcHAuZGlzcGF0Y2hlciksIHRoaXMueXQuYWRkKCksIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmF2X3RyYWlsZXJcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXCJkZXNrdG9wXCIgIT09IHRoaXMuZGV2aWNlICYmICQoXCIubmF2YmFyLXRvZ2dsZVwiKS5jbGljaygpLCBhcHAuZGlzcGF0Y2hlci5kaXNwYXRjaChcIlNIT1dfVFJBSUxFUlwiKVxuICAgICAgICB9LmJpbmQodGhpcykpLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRvdXRfdHJhaWxlclwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBhcHAuZGlzcGF0Y2hlci5kaXNwYXRjaChcIlNIT1dfVFJBSUxFUlwiKVxuICAgICAgICB9KVxuICAgIH1cbn0sIFByZWxvYWRWaWV3ID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMudmggPSAtMSAqIHdpbmRvdy5pbm5lckhlaWdodCwgdGhpcy52aWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcmVsb2FkZXJcIiksIHRoaXMuY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJlbG9hZGVyLWNvbnRlbnRcIiksIHRoaXMuZGlzcGF0Y2hlciA9IHZvaWQgMCAhPT0gZSA/IGUgOiBuZXcgRGlzcGF0Y2hlciwgdGhpcy5kZXZpY2UgPSBEZXRlY3RpenIuZGV2aWNlLnR5cGUsIHRoaXMudGwgPSBuZXcgVGltZWxpbmVNYXgoe1xuICAgICAgICBkZWxheTogLjVcbiAgICB9KSwgdGhpcy5zcGxpdCA9IG5ldyBTcGxpdFRleHQoXCIjcHJlbG9hZGVyLXRleHRcIiwge1xuICAgICAgICB0eXBlOiBcImNoYXJzXCJcbiAgICB9KSwgdGhpcy5pbml0KClcbn0sIFByZWxvYWRWaWV3LnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogUHJlbG9hZFZpZXcsXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuYmluZEV2ZW50cygpLCB0aGlzLmludHJvKCksIGNoYXJzID0gdGhpcy5zcGxpdC5jaGFycywgJCgnI3ByZWxvYWRlcicpLmFkZENsYXNzKCdhbmltYXRpbmcnKSAsdGhpcy50bC5zZXQoJChcIiNwcmVsb2FkZXItaW5kaWNhdG9yXCIpLCB7XG4gICAgICAgICAgICBjbGlwOiBcInJlY3QoMHB4LCBcIiArICQoXCIjcHJlbG9hZGVyLWluZGljYXRvclwiKS53aWR0aCgpICogMiArIFwicHgsIDJweCwgXCIgKyAkKFwiI3ByZWxvYWRlci1pbmRpY2F0b3JcIikud2lkdGgoKSAqIDIgKyBcInB4KVwiXG4gICAgICAgIH0pLnNldCgkKFwiI3ByZWxvYWRlci1jb250ZW50IGgxXCIpLCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgIH0pLnRvKCQoXCIjcHJlbG9hZGVyLWluZGljYXRvclwiKSwgLjUsIHtcbiAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIFwiICsgJChcIiNwcmVsb2FkZXItaW5kaWNhdG9yXCIpLndpZHRoKCkgKyBcInB4LCAycHgsIDBweClcIixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMS5lYXNlSW5PdXRcbiAgICAgICAgfSkuc2V0KCQoXCIjcHJlbG9hZGVyLWluZGljYXRvci1iZ1wiKSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICB9KS5mcm9tVG8oJChcIiNwcmVsb2FkZXItdHQtMVwiKSwgMC45LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgeTogODBcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICB9LCBcImdycDFcIikuZnJvbVRvKCQoXCIjcHJlbG9hZGVyLXR0LTJcIiksIDIuMCwge1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIHk6IDgwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgZGVsYXk6IC4xLFxuICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgfSwgXCJncnAxXCIpLmZyb21UbygkKFwiI3ByZWxvYWRlci10dC0zXCIpLCAwLjcsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICB5OiAyMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIGRlbGF5OiAuMixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgIH0sIFwiZ3JwMVwiKS5mcm9tVG8oJChcIiNwcmVsb2FkZXItdHQtNFwiKSwgMS43LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgeTogNDBcbiAgICAgICAgfSx7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIGRlbGF5OiAuMixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgIH0sIFwiZ3JwMVwiKS5mcm9tVG8oJChcIiNwcmVsb2FkZXItdHQtNVwiKSwgMS4yLCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgeTogNTBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICBkZWxheTogLjIsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICB9LCBcImdycDFcIikuZnJvbVRvKCQoXCIjcHJlbG9hZGVyLXR0LTZcIiksIDAuOCwge1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIHk6IDYwXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgZGVsYXk6IC4yLFxuICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgfSwgXCJncnAxXCIpLmZyb21UbygkKFwiI3ByZWxvYWRlci10dC03XCIpLCAyLjUsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICB5OiA3MFxuICAgICAgICB9LCBcbiAgICAgICAge1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICBkZWxheTogLjIsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICB9LCBcImdycDFcIikuZnJvbVRvKCQoXCIjcHJlbG9hZGVyLXR0LThcIiksIDAuOSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIHk6IDgwXG4gICAgICAgIH0sICBcbiAgICAgICAgIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgZGVsYXk6IC4yLFxuICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgfSwgXCJncnAxXCIpLmZyb21UbygkKFwiI3ByZWxvYWRlci10dC05XCIpLCAwLjUsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICB5OiAtOTBcbiAgICAgICAgfSxcbiAgICAgICAgIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgZGVsYXk6IC4yLFxuICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgfSwgXCJncnAxXCIpLmZyb21UbygkKFwiI3ByZWxvYWRlci10dC0xMFwiKSwgMS43LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgeTogLTYwXG4gICAgICAgIH0sXG4gICAgICAgICB7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIGRlbGF5OiAuMixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgIH0sIFwiZ3JwMVwiKS5mcm9tVG8oJChcIiNwcmVsb2FkZXItdHQtMTFcIiksIDEuMSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIHk6IC04MFxuICAgICAgICB9LFxuICAgICAgICAge1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICBkZWxheTogLjIsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjQuZWFzZU91dFxuICAgICAgICB9LCBcImdycDFcIikuZnJvbVRvKCQoXCIjcHJlbG9hZGVyLXR0LTEyXCIpLCAyLjEsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICB5OiAtNjBcbiAgICAgICAgfSwgIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgZGVsYXk6IC4zLFxuICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXQsXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoZXIuZGlzcGF0Y2goXCJJTlRST19ET05FX0VWRU5UXCIpXG4gICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgfSwgXCJncnAxXCIpLnN0YWdnZXJGcm9tVG8oY2hhcnMsIC43NSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIHk6IC0xMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIGRlbGF5OiAuMixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgIH0sIC4wNSwgXCJncnAxXCIpLnRvKCQoXCIjcHJlbG9hZGVyLWluZGljYXRvclwiKSwgLjUsIHtcbiAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIFwiICsgJChcIiNwcmVsb2FkZXItaW5kaWNhdG9yXCIpLndpZHRoKCkgKiAtMjAwICsgXCJweCwgMnB4LCBcIiArICQoXCIjcHJlbG9hZGVyLWluZGljYXRvclwiKS53aWR0aCgpICogLTIwMCArIFwicHgpXCIsXG4gICAgICAgICAgICBkZWxheTogLjIsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjEuZWFzZUluT3V0XG4gICAgICAgIH0sIFwiZ3JwMVwiKVxuICAgIH0sXG4gICAgdXBkYXRlUHJvZ3Jlc3M6IGZ1bmN0aW9uKGUsIHQpIHtcbiAgICAgICAgVHdlZW5NYXgudG8oJChcIiNwcmVsb2FkZXItaW5kaWNhdG9yXCIpLCAuMjUsIHtcbiAgICAgICAgICAgIGNsaXA6IFwicmVjdCgyMDBweCwgXCIgKyAodCAvIC0xMDAgKiAkKFwiI3ByZWxvYWRlci1pbmRpY2F0b3JcIikud2lkdGgoKSAqIC0yMDAgKyAkKFwiI3ByZWxvYWRlci1pbmRpY2F0b3JcIikud2lkdGgoKSAqIC0yMDApICsgXCJweCwgMnB4LCBcIiArICgkKFwiI3ByZWxvYWRlci1pbmRpY2F0b3JcIikud2lkdGgoKSAqIC0yMDAgKyB0IC8gMTAwICogJChcIiNwcmVsb2FkZXItaW5kaWNhdG9yXCIpLndpZHRoKCkgKiAyMDApICsgXCJweClcIlxuICAgICAgICB9KVxuICAgIH0sXG4gICAgb25Mb2FkZWQ6IGZ1bmN0aW9uKGUsIHQpIHtcbiAgICAgICAgdGhpcy5vdXRybygpLCB0aGlzLmRpc3BhdGNoZXIucmVtb3ZlRXZlbnRsaXN0ZW5lcih0aGlzLnByb2dyZXNzRXZlbnQpLCB0aGlzLmRpc3BhdGNoZXIucmVtb3ZlRXZlbnRsaXN0ZW5lcih0aGlzLmNvbXBsZXRlRXZlbnQpLFxuXG4gICAgICAgIChmdW5jdGlvbih3aW5kb3cpIHtcblxuXG5cbiAgICAvLyBIZWxwZXIgdmFycyBhbmQgZnVuY3Rpb25zLlxuICAgIGZ1bmN0aW9uIGV4dGVuZCggYSwgYiApIHtcbiAgICAgICAgZm9yKCB2YXIga2V5IGluIGIgKSB7IFxuICAgICAgICAgICAgaWYoIGIuaGFzT3duUHJvcGVydHkoIGtleSApICkge1xuICAgICAgICAgICAgICAgIGFba2V5XSA9IGJba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG4gICAgLy8gRnJvbSBodHRwczovL2Rhdmlkd2Fsc2gubmFtZS9qYXZhc2NyaXB0LWRlYm91bmNlLWZ1bmN0aW9uLlxuICAgIGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkge1xuICAgICAgICB2YXIgdGltZW91dDtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgdmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKCFpbW1lZGlhdGUpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XG4gICAgICAgICAgICBpZiAoY2FsbE5vdykgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIC8vIENyZWF0ZXMgYSBzb3J0ZWQgYXJyYXkgb2YgcmFuZG9tIG51bWJlcnMgYmV0d2VlbiBtaW5WYWwgYW5kIG1heFZhbCB3aXRoIGEgbGVuZ3RoID0gc2l6ZS5cbiAgICBmdW5jdGlvbiBjcmVhdGVSYW5kSW50T3JkZXJlZEFycmF5KG1pblZhbCwgbWF4VmFsLCBzaXplKSB7XG4gICAgICAgIHZhciBhcnIgPSBbXTtcbiAgICAgICAgZm9yKHZhciBpPTA7IGk8c2l6ZTsgKytpKSB7XG4gICAgICAgICAgICBhcnIucHVzaChhbmltZS5yYW5kb20obWluVmFsLCBtYXhWYWwpKTtcbiAgICAgICAgfVxuICAgICAgICBhcnIuc29ydChmdW5jdGlvbihhLCBiKXsgcmV0dXJuIGEtYiB9KTtcbiAgICAgICAgcmV0dXJuIGFycjtcbiAgICB9XG4gICAgLy8gQ2hlY2tzIGlmIGFuIG9iamVjdCBpcyBlbXB0eS5cbiAgICBmdW5jdGlvbiBpc09iakVtcHR5KG9iaikge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob2JqKS5sZW5ndGggPiAwO1xuICAgIH1cbiAgICAvLyBDb25jYXRlbmF0ZSBKUyBvYmpzLlxuICAgIC8vIEZyb20gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMjQ1NDMxNS5cbiAgICBmdW5jdGlvbiBjb2xsZWN0KCkge1xuICAgICAgICB2YXIgcmV0ID0ge307XG4gICAgICAgIHZhciBsZW4gPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpPTA7IGk8bGVuOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gYXJndW1lbnRzW2ldKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50c1tpXS5oYXNPd25Qcm9wZXJ0eShwKSkge1xuICAgICAgICAgICAgICAgICAgICByZXRbcF0gPSBhcmd1bWVudHNbaV1bcF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICAgIC8vIENoZWNrIGlmIGNsaXAtcGF0aCBpcyBzdXBwb3J0ZWQuIEZyb20gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMzAwNDE1MzguXG4gICAgZnVuY3Rpb24gYXJlQ2xpcFBhdGhTaGFwZXNTdXBwb3J0ZWQoKSB7XG4gICAgICAgIHZhciBiYXNlID0gJ2NsaXBQYXRoJyxcbiAgICAgICAgICAgIHByZWZpeGVzID0gWyAnd2Via2l0JywgJ21veicsICdtcycsICdvJyBdLFxuICAgICAgICAgICAgcHJvcGVydGllcyA9IFsgYmFzZSBdLFxuICAgICAgICAgICAgdGVzdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGVzdGVsZW1lbnQnICksXG4gICAgICAgICAgICBhdHRyaWJ1dGUgPSAncG9seWdvbig1MCUgMCUsIDAlIDEwMCUsIDEwMCUgMTAwJSknO1xuXG4gICAgICAgIC8vIFB1c2ggdGhlIHByZWZpeGVkIHByb3BlcnRpZXMgaW50byB0aGUgYXJyYXkgb2YgcHJvcGVydGllcy5cbiAgICAgICAgZm9yICggdmFyIGkgPSAwLCBsID0gcHJlZml4ZXMubGVuZ3RoOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgdmFyIHByZWZpeGVkUHJvcGVydHkgPSBwcmVmaXhlc1tpXSArIGJhc2UuY2hhckF0KCAwICkudG9VcHBlckNhc2UoKSArIGJhc2Uuc2xpY2UoIDEgKTsgLy8gcmVtZW1iZXIgdG8gY2FwaXRhbGl6ZSFcbiAgICAgICAgICAgIHByb3BlcnRpZXMucHVzaCggcHJlZml4ZWRQcm9wZXJ0eSApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSW50ZXJhdGUgb3ZlciB0aGUgcHJvcGVydGllcyBhbmQgc2VlIGlmIHRoZXkgcGFzcyB0d28gdGVzdHMuXG4gICAgICAgIGZvciAoIHZhciBpID0gMCwgbCA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgbDsgaSsrICkge1xuICAgICAgICAgICAgdmFyIHByb3BlcnR5ID0gcHJvcGVydGllc1tpXTtcblxuICAgICAgICAgICAgLy8gRmlyc3QsIHRoZXkgbmVlZCB0byBldmVuIHN1cHBvcnQgY2xpcC1wYXRoIChJRSA8PSAxMSBkb2VzIG5vdCkuLi5cbiAgICAgICAgICAgIGlmICggdGVzdEVsZW1lbnQuc3R5bGVbcHJvcGVydHldID09PSAnJyApIHtcblxuICAgICAgICAgICAgICAgIC8vIFNlY29uZCwgd2UgbmVlZCB0byBzZWUgd2hhdCBoYXBwZW5zIHdoZW4gd2UgdHJ5IHRvIGNyZWF0ZSBhIENTUyBzaGFwZS4uLlxuICAgICAgICAgICAgICAgIHRlc3RFbGVtZW50LnN0eWxlW3Byb3BlcnR5XSA9IGF0dHJpYnV0ZTtcbiAgICAgICAgICAgICAgICBpZiAoIHRlc3RFbGVtZW50LnN0eWxlW3Byb3BlcnR5XSAhPT0gJycgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNlZ21lbnRlciBvYmouXG4gICAgICovXG4gICAgZnVuY3Rpb24gU2VnbWVudGVyKGVsLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuZWwgPSBlbDtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICBleHRlbmQodGhpcy5vcHRpb25zLCBvcHRpb25zKTtcbiAgICAgICAgLy8gUHJlbG9hZCBtYWluIGltYWdlLlxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIGltYWdlc0xvYWRlZCh0aGlzLmVsLCB7IGJhY2tncm91bmQ6IHRydWUgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzZWxmLl9pbml0KCk7XG4gICAgICAgICAgICBzZWxmLl9pbml0RXZlbnRzKCk7XG4gICAgICAgICAgICBzZWxmLm9wdGlvbnMub25SZWFkeSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBTZWdtZW50ZXIucHJvdG90eXBlLm9wdGlvbnMgPSB7XG4gICAgICAgIC8vIE51bWJlciBvZiBwaWVjZXMuXG4gICAgICAgIHBpZWNlczogNCwgXG4gICAgICAgIC8vIFNob3cgcGllY2VzIGFscmVhZHkgc3R5bGVkLlxuICAgICAgICByZW5kZXJPbkxvYWQ6IGZhbHNlLFxuICAgICAgICAvLyBBZGQgYW4gZWxlbWVudCBmb3IgdGhlIHNoYWRvdy5cbiAgICAgICAgc2hhZG93czogdHJ1ZSxcbiAgICAgICAgLy8gQW5pbWF0aW9ucyBmb3IgdGhlIHNoYWRvdyAodmFsaWQgcHJvcGVydGllczogb3BhY2l0eSwgdHJhbnNsYXRlWCwgdHJhbnNsYXRlWSkuXG4gICAgICAgIHNoYWRvd3NBbmltYXRpb246IHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAvLyB0cmFuc2xhdGVYOiAyMCxcbiAgICAgICAgICAgIC8vIHRyYW5zbGF0ZVk6IDIwXG4gICAgICAgIH0sXG4gICAgICAgIC8vIFBhcnJhbGxheCBlZmZlY3QgZm9yIHRoZSBwaWVjZXMuXG4gICAgICAgIHBhcmFsbGF4OiBmYWxzZSxcbiAgICAgICAgLy8gTW92ZW1lbnRzIGZvciB0aGUgcGFyYWxsYXggZWZmZWN0LlxuICAgICAgICBwYXJhbGxheE1vdmVtZW50OiB7bWluOiAxMCwgbWF4OiA0MH0sXG4gICAgICAgIC8vIEFuaW1hdGlvbiBmb3IgdGhlIHBpZWNlcyAodmFsaWQgcHJvcGVydGllczogZHVyYXRpb24sIGVhc2luZywgZGVsYXksIG9wYWNpdHksIHRyYW5zbGF0ZVtYWVpdKS5cbiAgICAgICAgYW5pbWF0aW9uOiB7XG4gICAgICAgICAgICBkdXJhdGlvbjogMTUwMCxcbiAgICAgICAgICAgIGVhc2luZzogJ2Vhc2VPdXRRdWFkJyxcbiAgICAgICAgICAgIGRlbGF5OiAwLCAvLyBEZWxheSBpbmNyZW1lbnQgcGVyIHBpZWNlLlxuICAgICAgICAgICAgLy8gb3BhY2l0eTogMC41LFxuICAgICAgICAgICAgdHJhbnNsYXRlWjoge21pbjogMTAsIG1heDogNjV9LCAvLyBXZSBjYW4gYWxzbyB1c2UgYW4gaW50ZWdlciBmb3IgYSBzcGVjaWZpYyB2YWx1ZS5cbiAgICAgICAgICAgIC8vIHRyYW5zbGF0ZVg6IHttaW46IC0xMDAsIG1heDogMTAwfSwgLy8gV2UgY2FuIGFsc28gdXNlIGFuIGludGVnZXIgZm9yIGEgc3BlY2lmaWMgdmFsdWUuXG4gICAgICAgICAgICAvLyB0cmFuc2xhdGVZOiB7bWluOiAtMTAwLCBtYXg6IDEwMH0gLy8gV2UgY2FuIGFsc28gdXNlIGFuIGludGVnZXIgZm9yIGEgc3BlY2lmaWMgdmFsdWUuXG4gICAgICAgIH0sXG4gICAgICAgIC8vIENhbGxiYWNrc1xuICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpIHsgcmV0dXJuIGZhbHNlOyB9LFxuICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlOiBmdW5jdGlvbigpIHsgcmV0dXJuIGZhbHNlOyB9LFxuICAgICAgICBvbkFuaW1hdGlvblN0YXJ0OiBmdW5jdGlvbigpIHsgcmV0dXJuIGZhbHNlOyB9LFxuICAgICAgICAvLyBUaGUgcG9zaXRpb25zIG9mIHRoZSBwaWVjZXMgaW4gcGVyY2VudGFnZSB2YWx1ZXMuIFxuICAgICAgICAvLyBXZSBjYW4gYWxzbyB1c2UgcmFuZG9tIHZhbHVlcyBieSBzZXR0aW5nIG9wdGlvbnMucG9zaXRpb25zIHRvIFwicmFuZG9tXCIuXG4gICAgICAgIHBvc2l0aW9uczogW1xuICAgICAgICAgICAge3RvcDogODAsIGxlZnQ6IDEwLCB3aWR0aDogMzAsIGhlaWdodDogMjB9LFxuICAgICAgICAgICAge3RvcDogMiwgbGVmdDogMiwgd2lkdGg6IDQwLCBoZWlnaHQ6IDQwfSxcbiAgICAgICAgICAgIHt0b3A6IDMwLCBsZWZ0OiA2MCwgd2lkdGg6IDMwLCBoZWlnaHQ6IDYwfSxcbiAgICAgICAgICAgIHt0b3A6IDEwLCBsZWZ0OiAyMCwgd2lkdGg6IDUwLCBoZWlnaHQ6IDYwfVxuICAgICAgICBdXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEluaXQhXG4gICAgICovXG4gICAgU2VnbWVudGVyLnByb3RvdHlwZS5faW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBUaGUgZGltZW5zaW9ucyBvZiB0aGUgbWFpbiBlbGVtZW50LlxuICAgICAgICB0aGlzLmRpbWVuc2lvbnMgPSB7XG4gICAgICAgICAgICB3aWR0aDogdGhpcy5lbC5vZmZzZXRXaWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5lbC5vZmZzZXRIZWlnaHRcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRoZSBzb3VyY2Ugb2YgdGhlIG1haW4gaW1hZ2UuXG4gICAgICAgIHZhciBiYWNrZ3JvdW5kID0gdGhpcy5lbC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2U7XG4gICAgICAgIHRoaXMuaW1nc3JjID0gYmFja2dyb3VuZC5yZXBsYWNlKCd1cmwoJywnJykucmVwbGFjZSgnKScsJycpLnJlcGxhY2UoL1xcXCIvZ2ksIFwiXCIpOztcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgbGF5b3V0LlxuICAgICAgICB0aGlzLl9sYXlvdXQoKTtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMucGllY2VzID0gW10uc2xpY2UuY2FsbCh0aGlzLmVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWdtZW50ZXJfX3BpZWNlLXdyYXAnKSk7XG4gICAgICAgIHRoaXMucGllY2VzLmZvckVhY2goZnVuY3Rpb24ocGllY2UsIHBvcykge1xuICAgICAgICAgICAgLy8gQnVnZml4IGZvciBDaHJvbWUuIFRoZSB0cmFuc2xhdGVaIG5lZWRzIGFuIGluaXRpYWwgdmFsdWUgb3RoZXJ3aXNlIHRoZSBhbmltYXRpb24gd2lsbCBub3Qgd29yay4gKHRoaXMgc2VlbXMgdG8gYmUgYSBhbmltZS5qcyBidWcgLSBsZXTCtHMgd2FpdCBmb3IgdGhlIG5leHQgdmVyc2lvbi4uKVxuICAgICAgICAgICAgcGllY2Uuc3R5bGUuV2Via2l0VHJhbnNmb3JtID0gcGllY2Uuc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVooMC4wMDAxcHgpJztcblxuICAgICAgICAgICAgLy8gSWYgd2Ugd2FudCB0byByZW5kZXIgdGhlIGRpZmZlcmVudCBwaWVjZXMgb24gbG9hZCB0aGVuOlxuICAgICAgICAgICAgaWYoIHNlbGYub3B0aW9ucy5yZW5kZXJPbkxvYWQgKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5fcmVuZGVyUGllY2UocGllY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gRmxhZyB0byBpbmRpY2F0ZSB0aGUgcGllY2VzIGFyZSBhbHJlYWR5IHJlbmRlcmVkL3N0eWxlZCBlaXRoZXIgb24gbG9hZCBvciBhZnRlciB0aGUgYW5pbWF0aW9uLlxuICAgICAgICBpZiggdGhpcy5vcHRpb25zLnJlbmRlck9uTG9hZCApIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIHRoZSBsYXlvdXQuXG4gICAgICovXG4gICAgU2VnbWVudGVyLnByb3RvdHlwZS5fbGF5b3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGNsaXAtcGF0aCBzdXBwb3J0XG4gICAgICAgIHZhciBjbGlwUGF0aCA9IGFyZUNsaXBQYXRoU2hhcGVzU3VwcG9ydGVkKCk7XG5cbiAgICAgICAgdmFyIHNlZ0JnRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgc2VnQmdFbC5jbGFzc05hbWUgPSAnc2VnbWVudGVyX19iYWNrZ3JvdW5kJztcbiAgICAgICAgc2VnQmdFbC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSAndXJsKCcgKyB0aGlzLmltZ3NyYyArICcpJztcblxuICAgICAgICB2YXIgc2VnUGllY2VzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksXG4gICAgICAgICAgICBzZWdQaWVjZXNIVE1MID0gJycsXG4gICAgICAgICAgICBwb3NpdGlvbnNUb3RhbCA9IHRoaXMub3B0aW9ucy5wb3NpdGlvbnMubGVuZ3RoO1xuXG4gICAgICAgIHNlZ1BpZWNlcy5jbGFzc05hbWUgPSAnc2VnbWVudGVyX19waWVjZXMnO1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDAsIGxlbiA9IHRoaXMub3B0aW9ucy5waWVjZXM7IGkgPCBsZW47ICsraSkge1xuICAgICAgICAgICAgaWYoIHRoaXMub3B0aW9ucy5wYXJhbGxheCApIHtcbiAgICAgICAgICAgICAgICBzZWdQaWVjZXNIVE1MICs9ICc8ZGl2IGNsYXNzPVwic2VnbWVudGVyX19waWVjZS1wYXJhbGxheFwiPic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlZ1BpZWNlc0hUTUwgKz0gJzxkaXYgY2xhc3M9XCJzZWdtZW50ZXJfX3BpZWNlLXdyYXBcIj4nO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgdG9wLCBsZWZ0LCB3aWR0aCwgaGVpZ2h0LCBjbGlwVG9wLCBjbGlwTGVmdCwgY2xpcFJpZ2h0LCBjbGlwQm90dG9tLFxuICAgICAgICAgICAgICAgIHBvcyA9IGkgPD0gcG9zaXRpb25zVG90YWwgLSAxID8gaSA6IDAsXG4gICAgICAgICAgICAgICAgaXNSYW5kb20gPSB0aGlzLm9wdGlvbnMucG9zaXRpb25zID09PSAncmFuZG9tJztcblxuICAgICAgICAgICAgdG9wID0gaXNSYW5kb20gPyBhbmltZS5yYW5kb20oMCwxMDApIDogdGhpcy5vcHRpb25zLnBvc2l0aW9uc1twb3NdLnRvcDtcbiAgICAgICAgICAgIGxlZnQgPSBpc1JhbmRvbSA/IGFuaW1lLnJhbmRvbSgwLDEwMCkgOiB0aGlzLm9wdGlvbnMucG9zaXRpb25zW3Bvc10ubGVmdDtcbiAgICAgICAgICAgIHdpZHRoID0gaXNSYW5kb20gPyBhbmltZS5yYW5kb20oMCwxMDApIDogdGhpcy5vcHRpb25zLnBvc2l0aW9uc1twb3NdLndpZHRoO1xuICAgICAgICAgICAgaGVpZ2h0ID0gaXNSYW5kb20gPyBhbmltZS5yYW5kb20oMCwxMDApIDogdGhpcy5vcHRpb25zLnBvc2l0aW9uc1twb3NdLmhlaWdodDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYoICFjbGlwUGF0aCApIHtcbiAgICAgICAgICAgICAgICBjbGlwVG9wID0gaXNSYW5kb20gPyB0b3AvMTAwICogdGhpcy5kaW1lbnNpb25zLmhlaWdodCA6IHRoaXMub3B0aW9ucy5wb3NpdGlvbnNbcG9zXS50b3AvMTAwICogdGhpcy5kaW1lbnNpb25zLmhlaWdodDtcbiAgICAgICAgICAgICAgICBjbGlwTGVmdCA9IGlzUmFuZG9tID8gbGVmdC8xMDAgKiB0aGlzLmRpbWVuc2lvbnMud2lkdGggOiB0aGlzLm9wdGlvbnMucG9zaXRpb25zW3Bvc10ubGVmdC8xMDAgKiB0aGlzLmRpbWVuc2lvbnMud2lkdGg7XG4gICAgICAgICAgICAgICAgY2xpcFJpZ2h0ID0gaXNSYW5kb20gPyB3aWR0aC8xMDAgKiB0aGlzLmRpbWVuc2lvbnMud2lkdGggKyBjbGlwTGVmdCA6IHRoaXMub3B0aW9ucy5wb3NpdGlvbnNbcG9zXS53aWR0aC8xMDAgKiB0aGlzLmRpbWVuc2lvbnMud2lkdGggKyBjbGlwTGVmdDtcbiAgICAgICAgICAgICAgICBjbGlwQm90dG9tID0gaXNSYW5kb20gPyBoZWlnaHQvMTAwICogdGhpcy5kaW1lbnNpb25zLmhlaWdodCArIGNsaXBUb3AgOiB0aGlzLm9wdGlvbnMucG9zaXRpb25zW3Bvc10uaGVpZ2h0LzEwMCAqIHRoaXMuZGltZW5zaW9ucy5oZWlnaHQgKyBjbGlwVG9wO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiggdGhpcy5vcHRpb25zLnNoYWRvd3MgKSB7XG4gICAgICAgICAgICAgICAgc2VnUGllY2VzSFRNTCArPSAnPGRpdiBjbGFzcz1cInNlZ21lbnRlcl9fc2hhZG93XCIgc3R5bGU9XCJ0b3A6ICcgKyB0b3AgKyAnJTsgbGVmdDogJyArIGxlZnQgKyAnJTsgd2lkdGg6ICcgKyB3aWR0aCArICclOyBoZWlnaHQ6ICcgKyBoZWlnaHQgKyAnJVwiPjwvZGl2Pic7ICAgICAgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VnUGllY2VzSFRNTCArPSBjbGlwUGF0aCA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJzZWdtZW50ZXJfX3BpZWNlXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJyArIHRoaXMuaW1nc3JjICsgJyk7IC13ZWJraXQtY2xpcC1wYXRoOiBwb2x5Z29uKCcgKyBsZWZ0ICsgJyUgJyArIHRvcCArICclLCAnICsgKGxlZnQgKyB3aWR0aCkgKyAnJSAnICsgdG9wICsgJyUsICcgKyAobGVmdCArIHdpZHRoKSArICclICcgKyAodG9wICsgaGVpZ2h0KSArICclLCAnICsgbGVmdCArICclICcgKyAodG9wICsgaGVpZ2h0KSArICclKTsgY2xpcC1wYXRoOiBwb2x5Z29uKCcgKyBsZWZ0ICsgJyUgJyArIHRvcCArICclLCAnICsgKGxlZnQgKyB3aWR0aCkgKyAnJSAnICsgdG9wICsgJyUsICcgKyAobGVmdCArIHdpZHRoKSArICclICcgKyAodG9wICsgaGVpZ2h0KSArICclLCAnICsgbGVmdCArICclICcgKyAodG9wICsgaGVpZ2h0KSArICclKVwiPjwvZGl2PicgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwic2VnbWVudGVyX19waWVjZVwiIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCcgKyB0aGlzLmltZ3NyYyArICcpOyBjbGlwOiByZWN0KCcgKyBjbGlwVG9wICsgJ3B4LCcgKyBjbGlwUmlnaHQgKyAncHgsJyArIGNsaXBCb3R0b20gKyAncHgsJyArIGNsaXBMZWZ0ICsgJ3B4KVwiPjwvZGl2Pic7XG5cbiAgICAgICAgICAgIHNlZ1BpZWNlc0hUTUwgKz0gJzwvZGl2PidcbiAgICAgICAgICAgIGlmKCB0aGlzLm9wdGlvbnMucGFyYWxsYXggKSB7XG4gICAgICAgICAgICAgICAgc2VnUGllY2VzSFRNTCArPSAnPC9kaXY+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHNlZ1BpZWNlcy5pbm5lckhUTUwgPSBzZWdQaWVjZXNIVE1MO1xuXG4gICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIHRoaXMuZWwuYXBwZW5kQ2hpbGQoc2VnQmdFbCk7XG4gICAgICAgIHRoaXMuZWwuYXBwZW5kQ2hpbGQoc2VnUGllY2VzKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmVuZGVycy9TdHlsZXMgYSBwaWVjZSB3aXRoIHRoZSBvcHRpb25zIHRoYXQgYXJlIHBhc3NlZCBpbiB0aGUgaW5pdGlhbGl6YXRpb24uXG4gICAgICovXG4gICAgU2VnbWVudGVyLnByb3RvdHlwZS5fcmVuZGVyUGllY2UgPSBmdW5jdGlvbihwaWVjZSkge1xuICAgICAgICB2YXIgaWR4ID0gdGhpcy5waWVjZXMuaW5kZXhPZihwaWVjZSk7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgaWYoIHNlbGYub3B0aW9ucy5hbmltYXRpb24udHJhbnNsYXRlWiAhPSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICBpZiggdHlwZW9mIHNlbGYub3B0aW9ucy5hbmltYXRpb24udHJhbnNsYXRlWiA9PT0gJ29iamVjdCcgKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJhbmRBcnIgPSBjcmVhdGVSYW5kSW50T3JkZXJlZEFycmF5KHNlbGYub3B0aW9ucy5hbmltYXRpb24udHJhbnNsYXRlWi5taW4sIHNlbGYub3B0aW9ucy5hbmltYXRpb24udHJhbnNsYXRlWi5tYXgsIHNlbGYub3B0aW9ucy5waWVjZXMpO1xuICAgICAgICAgICAgICAgIHBpZWNlLnN0eWxlLnRyYW5zZm9ybSA9IHBpZWNlLnN0eWxlLldlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGVaKCcgKyByYW5kQXJyW2lkeF0gKyAncHgpJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHBpZWNlLnN0eWxlLnRyYW5zZm9ybSA9IHBpZWNlLnN0eWxlLldlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGVaKCcgKyBzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVogKyAncHgpJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiggc2VsZi5vcHRpb25zLmFuaW1hdGlvbi50cmFuc2xhdGVZICE9IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgIGlmKCB0eXBlb2Ygc2VsZi5vcHRpb25zLmFuaW1hdGlvbi50cmFuc2xhdGVZID09PSAnb2JqZWN0JyApIHtcbiAgICAgICAgICAgICAgICB2YXIgcmFuZEFyciA9IGNyZWF0ZVJhbmRJbnRPcmRlcmVkQXJyYXkoc2VsZi5vcHRpb25zLmFuaW1hdGlvbi50cmFuc2xhdGVZLm1pbiwgc2VsZi5vcHRpb25zLmFuaW1hdGlvbi50cmFuc2xhdGVZLm1heCwgc2VsZi5vcHRpb25zLnBpZWNlcyk7XG4gICAgICAgICAgICAgICAgcGllY2Uuc3R5bGUudHJhbnNmb3JtID0gcGllY2Uuc3R5bGUuV2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoJyArIHJhbmRBcnJbaWR4XSArICdweCknO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGllY2Uuc3R5bGUudHJhbnNmb3JtID0gcGllY2Uuc3R5bGUuV2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoJyArIHNlbGYub3B0aW9ucy5hbmltYXRpb24udHJhbnNsYXRlWSArICdweCknO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKCBzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVggIT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgaWYoIHR5cGVvZiBzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVggPT09ICdvYmplY3QnICkge1xuICAgICAgICAgICAgICAgIHZhciByYW5kQXJyID0gY3JlYXRlUmFuZEludE9yZGVyZWRBcnJheShzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVgubWluLCBzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVgubWF4LCBzZWxmLm9wdGlvbnMucGllY2VzKTtcbiAgICAgICAgICAgICAgICBwaWVjZS5zdHlsZS50cmFuc2Zvcm0gPSBwaWVjZS5zdHlsZS5XZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlWCgnICsgcmFuZEFycltpZHhdICsgJ3B4KSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBwaWVjZS5zdHlsZS50cmFuc2Zvcm0gPSBwaWVjZS5zdHlsZS5XZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlWCgnICsgc2VsZi5vcHRpb25zLmFuaW1hdGlvbi50cmFuc2xhdGVYICsgJ3B4KSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoIHNlbGYub3B0aW9ucy5hbmltYXRpb24ub3BhY2l0eSAhPSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICBwaWVjZS5zdHlsZS5vcGFjaXR5ID0gc2VsZi5vcHRpb25zLmFuaW1hdGlvbi5vcGFjaXR5O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoIHNlbGYub3B0aW9ucy5zaGFkb3dzICYmIGlzT2JqRW1wdHkoc2VsZi5vcHRpb25zLnNoYWRvd3NBbmltYXRpb24pICkge1xuICAgICAgICAgICAgdmFyIHNoYWRvd0VsID0gcGllY2UucXVlcnlTZWxlY3RvcignLnNlZ21lbnRlcl9fc2hhZG93Jyk7XG4gICAgICAgICAgICBzaGFkb3dFbC5zdHlsZS5vcGFjaXR5ID0gc2VsZi5vcHRpb25zLnNoYWRvd3NBbmltYXRpb24ub3BhY2l0eSAhPSB1bmRlZmluZWQgPyBzZWxmLm9wdGlvbnMuc2hhZG93c0FuaW1hdGlvbi5vcGFjaXR5IDogMDtcbiAgICAgICAgICAgIHNoYWRvd0VsLnN0eWxlLnRyYW5zZm9ybSA9IHNoYWRvd0VsLnN0eWxlLldlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKCcgKyAoc2VsZi5vcHRpb25zLnNoYWRvd3NBbmltYXRpb24udHJhbnNsYXRlWCAhPSB1bmRlZmluZWQgPyBzZWxmLm9wdGlvbnMuc2hhZG93c0FuaW1hdGlvbi50cmFuc2xhdGVYIDogMCkgKyAncHgpIHRyYW5zbGF0ZVkoJyArIChzZWxmLm9wdGlvbnMuc2hhZG93c0FuaW1hdGlvbi50cmFuc2xhdGVZICE9IHVuZGVmaW5lZCA/IHNlbGYub3B0aW9ucy5zaGFkb3dzQW5pbWF0aW9uLnRyYW5zbGF0ZVkgOiAwKSArICdweCknO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEFuaW1hdGVzIHRoZSBwaWVjZXMgd2l0aCB0aGUgb3B0aW9ucyBwYXNzZWQgKHdpdGggYW5pbWUuanMpLlxuICAgICAqL1xuICAgIFNlZ21lbnRlci5wcm90b3R5cGUuYW5pbWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiggdGhpcy5hY3RpdmUgKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hY3RpdmUgPSB0cnVlO1xuXG4gICAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgICAgIGFuaW1Qcm9wcyA9IHtcbiAgICAgICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnBpZWNlcyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5vcHRpb25zLmFuaW1hdGlvbi5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBkZWxheTogZnVuY3Rpb24oZWwsIGluZGV4KSB7IHJldHVybiAoc2VsZi5vcHRpb25zLnBpZWNlcyAtIGluZGV4IC0gMSkgKiBzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLmRlbGF5OyB9LFxuICAgICAgICAgICAgICAgIGVhc2luZzogdGhpcy5vcHRpb25zLmFuaW1hdGlvbi5lYXNpbmcsXG4gICAgICAgICAgICAgICAgYmVnaW46IHRoaXMub3B0aW9ucy5vbkFuaW1hdGlvblN0YXJ0LFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlOiB0aGlzLm9wdGlvbnMub25BbmltYXRpb25Db21wbGV0ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGlmKCB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVogIT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgdmFyIHJhbmRBcnIgPSBjcmVhdGVSYW5kSW50T3JkZXJlZEFycmF5KHRoaXMub3B0aW9ucy5hbmltYXRpb24udHJhbnNsYXRlWi5taW4sIHRoaXMub3B0aW9ucy5hbmltYXRpb24udHJhbnNsYXRlWi5tYXgsIHRoaXMub3B0aW9ucy5waWVjZXMpO1xuICAgICAgICAgICAgYW5pbVByb3BzLnRyYW5zbGF0ZVogPSB0eXBlb2YgdGhpcy5vcHRpb25zLmFuaW1hdGlvbi50cmFuc2xhdGVaID09PSAnb2JqZWN0JyA/IGZ1bmN0aW9uKGVsLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByYW5kQXJyW2luZGV4XTtcbiAgICAgICAgICAgIH0gOiB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVo7XG4gICAgICAgIH1cbiAgICAgICAgaWYoIHRoaXMub3B0aW9ucy5hbmltYXRpb24udHJhbnNsYXRlWCAhPSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICBhbmltUHJvcHMudHJhbnNsYXRlWCA9IHR5cGVvZiB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVggPT09ICdvYmplY3QnID8gZnVuY3Rpb24oZWwsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuaW1lLnJhbmRvbShzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVgubWluLCBzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVgubWF4KTtcbiAgICAgICAgICAgIH0gOiB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVg7XG4gICAgICAgIH1cbiAgICAgICAgaWYoIHRoaXMub3B0aW9ucy5hbmltYXRpb24udHJhbnNsYXRlWSAhPSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICBhbmltUHJvcHMudHJhbnNsYXRlWSA9IHR5cGVvZiB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVkgPT09ICdvYmplY3QnID8gZnVuY3Rpb24oZWwsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuaW1lLnJhbmRvbShzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVkubWluLCBzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVkubWF4KTtcbiAgICAgICAgICAgIH0gOiB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uLnRyYW5zbGF0ZVk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoIHRoaXMub3B0aW9ucy5hbmltYXRpb24ub3BhY2l0eSAhPSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICBhbmltUHJvcHMub3BhY2l0eSA9IHRoaXMub3B0aW9ucy5hbmltYXRpb24ub3BhY2l0eTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFuaW1lKGFuaW1Qcm9wcyk7XG5cbiAgICAgICAgLy8gQWxzbyBhbmltYXRlIHRoZSBzaGFkb3cgZWxlbWVudC5cbiAgICAgICAgaWYoIHRoaXMub3B0aW9ucy5zaGFkb3dzICYmIGlzT2JqRW1wdHkodGhpcy5vcHRpb25zLnNoYWRvd3NBbmltYXRpb24pICkge1xuICAgICAgICAgICAgYW5pbWUoY29sbGVjdCh7XG4gICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VnbWVudGVyX19zaGFkb3cnKSxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5vcHRpb25zLmFuaW1hdGlvbi5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBkZWxheTogZnVuY3Rpb24oZWwsIGluZGV4KSB7IHJldHVybiAoc2VsZi5vcHRpb25zLnBpZWNlcyAtIGluZGV4IC0gMSkgKiBzZWxmLm9wdGlvbnMuYW5pbWF0aW9uLmRlbGF5OyB9LFxuICAgICAgICAgICAgICAgIGVhc2luZzogdGhpcy5vcHRpb25zLmFuaW1hdGlvbi5lYXNpbmdcbiAgICAgICAgICAgIH0sIHRoaXMub3B0aW9ucy5zaGFkb3dzQW5pbWF0aW9uKSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW5pdC9CaW5kIGV2ZW50cy5cbiAgICAgKi9cbiAgICBTZWdtZW50ZXIucHJvdG90eXBlLl9pbml0RXZlbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIC8vIFdpbmRvdyByZXNpemUuXG4gICAgICAgIHRoaXMuZGVib3VuY2VSZXNpemUgPSBkZWJvdW5jZShmdW5jdGlvbihldikge1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uc1RvdGFsID0gc2VsZi5vcHRpb25zLnBvc2l0aW9ucy5sZW5ndGg7XG5cbiAgICAgICAgICAgIC8vIFJlY2FsY3VsYXRlIGRpbWVuc2lvbnMuXG4gICAgICAgICAgICBzZWxmLmRpbWVuc2lvbnMgPSB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHNlbGYuZWwub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBzZWxmLmVsLm9mZnNldEhlaWdodFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gUmVjYWxjdWxhdGUgY2xpcCB2YWx1ZXMuLlxuICAgICAgICAgICAgLy8gdG9kbzogRFJZXG4gICAgICAgICAgICAvLyB0b2RvOiBJZiByYW5kb20gaXMgdHJ1ZSB0aGVuIHNhdmUgdGhlIGluaXRpYWwgdmFsdWVzLiBTaG91bGQgbm90IHJlY2FsY3VsYXRlIGZvciB0aGlzIGNhc2UuXG4gICAgICAgICAgICBzZWxmLnBpZWNlcy5mb3JFYWNoKGZ1bmN0aW9uKHBpZWNlLCBwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIHZhciBjbGlwVG9wLCBjbGlwTGVmdCwgY2xpcFJpZ2h0LCBjbGlwQm90dG9tLFxuICAgICAgICAgICAgICAgICAgICBzZWdtZW50ZXJQaWVjZSA9IHBpZWNlLnF1ZXJ5U2VsZWN0b3IoJy5zZWdtZW50ZXJfX3BpZWNlJyk7XG5cbiAgICAgICAgICAgICAgICBpZiggc2VsZi5vcHRpb25zLnBvc2l0aW9ucyA9PT0gJ3JhbmRvbScgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5kVCA9IGFuaW1lLnJhbmRvbSgwLDEwMCksIHJhbmRMID0gYW5pbWUucmFuZG9tKDAsMTAwKSwgcmFuZFcgPSBhbmltZS5yYW5kb20oMCwxMDApLCByYW5kSCA9IGFuaW1lLnJhbmRvbSgwLDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGNsaXBUb3AgPSByYW5kVC8xMDAgKiBzZWxmLmRpbWVuc2lvbnMuaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBjbGlwTGVmdCA9IHJhbmRMLzEwMCAqIHNlbGYuZGltZW5zaW9ucy53aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgY2xpcFJpZ2h0ID0gcmFuZFcvMTAwICogc2VsZi5kaW1lbnNpb25zLndpZHRoICsgY2xpcExlZnQ7XG4gICAgICAgICAgICAgICAgICAgIGNsaXBCb3R0b20gPSByYW5kSC8xMDAgKiBzZWxmLmRpbWVuc2lvbnMuaGVpZ2h0ICsgY2xpcFRvcDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3MgPSBwb3NpdGlvbiA8PSBwb3NpdGlvbnNUb3RhbCAtIDEgPyBwb3NpdGlvbiA6IDA7XG4gICAgICAgICAgICAgICAgICAgIGNsaXBUb3AgPSBzZWxmLm9wdGlvbnMucG9zaXRpb25zW3Bvc10udG9wLzEwMCAqIHNlbGYuZGltZW5zaW9ucy5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIGNsaXBMZWZ0ID0gc2VsZi5vcHRpb25zLnBvc2l0aW9uc1twb3NdLmxlZnQvMTAwICogc2VsZi5kaW1lbnNpb25zLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICBjbGlwUmlnaHQgPSBzZWxmLm9wdGlvbnMucG9zaXRpb25zW3Bvc10ud2lkdGgvMTAwICogc2VsZi5kaW1lbnNpb25zLndpZHRoICsgY2xpcExlZnQ7XG4gICAgICAgICAgICAgICAgICAgIGNsaXBCb3R0b20gPSBzZWxmLm9wdGlvbnMucG9zaXRpb25zW3Bvc10uaGVpZ2h0LzEwMCAqIHNlbGYuZGltZW5zaW9ucy5oZWlnaHQgKyBjbGlwVG9wO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNlZ21lbnRlclBpZWNlLnN0eWxlLmNsaXAgPSAncmVjdCgnICsgY2xpcFRvcCArICdweCwnICsgY2xpcFJpZ2h0ICsgJ3B4LCcgKyBjbGlwQm90dG9tICsgJ3B4LCcgKyBjbGlwTGVmdCArICdweCknO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIDEwKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMuZGVib3VuY2VSZXNpemUpO1xuICAgICAgICBcbiAgICAgICAgLy8gTW91c2Vtb3ZlIGFuZCBEZXZpY2VvcmllbnRhdGlvbjpcbiAgICAgICAgaWYoIHRoaXMub3B0aW9ucy5wYXJhbGxheCApIHtcbiAgICAgICAgICAgIHZhciBhcnJSYW5kID0gY3JlYXRlUmFuZEludE9yZGVyZWRBcnJheSh0aGlzLm9wdGlvbnMucGFyYWxsYXhNb3ZlbWVudC5taW4sIHRoaXMub3B0aW9ucy5wYXJhbGxheE1vdmVtZW50Lm1heCwgdGhpcy5vcHRpb25zLnBpZWNlcyk7XG4gICAgICAgICAgICB0aGlzLnBpZWNlcy5mb3JFYWNoKGZ1bmN0aW9uKHBpZWNlLCBwb3MpIHtcbiAgICAgICAgICAgICAgICBwaWVjZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcGFyYWxsYXgtdHJhbnNsYXRpb24nLCB0eXBlb2Ygc2VsZi5vcHRpb25zLnBhcmFsbGF4TW92ZW1lbnQgPT09ICdvYmplY3QnID8gYXJyUmFuZFtwb3NdIDogc2VsZi5vcHRpb25zLnBhcmFsbGF4TW92ZW1lbnQgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5tb3VzZW1vdmUgPSBmdW5jdGlvbihldikge1xuICAgICAgICAgICAgICAgIGlmKCAhc2VsZi5hY3RpdmUgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnBpZWNlcy5mb3JFYWNoKGZ1bmN0aW9uKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IHBpZWNlLmdldEF0dHJpYnV0ZSgnZGF0YS1wYXJhbGxheC10cmFuc2xhdGlvbicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zWCA9IHQvKHNlbGYuZGltZW5zaW9ucy53aWR0aCkqZXYuY2xpZW50WCAtIHQvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc1kgPSB0LyhzZWxmLmRpbWVuc2lvbnMuaGVpZ2h0KSpldi5jbGllbnRZIC0gdC8yO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZS5wYXJlbnROb2RlLnN0eWxlLnRyYW5zZm9ybSA9IHBpZWNlLnBhcmVudE5vZGUuc3R5bGUuV2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKCcgKyB0cmFuc1ggKyAncHgsJyArIHRyYW5zWSArICdweCwwKSc7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm1vdXNlbW92ZSk7XG5cbiAgICAgICAgICAgIHRoaXMuaGFuZGxlT3JpZW50YXRpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiggIXNlbGYuYWN0aXZlICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciB5ID0gZXZlbnQuZ2FtbWE7XG4gICAgICAgICAgICAgICAgLy8gVG8gbWFrZSBjb21wdXRhdGlvbiBlYXNpZXIgd2Ugc2hpZnQgdGhlIHJhbmdlIG9mIHggYW5kIHkgdG8gWzAsMTgwXVxuICAgICAgICAgICAgICAgIHkgKz0gOTA7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnBpZWNlcy5mb3JFYWNoKGZ1bmN0aW9uKHBpZWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IHBpZWNlLmdldEF0dHJpYnV0ZSgnZGF0YS1wYXJhbGxheC10cmFuc2xhdGlvbicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zWCA9IHQvKHNlbGYuZGltZW5zaW9ucy53aWR0aCkqeSAtIHQvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc1kgPSB0LyhzZWxmLmRpbWVuc2lvbnMuaGVpZ2h0KSp5IC0gdC8yO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZS5wYXJlbnROb2RlLnN0eWxlLnRyYW5zZm9ybSA9IHBpZWNlLnBhcmVudE5vZGUuc3R5bGUuV2Via2l0VHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKCcgKyB0cmFuc1ggKyAncHgsJyArIHRyYW5zWSArICdweCwwKSc7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZW9yaWVudGF0aW9uJywgdGhpcy5oYW5kbGVPcmllbnRhdGlvbik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgd2luZG93LlNlZ21lbnRlciA9IFNlZ21lbnRlcjtcblxufSkod2luZG93KTtcblxuICAgICAgICAgICAgICAgZnVuY3Rpb24gaW1hZ2VBbmltYXRpb24oKSB7XG4gICAgICAgICAgdmFyIGhlYWRsaW5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRyaWdnZXItaGVhZGxpbmUnKTtcbiAgICAgICAgICB2YXIgaGVhZGxpbmV0b20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudHJpZ2dlci1oZWFkbGluZS10b20nKSxcbiAgICAgICAgICAgIFxuICAgICAgICAgIHRyaWdnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaG9tZScpLFxuICAgICAgICAgIHNlZ21lbnRlciA9IG5ldyBTZWdtZW50ZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlZ21lbnRlcicpLCB7XG4gICAgICAgICAgICBwaWVjZXM6IDksXG4gICAgICAgICAgICBwb3NpdGlvbnM6IFtcbiAgICAgICAgICAgIHt0b3A6IDMwLCBsZWZ0OiA1LCB3aWR0aDogNDAsIGhlaWdodDogODB9LFxuICAgICAgICAgICAge3RvcDogNTAsIGxlZnQ6IDI1LCB3aWR0aDogMzAsIGhlaWdodDogMzB9LFxuICAgICAgICAgICAge3RvcDogNSwgbGVmdDogNzUsIHdpZHRoOiA0MCwgaGVpZ2h0OiAyMH0sXG4gICAgICAgICAgICB7dG9wOiAzMCwgbGVmdDogNDUsIHdpZHRoOiA0MCwgaGVpZ2h0OiAyMH0sXG4gICAgICAgICAgICB7dG9wOiA0NSwgbGVmdDogMTUsIHdpZHRoOiA1MCwgaGVpZ2h0OiA0MH0sXG4gICAgICAgICAgICB7dG9wOiAxMCwgbGVmdDogNDAsIHdpZHRoOiAxMCwgaGVpZ2h0OiAyMH0sXG4gICAgICAgICAgICB7dG9wOiAyMCwgbGVmdDogNTAsIHdpZHRoOiAzMCwgaGVpZ2h0OiA3MH0sXG4gICAgICAgICAgICB7dG9wOiAwLCBsZWZ0OiAxMCwgd2lkdGg6IDUwLCBoZWlnaHQ6IDYwfSxcbiAgICAgICAgICAgIHt0b3A6IDcwLCBsZWZ0OiA0MCwgd2lkdGg6IDMwLCBoZWlnaHQ6IDMwfVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGFuaW1hdGlvbjoge1xuICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgICAgICAgZWFzaW5nOiAnZWFzZUluT3V0Q3ViaWMnLFxuICAgICAgICAgICAgICBkZWxheTogMCxcbiAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgdHJhbnNsYXRlWjogODUsXG4gICAgICAgICAgICAgIHRyYW5zbGF0ZVg6IHttaW46IC0yMCwgbWF4OiAyMH0sXG4gICAgICAgICAgICAgIHRyYW5zbGF0ZVk6IHttaW46IC0yMCwgbWF4OiAyMH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXJhbGxheDogdHJ1ZSxcbiAgICAgICAgICAgIHBhcmFsbGF4TW92ZW1lbnQ6IHttaW46IC0xMCwgbWF4OiAtNX0sXG4gICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgaWYgKCQoJyNob21lX3NlYycpLmNzcygndG9wJykgPD0gJzBweCcpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICBoZWFkbGluZS5jbGFzc0xpc3QucmVtb3ZlKCd0cmlnZ2VyLWhlYWRsaW5lLS1oaWRkZW4nKTtcbiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgIGhlYWRsaW5ldG9tLmNsYXNzTGlzdC5yZW1vdmUoJ3RyaWdnZXItaGVhZGxpbmUtdG9tLS1oaWRkZW4nKTtcbiAgICAgICAgICAgICAgICAgc2VnbWVudGVyLmFuaW1hdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgfSwgMzUwKVxuICAgICAgICAgICAgICAgfSwgMTAwMClcbiAgICAgICAgICAgICAgfSAgICAgICAgICBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgaGVhZGxpbmUuY2xhc3NMaXN0LmFkZCgndHJpZ2dlci1oZWFkbGluZS0taGlkZGVuJyk7XG4gICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGhlYWRsaW5ldG9tLmNsYXNzTGlzdC5hZGQoJ3RyaWdnZXItaGVhZGxpbmUtdG9tLS1oaWRkZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMjAwKVxuICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2VnbWVudGVyLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICBoZWFkbGluZS5jbGFzc0xpc3QucmVtb3ZlKCd0cmlnZ2VyLWhlYWRsaW5lLS1oaWRkZW4nKTtcbiAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGhlYWRsaW5ldG9tLmNsYXNzTGlzdC5yZW1vdmUoJ3RyaWdnZXItaGVhZGxpbmUtdG9tLS1oaWRkZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMzUwKVxuICAgICAgICAgICAgICBzZWdtZW50ZXIuYW5pbWF0ZSgpO1xuICAgICAgICAgICAgfSwgMTAwMCkgIFxuXG4gICAgICAgICAgfSwgMTAwMCkgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGltYWdlQW5pbWF0aW9uKCk7IFxuICAgIH0sXG4gICAgb25JbnRyb0NvbXBsZXRlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIFR3ZWVuTWF4LnNldCh0aGlzLnZpZXcsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgfSlcbiAgICB9LFxuICAgIG9uT3V0cm9Db21wbGV0ZTogZnVuY3Rpb24oZSkge1xuICAgICAgICBUd2Vlbk1heC5zZXQodGhpcy52aWV3LCB7XG4gICAgICAgICAgICBkaXNwbGF5OiBcIm5vbmVcIlxuICAgICAgICB9KSwgdGhpcy5kaXNwYXRjaGVyLmRpc3BhdGNoKFwiT1VUUk9fRE9ORV9FVkVOVFwiKVxuICAgIH0sXG4gICAgYmluZEV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3NFdmVudCA9IHRoaXMuZGlzcGF0Y2hlci5hZGRFdmVudGxpc3RlbmVyKFwiQU1fUFJPR1JFU1NfR1wiLCB0aGlzLnVwZGF0ZVByb2dyZXNzLmJpbmQodGhpcykpLCB0aGlzLmNvbXBsZXRlRXZlbnQgPSB0aGlzLmRpc3BhdGNoZXIuYWRkRXZlbnRsaXN0ZW5lcihcIkFNX0NPTVBMRVRFX0dcIiwgdGhpcy5vbkxvYWRlZC5iaW5kKHRoaXMpKVxuICAgIH0sXG4gICAgaW50cm86IGZ1bmN0aW9uKCkge1xuICAgICAgICBUd2Vlbk1heC5mcm9tVG8odGhpcy52aWV3LCAxLCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiB0aGlzLm9uSW50cm9Db21wbGV0ZS5iaW5kKHRoaXMpXG4gICAgICAgIH0pXG4gICAgfSxcbiAgICBvdXRybzogZnVuY3Rpb24oKSB7XG4gICAgICAgIFR3ZWVuTWF4LmZyb21Ubyh0aGlzLnZpZXcsIC43NSwge1xuICAgICAgICAgICAgeTogMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICB5OiB0aGlzLnZoLFxuICAgICAgICAgICAgZGVsYXk6IC43NSxcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyNC5lYXNlT3V0LFxuICAgICAgICAgICAgb25Db21wbGV0ZTogdGhpcy5vbk91dHJvQ29tcGxldGUuYmluZCh0aGlzKVxuICAgICAgICB9KSwgVHdlZW5NYXguZnJvbVRvKCQoXCIjZGltbWVyXCIpLCAuNzUsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIGRlbGF5OiAuNSxcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyNC5lYXNlSW4sXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKFwiI2RpbW1lclwiKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBcInotaW5kZXhcIjogOSxcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogXCIwXCJcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgIH0pXG4gICAgfVxufSwgc2Nyb2xsVmlldyA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLmRpc3BhdGNoZXIgPSB2b2lkIDAgIT09IGUgPyBlIDogbmV3IERpc3BhdGNoZXIsIHRoaXMuZGV2aWNlID0gRGV0ZWN0aXpyLmRldmljZS50eXBlLCB0aGlzLmNvbnRyb2xsZXIgPSBuZXcgU2Nyb2xsTWFnaWMuQ29udHJvbGxlciwgdGhpcy5zZWN0aW9ucyA9IFtcImhvbWVfc2VjXCIsIFwic3Rvcnlfc2VjXCIsIFwiY2FzdG5jcmV3X3NlY1wiLCBcImdhbGxlcnlfc2VjXCIsIFwidmlkZW9zX3NlY1wiLCBcInRpY2tldHNfc2VjXCJdLCB0aGlzLnNlY3Rpb25OYW1lcyA9IFtcImhvbWVcIiwgXCJzdG9yeVwiLCBcImNhc3RuY3Jld1wiLCBcImdhbGxlcnlcIiwgXCJ2aWRlb3NcIiwgXCJ0aWNrZXRzXCJdLCB0aGlzLmN1clNlY3Rpb24gPSAwLCB0aGlzLnNjcm9sbEhlaWdodCA9IDAsIHRoaXMuc2Nyb2xsT2Zmc2V0ID0gMCwgdGhpcy5zY2VuZXMgPSBbXSwgdGhpcy5uYXZTY2VuZXMgPSBbXSwgdGhpcy5jbGllbnRIZWlnaHQsIHRoaXMuc2Nyb2xsVG8sIHRoaXMuc2Nyb2xsUG9zXG59LCBzY3JvbGxWaWV3LnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3Rvcjogc2Nyb2xsVmlldyxcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzcGF0Y2hlci5kaXNwYXRjaChcIlNDUk9MTF9JTklUXCIpLCB0aGlzLmJpbmRFdmVudHMoKSwgdGhpcy5zZXRib2R5SGVpZ2h0KCksIFxuICAgICAgICAgICAgdGhpcy5jcmVhdGVOYXZTY2VuZShcIm5hdmJhclwiLCB0aGlzLnNjcm9sbEhlaWdodCAtIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuc2VjdGlvbnNbMF0pLmNsaWVudEhlaWdodCwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5zZWN0aW9uc1swXSkuY2xpZW50SGVpZ2h0LCBcIm5hdmJhclwiLCBcIi5uYXZiYXJcIiwgXCJuYXYtZGFya2VuXCIpLFxuICAgICAgICAgICAgdGhpcy5jcmVhdGVOYXZTY2VuZShcImZvb3RlclwiLCB0aGlzLnNjcm9sbEhlaWdodCAtIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuc2VjdGlvbnNbMF0pLmNsaWVudEhlaWdodCwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5zZWN0aW9uc1swXSkuY2xpZW50SGVpZ2h0LCBcImZvb3RlclwiLCBcIi5mb290ZXJcIiwgXCJuYXYtZGFya2VuXCIpLCBcImRlc2t0b3BcIiA9PSB0aGlzLmRldmljZSlcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlU2NlbmUoXCJob21lX3NlY1Njcm9sbFwiLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImhvbWVfc2VjXCIpLmNsaWVudEhlaWdodCwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJob21lX3NlY1wiKS5jbGllbnRIZWlnaHQsIHRoaXMuZ2V0T2Zmc2V0KDApLCB0aGlzLnNlY3Rpb25zWzBdLCBcIiNuYXYtXCIgKyB0aGlzLnNlY3Rpb25OYW1lc1swXSwgXCJhY3RpdmVcIiwgMCksIFxuICAgICAgICAgICAgdGhpcy5jcmVhdGVTY2VuZShcInN0b3J5X3NlY1Njcm9sbFwiLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0b3J5X3NlY1wiKS5jbGllbnRIZWlnaHQsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3Rvcnlfc2VjXCIpLmNsaWVudEhlaWdodCwgdGhpcy5nZXRPZmZzZXQoMSksIHRoaXMuc2VjdGlvbnNbMV0sIFwiI25hdi1cIiArIHRoaXMuc2VjdGlvbk5hbWVzWzFdLCBcImFjdGl2ZVwiLCAxKSxcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlU2NlbmUoXCJjYXN0bmNyZXdfc2VjU2Nyb2xsXCIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FzdG5jcmV3X3NlY1wiKS5jbGllbnRIZWlnaHQsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FzdG5jcmV3X3NlY1wiKS5jbGllbnRIZWlnaHQsIHRoaXMuZ2V0T2Zmc2V0KDIpLCB0aGlzLnNlY3Rpb25zWzJdLCBcIiNuYXYtXCIgKyB0aGlzLnNlY3Rpb25OYW1lc1syXSwgXCJhY3RpdmVcIiwgMiksXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVNjZW5lKFwiZ2FsbGVyeV9zZWNTY3JvbGxcIiwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnYWxsZXJ5X3NlY1wiKS5jbGllbnRIZWlnaHQsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZ2FsbGVyeV9zZWNcIikuY2xpZW50SGVpZ2h0LCB0aGlzLmdldE9mZnNldCgzKSwgdGhpcy5zZWN0aW9uc1szXSwgXCIjbmF2LVwiICsgdGhpcy5zZWN0aW9uTmFtZXNbM10sIFwiYWN0aXZlXCIsIDMpLCBcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlU2NlbmUoXCJ2aWRlb3Nfc2VjU2Nyb2xsXCIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9zX3NlY1wiKS5jbGllbnRIZWlnaHQsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9zX3NlY1wiKS5jbGllbnRIZWlnaHQsIHRoaXMuZ2V0T2Zmc2V0KDQpLCB0aGlzLnNlY3Rpb25zWzRdLCBcIiNuYXYtXCIgKyB0aGlzLnNlY3Rpb25OYW1lc1s0XSwgXCJhY3RpdmVcIiwgNCksXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVNjZW5lKFwidGlja2V0c19zZWNTY3JvbGxcIiwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0aWNrZXRzX3NlY1wiKS5jbGllbnRIZWlnaHQsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGlja2V0c19zZWNcIikuY2xpZW50SGVpZ2h0LCB0aGlzLmdldE9mZnNldCg1KSwgdGhpcy5zZWN0aW9uc1s1XSwgXCIjbmF2LVwiICsgdGhpcy5zZWN0aW9uTmFtZXNbNV0sIFwiYWN0aXZlXCIsIDUpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5zZWN0aW9ucy5sZW5ndGg7IGkrKykgdGhpcy5jcmVhdGVNb2JpbGVTY2VuZSh0aGlzLnNlY3Rpb25zW2ldICsgXCJTY3JvbGxcIiwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5zZWN0aW9uc1tpXSkuY2xpZW50SGVpZ2h0LCB0aGlzLmdldE9mZnNldChpKSwgdGhpcy5zZWN0aW9uc1tpXSwgXCIjbmF2LVwiICsgdGhpcy5zZWN0aW9uTmFtZXNbaV0sIFwiYWN0aXZlXCIsIGkpXG4gICAgfSxcbiAgICBiaW5kRXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5oYXNoRXZlbnQgPSB0aGlzLmRpc3BhdGNoZXIuYWRkRXZlbnRsaXN0ZW5lcihcIkhBU0hfRVZFTlRcIiwgdGhpcy5vbkhhc2hFdmVudC5iaW5kKHRoaXMpKSwgXCJkZXNrdG9wXCIgPT0gdGhpcy5kZXZpY2UgJiYgJCh3aW5kb3cpLnJlc2l6ZSh0aGlzLnJlc2l6ZS5iaW5kKHRoaXMpKSwgJChcIi5uYXZiYXItbWFpbiBsaVwiKS5jbGljayh0aGlzLm5hdmlnYXRlT25DbGljay5iaW5kKHRoaXMpKSwgJChcIi5uYXZiYXItdG9nZ2xlXCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcyhcIm9wZW5cIik7XG5cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaGFzaEV2ZW50ID0gdGhpcy5kaXNwYXRjaGVyLmFkZEV2ZW50bGlzdGVuZXIoXCJIQVNIX0VWRU5UXCIsIHRoaXMub25IYXNoRXZlbnQuYmluZCh0aGlzKSksIFwiZGVza3RvcFwiID09IHRoaXMuZGV2aWNlICYmICQod2luZG93KS5yZXNpemUodGhpcy5yZXNpemUuYmluZCh0aGlzKSksICQoXCIubmF2YmFyLXJpZ2h0IGxpXCIpLmNsaWNrKHRoaXMubmF2aWdhdGVPbkNsaWNrLmJpbmQodGhpcykpLCAkKFwiLm5hdmJhci10b2dnbGVcIikuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKFwib3BlblwiKVxuICAgICAgICB9KTtcblxuICAgXG5cbiAgXG5cbiAgICAkKFwiI3N0b3J5LXdyYXBwZXJcIikuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIFR3ZWVuTWF4LnRvKCQoXCJib2R5XCIpLCAxLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUbzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IHdpbmRvdy5pbm5lckhlaWdodCAqIDYuNzg1XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZWFzZTogUG93ZXI0LmVhc2VJbk91dCxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgIH0sXG4gICAgb25IYXNoRXZlbnQ6IGZ1bmN0aW9uKGUsIHQpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxUbyA9IHQsIHRoaXMubmF2aWdhdGVUbyh0aGlzLnNjcm9sbFRvKVxuICAgIH0sXG4gICAgc2V0Ym9keUhlaWdodDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGZvciAodGhpcy5zY3JvbGxIZWlnaHQgPSAwLCBpID0gMDsgaSA8IHRoaXMuc2VjdGlvbnMubGVuZ3RoOyBpKyspIHRoaXMuc2Nyb2xsSGVpZ2h0ID0gdGhpcy5zY3JvbGxIZWlnaHQgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnNlY3Rpb25zW2ldKS5jbGllbnRIZWlnaHQ7XG4gICAgICAgICQoXCJib2R5XCIpLmNzcyhcImhlaWdodFwiLCB0aGlzLnNjcm9sbEhlaWdodCArIFwicHhcIilcbiAgICB9LFxuICAgIGNyZWF0ZVNjZW5lOiBmdW5jdGlvbihlLCB0LCBzLCBvLCBuLCBhLCByLCBjKSB7XG4gICAgICAgIHZhciBkID0gbmV3IFRpbWVsaW5lTWF4O1xuICAgICAgICBcInN0b3J5X3NlY1Njcm9sbFwiID09PSBlID8gZC50byhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChuKSwgMSwge1xuICAgICAgICAgICAgdG9wOiAtMSAqIHMgKyBcInB4XCIsXG4gICAgICAgICAgICBvblVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaGVyLmRpc3BhdGNoKFwiU1RPUllfU0NST0xMX0VWRU5UXCIsIHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3Rvcnlfc2VjXCIpLnN0eWxlLnRvcCkpXG4gICAgICAgICAgICB9LmJpbmQodGhpcyksXG4gICAgICAgICAgICBmb3JjZTNEOiAhMCxcbiAgICAgICAgICAgIGF1dG9Sb3VuZDogITEsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjAuZWFzZU5vbmVcbiAgICAgICAgfSkgOiBkLnRvKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG4pLCAxLCB7XG4gICAgICAgICAgICB0b3A6IC0xICogcyArIFwicHhcIixcbiAgICAgICAgICAgIGZvcmNlM0Q6ICEwLFxuICAgICAgICAgICAgYXV0b1JvdW5kOiAhMSxcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMC5lYXNlTm9uZVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGUgPSBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUoe1xuICAgICAgICAgICAgdHJpZ2dlckVsZW1lbnQ6IFwiYm9keVwiLFxuICAgICAgICAgICAgdHJpZ2dlckhvb2s6IFwib25MZWF2ZVwiLFxuICAgICAgICAgICAgZHVyYXRpb246IHQsXG4gICAgICAgICAgICBvZmZzZXQ6IG8sXG4gICAgICAgICAgICByZXZlcnNlOiAhMFxuICAgICAgICB9KS5zZXRUd2VlbihkKS5zZXRDbGFzc1RvZ2dsZShhLCByKS5vbihcImxlYXZlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIFwiRk9SV0FSRFwiID09PSBlLnRhcmdldC5jb250cm9sbGVyKCkuaW5mbyhcInNjcm9sbERpcmVjdGlvblwiKSA/ICh0aGlzLmN1clNlY3Rpb24rKywgdGhpcy5jdXJTZWN0aW9uID4gNiAmJiAodGhpcy5jdXJTZWN0aW9uID0gNiksIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gdGhpcy5zZWN0aW9uTmFtZXNbdGhpcy5jdXJTZWN0aW9uXSkgOiAodGhpcy5jdXJTZWN0aW9uLS0sIHRoaXMuY3VyU2VjdGlvbiA8IDAgJiYgKHRoaXMuY3VyU2VjdGlvbiA9IDApLCB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHRoaXMuc2VjdGlvbk5hbWVzW3RoaXMuY3VyU2VjdGlvbl0pXG4gICAgICAgIH0uYmluZCh0aGlzKSkuYWRkVG8odGhpcy5jb250cm9sbGVyKTtcbiAgICAgICAgZS5pbmRpY2F0b3IgPSBuLCBlLmNoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobikuY2xpZW50SGVpZ2h0LCBlLmlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobiksIGUuaW5kZXggPSBpLCB0aGlzLnNjZW5lcy5wdXNoKGUpXG4gICAgfSxcbiAgICBjcmVhdGVNb2JpbGVTY2VuZTogZnVuY3Rpb24oZSwgdCwgaSwgcywgbywgbiwgYSkge1xuICAgICAgICBuZXcgU2Nyb2xsTWFnaWMuU2NlbmUoe1xuICAgICAgICAgICAgdHJpZ2dlckVsZW1lbnQ6IFwiYm9keVwiLFxuICAgICAgICAgICAgdHJpZ2dlckhvb2s6IFwib25MZWF2ZVwiLFxuICAgICAgICAgICAgZHVyYXRpb246IHQsXG4gICAgICAgICAgICBvZmZzZXQ6IGksXG4gICAgICAgICAgICByZXZlcnNlOiAhMFxuICAgICAgICB9KS5zZXRDbGFzc1RvZ2dsZShvLCBuKS5vbihcImxlYXZlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIFwiRk9SV0FSRFwiID09PSBlLnRhcmdldC5jb250cm9sbGVyKCkuaW5mbyhcInNjcm9sbERpcmVjdGlvblwiKSA/IHRoaXMuY3VyU2VjdGlvbisrIDogdGhpcy5jdXJTZWN0aW9uLS1cbiAgICAgICAgfS5iaW5kKHRoaXMpKS5hZGRUbyh0aGlzLmNvbnRyb2xsZXIpXG4gICAgfSxcbiAgICBjcmVhdGVOYXZTY2VuZTogZnVuY3Rpb24oZSwgdCwgcywgbywgbiwgYSkge1xuICAgICAgICB2YXIgZSA9IG5ldyBTY3JvbGxNYWdpYy5TY2VuZSh7XG4gICAgICAgICAgICB0cmlnZ2VyRWxlbWVudDogXCJib2R5XCIsXG4gICAgICAgICAgICB0cmlnZ2VySG9vazogXCJvbkxlYXZlXCIsXG4gICAgICAgICAgICBkdXJhdGlvbjogdCxcbiAgICAgICAgICAgIG9mZnNldDogcyxcbiAgICAgICAgICAgIHJldmVyc2U6ICEwXG4gICAgICAgIH0pLnNldENsYXNzVG9nZ2xlKG4sIGEpLm9uKFwibGVhdmVcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgJChcIi5uYXZiYXJcIikuYWRkQ2xhc3MoXCJuYXYtbGlnaHRlblwiKSwgJChcIiNmb290ZXJcIikuYWRkQ2xhc3MoXCJuYXYtbGlnaHRlblwiKSwgXCJkZXNrdG9wXCIgPT0gdGhpcy5kZXZpY2UgJiYgVHdlZW5NYXguZnJvbVRvKCQoXCIubmF2YmFyLWJyYW5kXCIpLCAuNSwge1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgICAgeDogMFxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgeDogLTI1LFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LmJpbmQodGhpcykpLm9uKFwiZW50ZXJcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgJChcIi5uYXZiYXJcIikucmVtb3ZlQ2xhc3MoXCJuYXYtbGlnaHRlblwiKSwgJChcIiNmb290ZXJcIikucmVtb3ZlQ2xhc3MoXCJuYXYtbGlnaHRlblwiKSwgXCJkZXNrdG9wXCIgPT0gdGhpcy5kZXZpY2UgJiYgVHdlZW5NYXguZnJvbVRvKCQoXCIubmF2YmFyLWJyYW5kXCIpLCAuNSwge1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgeDogLTI1XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgICBkZWxheTogLjUsXG4gICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfS5iaW5kKHRoaXMpKS5hZGRUbyh0aGlzLmNvbnRyb2xsZXIpO1xuICAgICAgICBlLmluZGljYXRvciA9IG8sIGUuY2ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvKS5jbGllbnRIZWlnaHQsIGUuaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvKSwgZS5pbmRleCA9IGksIHRoaXMubmF2U2NlbmVzLnB1c2goZSlcbiAgICB9LFxuICAgIG5hdmlnYXRlT25DbGljazogZnVuY3Rpb24oZSkge1xuICAgICAgICBcImRlc2t0b3BcIiAhPT0gdGhpcy5kZXZpY2UgJiYgJChcIi5uYXZiYXItdG9nZ2xlXCIpLmNsaWNrKCksIHRoaXMuc2Nyb2xsVG8gPSAkKGUuY3VycmVudFRhcmdldCkuYXR0cihcImlkXCIpLCB0aGlzLnNjcm9sbFRvID0gdGhpcy5zZWN0aW9uTmFtZXMuaW5kZXhPZih0aGlzLnNjcm9sbFRvLnN1YnN0cmluZyg0KSksIHRoaXMubmF2aWdhdGVUbyh0aGlzLnNjcm9sbFRvKVxuICAgICAgICAgICAgaWYgKCQoJyNob21lX3NlYycpLmNzcygndG9wJykgPD0gJzBweCcpIHsgXG5cbiAgICAgICAgICAgICAoJCgnI25hdi1vdmVybGF5JykuY3NzKCdvcGFjaXR5JywgJzAnKSk7IFxuXG4gICAgICAgIH1cblxuICAgICAgICAgIGlmICgkKCcjc3Rvcnlfc2VjJykuY3NzKCd0b3AnKSA8PSAnLTEwMCUnIHx8ICgkKCcjczFfdGV4dDEnKS5jc3MoJ29wYWNpdHknKSA9PSAnMScpKSB7IFxuXG4gICAgICAgICAgICAgKCQoJyNuYXYtb3ZlcmxheScpLmNzcygnb3BhY2l0eScsICcwJykpOyBcblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCQoJyNzdG9yeV9zZWMnKS5jc3MoJ3RvcCcpIDw9ICctMTAwJScgfHwgKCQoJyNzMV90ZXh0MScpLmNzcygnb3BhY2l0eScpID09ICcwJykpIHtcbiAgICAgICAgICAgICAoJCgnI25hdi1vdmVybGF5JykuY3NzKCdvcGFjaXR5JywgJzEnKSk7IFxuICAgICAgICB9XG4gICAgfSxcbiAgICBuYXZpZ2F0ZVRvOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGZvciAodGhpcy5zY3JvbGxQb3MgPSAwLCBpID0gMDsgaSA8IHRoaXMuc2Nyb2xsVG87IGkrKykgdGhpcy5zY3JvbGxQb3MgPSB0aGlzLnNjcm9sbFBvcyArIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuc2VjdGlvbnNbaV0pLmNsaWVudEhlaWdodDtcbiAgICAgICAgXCJtb2JpbGVcIiAhPT0gYXBwLmRldmljZSAmJiAod2luZG93LmxvY2F0aW9uLmhhc2ggPSB0aGlzLnNlY3Rpb25OYW1lc1tpXSksIFwiZGVza3RvcFwiID09IHRoaXMuZGV2aWNlID8gZSA8IHRoaXMuY3VyU2VjdGlvbiA/IChUd2Vlbk1heC5zZXQoJChcIiNuYXYtbG9ja1wiKSwge1xuICAgICAgICAgICAgXCJ6LWluZGV4XCI6IFwiMTFcIlxuICAgICAgICB9KSwgVHdlZW5NYXguZnJvbVRvKCQoXCIjbmF2LW1hc2tcIiksIC43NSwge1xuICAgICAgICAgICAgY2xpcDogXCJyZWN0KDBweCwgXCIgKyB3aW5kb3cuaW5uZXJXaWR0aCArIFwicHgsIDBweCwgMHB4KVwiXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIFwiICsgd2luZG93LmlubmVyV2lkdGggKyBcInB4LCBcIiArIHdpbmRvdy5pbm5lckhlaWdodCArIFwicHgsIDBweClcIixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlSW5PdXQsXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKFwiYm9keVwiKS5zY3JvbGxUb3AodGhpcy5zY3JvbGxQb3MpLCBUd2Vlbk1heC5mcm9tVG8oJChcIiNuYXYtbWFza1wiKSwgMSwge1xuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjEuZWFzZU91dCxcbiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuTWF4LnNldCgkKFwiI25hdi1tYXNrXCIpLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpcDogXCJyZWN0KDBweCwgXCIgKyB3aW5kb3cuaW5uZXJXaWR0aCArIFwicHgsIDBweCwgMHB4KVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBUd2Vlbk1heC5zZXQoJChcIiNuYXYtbG9ja1wiKSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiei1pbmRleFwiOiBcIjFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgfSkpIDogZSA+IHRoaXMuY3VyU2VjdGlvbiA/IChUd2Vlbk1heC5zZXQoJChcIiNuYXYtbG9ja1wiKSwge1xuICAgICAgICAgICAgXCJ6LWluZGV4XCI6IFwiMTFcIlxuICAgICAgICB9KSwgVHdlZW5NYXguZnJvbVRvKCQoXCIjbmF2LW1hc2tcIiksIC43NSwge1xuICAgICAgICAgICAgY2xpcDogXCJyZWN0KFwiICsgd2luZG93LmlubmVySGVpZ2h0ICsgXCJweCwgXCIgKyB3aW5kb3cuaW5uZXJXaWR0aCArIFwicHgsIFwiICsgd2luZG93LmlubmVySGVpZ2h0ICsgXCJweCwgMHB4KVwiXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIFwiICsgd2luZG93LmlubmVyV2lkdGggKyBcInB4LCBcIiArIHdpbmRvdy5pbm5lckhlaWdodCArIFwicHgsIDBweClcIixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlSW5PdXQsXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKFwiYm9keVwiKS5zY3JvbGxUb3AodGhpcy5zY3JvbGxQb3MpLCBUd2Vlbk1heC5mcm9tVG8oJChcIiNuYXYtbWFza1wiKSwgMSwge1xuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjEuZWFzZU91dCxcbiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBUd2Vlbk1heC5zZXQoJChcIiNuYXYtbWFza1wiKSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaXA6IFwicmVjdCgwcHgsIFwiICsgd2luZG93LmlubmVyV2lkdGggKyBcInB4LCAwcHgsIDBweClcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSwgVHdlZW5NYXguc2V0KCQoXCIjbmF2LWxvY2tcIiksIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInotaW5kZXhcIjogXCIxXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgIH0pKSA6IGUgPT09IHRoaXMuY3VyU2VjdGlvbiA6ICQoXCJib2R5XCIpLnNjcm9sbFRvcCh0aGlzLnNjcm9sbFBvcylcbiAgICB9LFxuICAgIGdldFR3ZWVuOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIHJldHVybiBUd2Vlbk1heC5mcm9tVG8oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZSksIDEsIHtcbiAgICAgICAgICAgIHRvcDogXCIwcHhcIlxuICAgICAgICB9LCB7XG4gICAgICAgICAgICB0b3A6IC0xICogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZSkuY2xpZW50SGVpZ2h0ICsgXCJweFwiLFxuICAgICAgICAgICAgZm9yY2UzRDogITAsXG4gICAgICAgICAgICBhdXRvUm91bmQ6ICExLFxuICAgICAgICAgICAgZWFzZTogUG93ZXIwLmVhc2VOb25lXG4gICAgICAgIH0pXG4gICAgfSxcbiAgICBnZXRPZmZzZXQ6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIHQgPSAwO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZTsgaSsrKSB0ICs9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuc2VjdGlvbnNbaV0pLmNsaWVudEhlaWdodDtcbiAgICAgICAgcmV0dXJuIHRcbiAgICB9LFxuICAgIHJlc2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuc2V0Ym9keUhlaWdodCgpXG4gICAgICAgIGlmICghd2luZG93LnNjcmVlblRvcCAmJiAhd2luZG93LnNjcmVlblkpIHtcbiAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG59XG5cbiAgICB9LFxuICAgIHVwZGF0ZUZpeGVkVmFsdWVzOiBmdW5jdGlvbigpIHtcblxuICAgICAgICB0aGlzLnNjZW5lcy5mb3JFYWNoKGZ1bmN0aW9uKGUsIHQpIHtcbiAgICAgICAgICAgIHZhciBpID0gdGhpcy5nZXRUd2VlbihlLmluZGljYXRvcik7XG4gICAgICAgICAgICBpLnByb2dyZXNzKDApLCBlLnNldFR3ZWVuKGkpLCBlLm9mZnNldCh0aGlzLmdldE9mZnNldChlLmluZGV4KSksIGUuZHVyYXRpb24oZS5pZC5jbGllbnRIZWlnaHQpLCBlLnJlZnJlc2goKSwgZS51cGRhdGUoITApXG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHZhciBlID0gbmV3IFRpbWVsaW5lTWF4O1xuICAgICAgICBlLnRvKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3Rvcnlfc2VjXCIpLCAxLCB7XG4gICAgICAgICAgICB0b3A6IC0xICogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdG9yeV9zZWNcIikuY2xpZW50SGVpZ2h0ICsgXCJweFwiLFxuICAgICAgICAgICAgb25VcGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hlci5kaXNwYXRjaChcIlNUT1JZX1NDUk9MTF9FVkVOVFwiLCBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0b3J5X3NlY1wiKS5zdHlsZS50b3ApKVxuXG4gICAgICAgICAgICB9LmJpbmQodGhpcyksXG4gICAgICAgICAgICBmb3JjZTNEOiAhMCxcbiAgICAgICAgICAgIGF1dG9Sb3VuZDogITEsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjAuZWFzZU5vbmVcbiAgICAgICAgfSksIHRoaXMuc2NlbmVzW2ldLnNldFR3ZWVuKGUpLCB0aGlzLnNjZW5lc1tpXS5yZWZyZXNoKCksIHRoaXMuc2NlbmVzW2ldLnVwZGF0ZSghMCksIHRoaXMubmF2U2NlbmVzLmZvckVhY2goZnVuY3Rpb24oZSwgdCkge1xuICAgICAgICAgICAgZS5vZmZzZXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5zZWN0aW9uc1swXSkuY2xpZW50SGVpZ2h0KSwgZS5kdXJhdGlvbigkKHdpbmRvdykuaGVpZ2h0KCkgLSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnNlY3Rpb25zWzBdKS5jbGllbnRIZWlnaHQpLCBlLnJlZnJlc2goKSwgZS51cGRhdGUoITApXG4gICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICB9XG59LCBmb290ZXJWaWV3ID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuZGlzcGF0Y2hlciA9IHZvaWQgMCAhPT0gZSA/IGUgOiBuZXcgRGlzcGF0Y2hlciwgdGhpcy5kZXZpY2UgPSBEZXRlY3RpenIuZGV2aWNlLnR5cGVcbn0sIGZvb3RlclZpZXcucHJvdG90eXBlID0ge1xuICAgIGNvbnN0cnVjdG9yOiBmb290ZXJWaWV3LFxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmJpbmRFdmVudHMoKVxuICAgIH0sXG4gICAgcG9wdWxhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGF0YS5mb290ZXIuYmlsbGluZ0Jsb2NrLmxlbmd0aDsgaSsrKSAkKFwiLmZvb3Rlcl9iaWxsaW5nYmxvY2tfY29udGFpbmVyXCIpLmFwcGVuZCgnPGkgY2xhc3M9XCJmb290ZXJfYmlsbGluZ2Jsb2NrIGFtLWljb24gJyArIGRhdGEuZm9vdGVyLmJpbGxpbmdCbG9ja1tpXSArICdcIj48L2k+Jyk7XG4gICAgICAgIGZvciAoJChcIiNmb290ZXJfbG9nb3NcIikuYXBwZW5kKCc8cD4nICsgZGF0YS5mb290ZXIuZm9vdGVyVGV4dCArICc8L3A+JyksIGkgPSAwOyBpIDwgZGF0YS5mb290ZXIuZm9vdGVyTGlua3MubGVuZ3RoOyBpKyspIGRhdGEuZm9vdGVyLmZvb3RlckxpbmtzW2ldLmhhc093blByb3BlcnR5KFwibGlua1wiKSA/ICQoXCIjZm9vdGVyX2xpbmtzXCIpLmFwcGVuZCgnPGxpPjxhIGhyZWY9XCInICsgZGF0YS5mb290ZXIuZm9vdGVyTGlua3NbaV0ubGluayArICdcIiB0YXJnZXQ9XCJfYmxhbmtcIj4nICsgZGF0YS5mb290ZXIuZm9vdGVyTGlua3NbaV0ubGFiZWwgKyBcIjwvYT48L2xpPlwiKSA6ICQoXCIjZm9vdGVyX2xpbmtzXCIpLmFwcGVuZChcIjxsaT5cIiArIGRhdGEuZm9vdGVyLmZvb3RlckxpbmtzW2ldLmxhYmVsICsgXCI8L2xpPlwiKVxuICAgIH0sXG4gICAgYmluZEV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgICQoXCIjYnRuX3NvdW5kXCIpLm1vdXNlZW50ZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuYnRuX2Zvb3Rlcl9pbm5lclwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgYm9yZGVyOiBcIjFweCBzb2xpZCByZ2JhKDExNiwgMTQwLCAxMzIsIDEpXCIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLm1vdXNlbGVhdmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuYnRuX2Zvb3Rlcl9pbm5lclwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgYm9yZGVyOiBcIjFweCBzb2xpZCByZ2JhKDExNiwgMTQwLCAxMzIsIDAuNSlcIixcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSksICQoXCIjYnRuX2xlZ2FsXCIpLm1vdXNlZW50ZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuYnRuX2Zvb3Rlcl9pbm5lclwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgYm9yZGVyOiBcIjFweCBzb2xpZCByZ2JhKDExNiwgMTQwLCAxMzIsIDEpXCIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC5mcm9tVG8oJCh0aGlzKS5maW5kKFwicFwiKSwgLjIsIHtcbiAgICAgICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICB5OiA2LFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC5mcm9tVG8oJCh0aGlzKS5maW5kKFwicFwiKSwgLjIsIHtcbiAgICAgICAgICAgICAgICB5OiAtNixcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgICAgIGRlbGF5OiAuMixcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSkubW91c2VsZWF2ZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5idG5fZm9vdGVyX2lubmVyXCIpLCAuMjUsIHtcbiAgICAgICAgICAgICAgICBib3JkZXI6IFwiMXB4IHNvbGlkIHJnYmEoMTE2LCAxNDAsIDEzMiwgMC41KVwiLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXguZnJvbVRvKCQodGhpcykuZmluZChcInBcIiksIC4yLCB7XG4gICAgICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgeTogLTYsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LmZyb21UbygkKHRoaXMpLmZpbmQoXCJwXCIpLCAuMiwge1xuICAgICAgICAgICAgICAgIHk6IDYsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgICBkZWxheTogLjIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLCAkKFwiI2Zvb3Rlcl9jbG9zZVwiKS5tb3VzZWVudGVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgVHdlZW5NYXguc2V0KCQodGhpcykuZmluZChcIi5jbG9zZS1vdXRlclwiKSwge1xuICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogXCI1MCUgNTAlXCJcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC5zZXQoJCh0aGlzKS5maW5kKFwiLmNsb3NlLWlubmVyXCIpLCB7XG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiBcIjUwJSA1MCVcIlxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnNldCgkKHRoaXMpLmZpbmQoXCIuY2xvc2UtaW1nXCIpLCB7XG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtT3JpZ2luOiBcIjUwJSA1MCVcIlxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5jbG9zZS1vdXRlclwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgc2NhbGU6IDEuMixcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5jbG9zZS1pbm5lclwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgc2NhbGU6IDEuMTUsXG4gICAgICAgICAgICAgICAgYm9yZGVyOiBcIjFweCBzb2xpZCByZ2JhKDI1NSwgMjU0LCAyMzcsIDAuNzUpXCIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuY2xvc2UtaW1nXCIpLCAuNCwge1xuICAgICAgICAgICAgICAgIHJvdGF0aW9uOiA5MCxcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSkubW91c2VsZWF2ZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5jbG9zZS1vdXRlclwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgc2NhbGU6IDEsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuY2xvc2UtaW5uZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgIHNjYWxlOiAxLFxuICAgICAgICAgICAgICAgIGJvcmRlcjogXCIxcHggc29saWQgcmdiYSgyNTUsIDI1NCwgMjM3LCAwLjIpXCIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuY2xvc2UtaW1nXCIpLCAuNCwge1xuICAgICAgICAgICAgICAgIHJvdGF0aW9uOiAwLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KSwgJChcIiNidG5fbGVnYWxcIikuY2xpY2sodGhpcy5mb290ZXJFeHBhbmQuYmluZCh0aGlzKSksICQoXCIjbmF2X2xlZ2FsXCIpLmNsaWNrKHRoaXMuZm9vdGVyRXhwYW5kLmJpbmQodGhpcykpLCAkKFwiI2Zvb3Rlcl9jbG9zZVwiKS5jbGljayh0aGlzLmZvb3RlckNvbGxhcHNlLmJpbmQodGhpcykpLCB0aGlzLmNvbXBsZXRlRXZlbnQgPSB0aGlzLmRpc3BhdGNoZXIuYWRkRXZlbnRsaXN0ZW5lcihcIkFNX0NPTVBMRVRFX0dcIiwgdGhpcy5wb3B1bGF0ZS5iaW5kKHRoaXMpKSwgJChcIiNmb290ZXItb3ZlcmxheVwiKS5tb3VzZWxlYXZlKHRoaXMuZm9vdGVyQ29sbGFwc2UuYmluZCh0aGlzKSksICQoXCIjYnRuX3NvdW5kXCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJChcIi5iYXJcIikudG9nZ2xlQ2xhc3MoXCJiYXJPblwiKVxuICAgICAgICB9KVxuICAgIH0sXG4gICAgZm9vdGVyRXhwYW5kOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIFwibW9iaWxlXCIgPT0gdGhpcy5kZXZpY2UgPyAoJChcIi5uYXZiYXItdG9nZ2xlXCIpLmNsaWNrKCksICQoXCIjZm9vdGVyLW92ZXJsYXlcIikuaGFzQ2xhc3MoXCJtb2JpbGVfZm9vdGVyX2V4cGFuZGVkXCIpID8gdGhpcy5mb290ZXJDb2xsYXBzZSgpIDogKCQoXCIjZm9vdGVyLW92ZXJsYXlcIikucmVtb3ZlQ2xhc3MoXCJtb2JpbGVfZm9vdGVyX2NvbGxhcHNlZFwiKSwgJChcIiNmb290ZXItb3ZlcmxheVwiKS5hZGRDbGFzcyhcIm1vYmlsZV9mb290ZXJfZXhwYW5kZWRcIikpKSA6ICQoXCIjZm9vdGVyLW92ZXJsYXlcIikuaGFzQ2xhc3MoXCJmb290ZXJfZXhwYW5kZWRcIikgPyB0aGlzLmZvb3RlckNvbGxhcHNlKCkgOiAoJChcIiNmb290ZXItb3ZlcmxheVwiKS5yZW1vdmVDbGFzcyhcImZvb3Rlcl9jb2xsYXBzZWRcIiksICQoXCIjZm9vdGVyLW92ZXJsYXlcIikuYWRkQ2xhc3MoXCJmb290ZXJfZXhwYW5kZWRcIikpXG4gICAgfSxcbiAgICBmb290ZXJDb2xsYXBzZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIFwibW9iaWxlXCIgPT0gdGhpcy5kZXZpY2UgPyAkKFwiI2Zvb3Rlci1vdmVybGF5XCIpLmhhc0NsYXNzKFwibW9iaWxlX2Zvb3Rlcl9leHBhbmRlZFwiKSAmJiAkKFwiI2Zvb3Rlci1vdmVybGF5XCIpLnJlbW92ZUNsYXNzKFwibW9iaWxlX2Zvb3Rlcl9leHBhbmRlZFwiKS5hZGRDbGFzcyhcIm1vYmlsZV9mb290ZXJfY29sbGFwc2VkXCIpIDogJChcIiNmb290ZXItb3ZlcmxheVwiKS5oYXNDbGFzcyhcImZvb3Rlcl9leHBhbmRlZFwiKSAmJiAkKFwiI2Zvb3Rlci1vdmVybGF5XCIpLnJlbW92ZUNsYXNzKFwiZm9vdGVyX2V4cGFuZGVkXCIpLmFkZENsYXNzKFwiZm9vdGVyX2NvbGxhcHNlZFwiKVxuICAgIH1cbn0sICBzdG9yeVZpZXcgPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5kaXNwYXRjaGVyID0gdm9pZCAwICE9PSBlID8gZSA6IG5ldyBEaXNwYXRjaGVyLCB0aGlzLmRldmljZSA9IERldGVjdGl6ci5kZXZpY2UudHlwZSwgdGhpcy5jb250cm9sbGVyID0gbmV3IFNjcm9sbE1hZ2ljLkNvbnRyb2xsZXIsIHRoaXMuc2NlbmVzID0gW11cbn0sIHN0b3J5Vmlldy5wcm90b3R5cGUgPSB7XG4gICAgY29uc3RydWN0b3I6IHN0b3J5VmlldyxcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5iaW5kRXZlbnRzKClcbiAgICB9LFxuICAgIGJpbmRFdmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmNvbXBsZXRlRXZlbnQgPSB0aGlzLmRpc3BhdGNoZXIuYWRkRXZlbnRsaXN0ZW5lcihcIkFNX0NPTVBMRVRFX0dcIiwgdGhpcy5wb3B1bGF0ZS5iaW5kKHRoaXMpKSwgdGhpcy5zY3JvbGxVcGRhdGUgPSB0aGlzLmRpc3BhdGNoZXIuYWRkRXZlbnRsaXN0ZW5lcihcIlNUT1JZX1NDUk9MTF9FVkVOVFwiLCB0aGlzLnVwZGF0ZUJpbmQuYmluZCh0aGlzKSksIFwiZGVza3RvcFwiID09IHRoaXMuZGV2aWNlICYmICQod2luZG93KS5yZXNpemUodGhpcy51cGRhdGVGaXhlZFZhbHVlcy5iaW5kKHRoaXMpKVxuICAgIH0sXG4gICAgdXBkYXRlQmluZDogZnVuY3Rpb24oZSwgdCkge1xuICAgICAgICAgIGlmICgkKCcjc3Rvcnlfc2VjJykuY3NzKCd0b3AnKSA8PSAnLTEwMCUnIHx8ICgkKCcjczFfdGV4dDEnKS5jc3MoJ29wYWNpdHknKSA9PSAnMScpKSB7IFxuXG4gICAgICAgICAgICAgKCQoJyNuYXYtb3ZlcmxheScpLmNzcygnb3BhY2l0eScsICcwJykpOyBcblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCQoJyNzdG9yeV9zZWMnKS5jc3MoJ3RvcCcpIDw9ICctMTAwJScgfHwgKCQoJyNzMV90ZXh0MScpLmNzcygnb3BhY2l0eScpID09ICcwJykpIHtcbiAgICAgICAgICAgICAoJCgnI25hdi1vdmVybGF5JykuY3NzKCdvcGFjaXR5JywgJzEnKSk7IFxuICAgICAgICB9XG5cbiAgICAgIFxuICAgICAgICBcbiAgICAgICBUd2Vlbk1heC5zZXQoXCIuczFfdGV4dDFCXCIsIHtcbiAgICAgICAgICAgIHRvcDogXCJjYWxjKCA1MHZoICsgXCIgKyBNYXRoLmFicyh0KSArIFwicHgpXCJcbiAgICAgICAgfSksIFR3ZWVuTWF4LnNldChcIiNzNV90ZXh0X2FcIiwge1xuICAgICAgICAgICAgXCJtYXJnaW4tdG9wXCI6IFwiY2FsYyhcIiArIE1hdGguYWJzKHQpICsgXCJweCAtIDUyNXZoKVwiXG4gICAgICAgIH0pXG4gICAgfSxcbiAgICBwb3B1bGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKFwiI3N0b3J5MVwiKS5jc3MoXCJiYWNrZ3JvdW5kLWltYWdlXCIsIFwidXJsKCdcIiArIGFwcC5wcmVsb2FkZXIuZ2V0QXNzZXQoXCJzdG9yeTFiZ1wiKS5zcmMgKyBcIicpXCIpLFxuICAgICAgICAgICAgJChcIiNzMV9mZ1wiKS5hdHRyKFwic3JjXCIsIGFwcC5wcmVsb2FkZXIuZ2V0QXNzZXQoXCJzdG9yeTFmZ1wiKS5zcmMpLFxuICAgICAgICAgICAgJChcIiNzMV9jbG91ZDFcIikuYXR0cihcInNyY1wiLCBhcHAucHJlbG9hZGVyLmdldEFzc2V0KFwic3RvcnkxY2xvdWQxXCIpLnNyYyksXG4gICAgICAgICAgICAkKFwiI3MxX2Nsb3VkMlwiKS5hdHRyKFwic3JjXCIsIGFwcC5wcmVsb2FkZXIuZ2V0QXNzZXQoXCJzdG9yeTFjbG91ZDJcIikuc3JjKSxcbiAgICAgICAgICAgICQoXCIjczFfY2xvdWQzXCIpLmF0dHIoXCJzcmNcIiwgYXBwLnByZWxvYWRlci5nZXRBc3NldChcInN0b3J5MWNsb3VkM1wiKS5zcmMpLFxuXG5cbiAgICAgICAgICAgICQoXCIjc3Rvcnk2XCIpLmNzcyhcImJhY2tncm91bmQtaW1hZ2VcIiwgXCJ1cmwoJ1wiICsgYXBwLnByZWxvYWRlci5nZXRBc3NldChcInN0b3J5NmJnXCIpLnNyYyArIFwiJylcIiksXG4gICAgICAgICAgICAkKFwiI3M2X2ZnXCIpLmF0dHIoXCJzcmNcIiwgYXBwLnByZWxvYWRlci5nZXRBc3NldChcInN0b3J5NmZnXCIpLnNyYyksXG4gICAgICAgICAgICAkKFwiI3N0b3J5N1wiKS5jc3MoXCJiYWNrZ3JvdW5kLWltYWdlXCIsIFwidXJsKCdcIiArIGFwcC5wcmVsb2FkZXIuZ2V0QXNzZXQoXCJzdG9yeTdiZ1wiKS5zcmMgKyBcIicpXCIpLCBcIm1vYmlsZVwiICE9PSB0aGlzLmRldmljZSA/ICgkKFwiI3N0b3J5MlwiKS52aWRlKGFwcC5wcmVsb2FkZXIuZ2V0QXNzZXQoXCJzdG9yeTJ2aWRcIikuc3JjLCB7XG4gICAgICAgICAgICBwb3N0ZXJUeXBlOiBcImpwZ1wiLFxuICAgICAgICAgICAgYXV0b3BsYXk6ICEwLFxuICAgICAgICAgICAgbG9vcDogITBcbiAgICAgICAgfSksICQoXCIjc3RvcnkzXCIpLnZpZGUoYXBwLnByZWxvYWRlci5nZXRBc3NldChcInN0b3J5M3ZpZFwiKS5zcmMsIHtcbiAgICAgICAgICAgIHBvc3RlclR5cGU6IFwianBnXCIsXG4gICAgICAgICAgICBhdXRvcGxheTogITAsXG4gICAgICAgICAgICBsb29wOiAhMFxuICAgICAgICB9KSkgOiAoJChcIiNzdG9yeTJcIikuY3NzKFwiYmFja2dyb3VuZC1pbWFnZVwiLCBcInVybChcIiArIGFwcC5wcmVsb2FkZXIuZ2V0QXNzZXQoXCJzdG9yeTJiZ19tb2JcIikuc3JjICsgXCIpXCIpLCAkKFwiI3N0b3J5NFwiKS5jc3MoXCJiYWNrZ3JvdW5kLWltYWdlXCIsIFwidXJsKFwiICsgYXBwLnByZWxvYWRlci5nZXRBc3NldChcInN0b3J5NGJnX21vYlwiKS5zcmMgKyBcIilcIikpLFxuICAgICAgICAgXCJkZXNrdG9wXCIgPT0gdGhpcy5kZXZpY2UgPyB0d2VlbjFfMT1Ud2Vlbk1heC5mcm9tVG8oXCIuczFfdGV4dDFcIiwgLjUsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsIHk6IDBcbiAgICAgICAgfSx7XG4gICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgeTogNTAsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjQuZWFzZU91dCxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIFR3ZWVuTWF4LnNldChcIi5zMV90ZXh0MVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgICk6dHdlZW4xXzE9VHdlZW5NYXguZnJvbVRvKFwiLnMxX3RleHQxXCIsIC41LCB7XG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICB9LHtcbiAgICAgICAgICAgIHk6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodC13aW5kb3cuaW5uZXJIZWlnaHQsIG9wYWNpdHk6IDBcbiAgICAgICAgfVxuICAgICAgICApLCBcImRlc2t0b3BcIiA9PSB0aGlzLmRldmljZSA/IHR3ZWVuMV8yID0gVHdlZW5NYXguZnJvbVRvKFwiLnMxX3RleHQxQlwiLCAuNSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgIHk6IDUwMCxcbiAgICAgICAgICAgIFxuXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDQsXG4gICAgICAgICAgICB5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImhvbWVfc2VjXCIpLmNsaWVudEhlaWdodC13aW5kb3cuaW5uZXJIZWlnaHQgLyAxLjcsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjEuZWFzZU91dCxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgVHdlZW5NYXguc2V0KFwiLnMxX3RleHQxQlwiLCB7XG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgOiB0d2VlbjFfMiA9IFR3ZWVuTWF4LmZyb21UbyhcIi5zMV90ZXh0MUJcIiwgLjUsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICB5OiAwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0b3J5MVwiKS5jbGllbnRIZWlnaHQtd2luZG93LmlubmVySGVpZ2h0LFxuICAgICAgICB9KSwgdHdlZW4xXzMgPSBUd2Vlbk1heC5mcm9tVG8oXCIjczFfdGV4dDJcIiwgLjUsIHtcbiAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICBvcGFjaXR5OiAxXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHk6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodCAtIHdpbmRvdy5pbm5lckhlaWdodCxcbiAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgfSksIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgfSwgdHdlZW4xXzUgPSBUd2Vlbk1heC5mcm9tVG8oXCIjYnRuX3Njcm9sbFwiLCAuNSwge1xuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgeTogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodCAvIDMpIC0gd2luZG93LmlubmVySGVpZ2h0LFxuICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICB9KSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICB9LCAgdHdlZW4yXzEgPSBuZXcgVGltZWxpbmVNYXgsIHR3ZWVuMl8xLmZyb21UbyhcIiNzMl90ZXh0IGgxXCIsIC41LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjQuZWFzZUluT3V0XG4gICAgICAgIH0sIFwiZ3JvdXBcIikuZnJvbVRvKFwiI3MyX3RleHQgZGl2XCIsIC41LCB7XG4gICAgICAgICAgICBzY2FsZTogMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgICAgIGRlbGF5OiAuMyxcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMi5lYXNlSW5PdXRcbiAgICAgICAgfSwgXCJncm91cFwiKS5mcm9tVG8oXCIjczJfdGV4dCBwXCIsIC41LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBkZWxheTogLjksXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjIuZWFzZUluT3V0XG4gICAgICAgIH0sIFwiZ3JvdXBcIikuZnJvbVRvKFwiI3MyX3RleHQgaDJcIiwgLjUsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIGRlbGF5OiAuOSxcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMi5lYXNlSW5PdXRcbiAgICAgICAgfSwgXCJncm91cFwiKSxcbiAgICAgICAgICB0d2VlbjZfMSA9IG5ldyBUaW1lbGluZU1heCwgdHdlZW42XzEuZnJvbVRvKFwiI3M2X3RleHQgaDFcIiwgMC41LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjQuZWFzZUluT3V0XG4gICAgICAgIH0sIFwiZ3JvdXBcIikuZnJvbVRvKFwiI3M2X3RleHQgZGl2XCIsIC41LCB7XG4gICAgICAgICAgICBzY2FsZTogMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgICAgIGRlbGF5OiAuMyxcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMi5lYXNlSW5PdXRcbiAgICAgICAgfSwgXCJncm91cFwiKS5mcm9tVG8oXCIjczZfdGV4dCBwXCIsIC41LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBkZWxheTogLjYsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjIuZWFzZUluT3V0XG4gICAgICAgIH0sIFwiZ3JvdXBcIikuZnJvbVRvKFwiI3M2X3RleHQgaDJcIiwgLjUsIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIGRlbGF5OiAuNixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMi5lYXNlSW5PdXRcbiAgICAgICAgfSwgXCJncm91cFwiKSwgdHdlZW4xXzQgPSBuZXcgVGltZWxpbmVNYXgsIHR3ZWVuMV80LmZyb21UbyhcIiNzMV90ZXh0XCIsIC41LCB7XG4gICAgICAgICAgICB5OiAwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHk6IC0xMzBcbiAgICAgICAgfSwgXCJncnAxXCIpLmZyb21UbyhcIiNzMV9jbG91ZDFcIiwgLjUsIHtcbiAgICAgICAgICAgIHg6IC4wNSAqIHdpbmRvdy5pbm5lcldpZHRoXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHg6IC0uMDUgKiB3aW5kb3cuaW5uZXJXaWR0aFxuICAgICAgICB9LCBcImdycDFcIikuZnJvbVRvKFwiI3MxX2Nsb3VkMlwiLCAuNSwge1xuICAgICAgICAgICAgeDogLjAyICogd2luZG93LmlubmVyV2lkdGhcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgeDogLS4wMiAqIHdpbmRvdy5pbm5lcldpZHRoXG4gICAgICAgIH0sIFwiZ3JwMVwiKS5mcm9tVG8oXCIjczFfY2xvdWQzXCIsIC41LCB7XG4gICAgICAgICAgICB4OiA1MFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICB4OiAtNTBcbiAgICAgICAgfSwgXCJncnAxXCIpLCB0d2VlbjcgPSBuZXcgVGltZWxpbmVNYXgsIHR3ZWVuNy5mcm9tVG8oXCIjczdfdGV4dFwiLCAuNSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgZWFzZTogUG93ZXI0LmVhc2VJbk91dFxuICAgICAgICB9KS5mcm9tVG8oXCIjczdfdGV4dCBkaXZcIiwgLjUsIHtcbiAgICAgICAgICAgIHNjYWxlOiAwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHNjYWxlOiAxLFxuICAgICAgICAgICAgZWFzZTogUG93ZXIyLmVhc2VJbk91dFxuICAgICAgICB9KS5mcm9tVG8oXCIjczdfdGV4dCBoNFwiLCAuNSwge1xuICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgZWFzZTogUG93ZXIyLmVhc2VJbk91dFxuICAgICAgICB9KS5mcm9tVG8oXCIjczdfdGV4dCBwXCIsIC41LCB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjIuZWFzZUluT3V0XG4gICAgICAgIH0pLFxuXG4gICAgICAgIHRoaXMuY3JlYXRlU2NlbmUoXCJzdG9yeTFfMVwiLCAxNTAsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodC13aW5kb3cuaW5uZXJIZWlnaHQsIHR3ZWVuMV8xLCBcInN0b3J5MVwiKSxcbiAgICAgICAgdGhpcy5jcmVhdGVTY2VuZShcInN0b3J5MV8yXCIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodC80LCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0b3J5MVwiKS5jbGllbnRIZWlnaHQtMS4yNSp3aW5kb3cuaW5uZXJIZWlnaHQsIHR3ZWVuMV8yLCBcInN0b3J5MVwiKSxcbiAgICAgICAgdGhpcy5jcmVhdGVTY2VuZShcInN0b3J5MV8zXCIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodC8xLjUsIDIqZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzMV90ZXh0MlwiKS5jbGllbnRIZWlnaHQsIHR3ZWVuMV8zLCBcInN0b3J5MVwiKSxcbiAgICAgICAgdGhpcy5jcmVhdGVTY2VuZShcInN0b3J5MV80XCIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodCAvIDIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodCAtIDEuMjUgKiB3aW5kb3cuaW5uZXJIZWlnaHQsIHR3ZWVuMV80LCBcInN0b3J5MVwiKSxcbiAgICAgICAgdGhpcy5jcmVhdGVTY2VuZShcInN0b3J5MV81XCIsIDE1MCwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdG9yeTFcIikuY2xpZW50SGVpZ2h0IC0gd2luZG93LmlubmVySGVpZ2h0LCB0d2VlbjFfNSwgXCJzdG9yeTFcIiksXG4gICAgICAgIHRoaXMuY3JlYXRlU2NlbmUoXCJzdG9yeTJfMVwiLCAtMSAqIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0b3J5MlwiKS5jbGllbnRIZWlnaHQgLyA0KSwgMCwgdHdlZW4yXzEsIFwic3RvcnkyXCIpLFxuICAgICAgICB0aGlzLmNyZWF0ZVNjZW5lKFwic3Rvcnk2XzFcIiwgLTEgKiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdG9yeTZcIikuY2xpZW50SGVpZ2h0IC8gMiksIDAsIHR3ZWVuNl8xLCBcInN0b3J5NlwiKSwgXG5cbiAgICAgICAgdGhpcy5jcmVhdGVTY2VuZShcInN0b3J5N1wiLCAtMSAqIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0b3J5N1wiKS5jbGllbnRIZWlnaHQgLyAyKSwgMCwgdHdlZW43LCBcInN0b3J5N1wiKSxcbiAgICAgICAgdGhpcy51cGRhdGVCaW5kKClcbiAgICB9LFxuICAgIGNyZWF0ZVNjZW5lOiBmdW5jdGlvbihlLCB0LCBzLCBvLCBuKSB7XG4gICAgICAgIHZhciBlID0gbmV3IFNjcm9sbE1hZ2ljLlNjZW5lKHtcbiAgICAgICAgICAgIHRyaWdnZXJFbGVtZW50OiBcIiNcIiArIG4sXG4gICAgICAgICAgICB0cmlnZ2VySG9vazogXCJvbkxlYXZlXCIsXG4gICAgICAgICAgICBvZmZzZXQ6IHQsXG4gICAgICAgICAgICBkdXJhdGlvbjogcyxcbiAgICAgICAgICAgIHJldmVyc2U6ICEwXG4gICAgICAgIH0pLnNldFR3ZWVuKG8pLmFkZFRvKHRoaXMuY29udHJvbGxlcik7XG4gICAgICAgIGUuaW5kaWNhdG9yID0gbiwgZS5jaCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG4pLmNsaWVudEhlaWdodCwgZS5pZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG4pLCBlLmluZGV4ID0gaSwgdGhpcy5zY2VuZXMucHVzaChlKVxuICAgIH0sXG4gICAgdXBkYXRlRml4ZWRWYWx1ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgIFxuICAgICAgICAgICAgICAgIGZvcih0aGlzLnNjZW5lc1swXS5kdXJhdGlvbihkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0b3J5MVwiKS5jbGllbnRIZWlnaHQtd2luZG93LmlubmVySGVpZ2h0KSxcbiAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZXNbMV0ub2Zmc2V0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodC80KSxcbiAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmVzWzFdLmR1cmF0aW9uKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RvcnkxXCIpLmNsaWVudEhlaWdodC0xLjI1KndpbmRvdy5pbm5lckhlaWdodCksXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmVzWzJdLmR1cmF0aW9uKDIqZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzMV90ZXh0MlwiKS5jbGllbnRIZWlnaHQpLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lc1szXS5vZmZzZXQoLTEgKiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdG9yeTFcIikuY2xpZW50SGVpZ2h0ICkpLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lc1s0XS5vZmZzZXQoLTEgKiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdG9yeTZcIikuY2xpZW50SGVpZ2h0LTEuMjUqd2luZG93LmlubmVySGVpZ2h0KSksXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmVzWzRdLmR1cmF0aW9uKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiczFfdGV4dDJcIikuY2xpZW50SGVpZ2h0KSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZXNbNV0ub2Zmc2V0KC0xICogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3Rvcnk2XCIpLmNsaWVudEhlaWdodCApKSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZXNbNl0ub2Zmc2V0KC0xICogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3Rvcnk2XCIpLmNsaWVudEhlaWdodCApKSxcbiAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmVzWzZdLmR1cmF0aW9uKDEuNSAqIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3Rvcnk2XCIpLmNsaWVudEhlaWdodCksXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZXNbN10ub2Zmc2V0KC0xICogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3Rvcnk3XCIpLmNsaWVudEhlaWdodCApKSwgaSA9IDA7IGkgPCB0aGlzLnNjZW5lcy5sZW5ndGg7IGkrKykgdGhpcy5zY2VuZXNbaV0ucmVmcmVzaCgpLCB0aGlzLnNjZW5lc1tpXS51cGRhdGUoITApXG4gICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQmluZCgpO1xuICAgIH1cbn0sIGNhc3RuY3Jld1ZpZXcgPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5kaXNwYXRjaGVyID0gdm9pZCAwICE9PSBlID8gZSA6IG5ldyBEaXNwYXRjaGVyLCB0aGlzLmRldmljZSA9IERldGVjdGl6ci5kZXZpY2UudHlwZSwgdGhpcy5jb250cm9sbGVyID0gbmV3IFNjcm9sbE1hZ2ljLkNvbnRyb2xsZXIsIHRoaXMubGFiZWwsIHRoaXMuc3BsaXQgPSAhMCwgdGhpcy5zZWN0aW9ucyA9IFtdLCB0aGlzLnNjZW5lcyA9IFtdLCB0aGlzLmJvZHlQb3MgPSAwXG59LCBjYXN0bmNyZXdWaWV3LnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogY2FzdG5jcmV3VmlldyxcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5iaW5kRXZlbnRzKClcbiAgICB9LFxuICAgIGJpbmRFdmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmNvbXBsZXRlRXZlbnQgPSB0aGlzLmRpc3BhdGNoZXIuYWRkRXZlbnRsaXN0ZW5lcihcIkFNX0NPTVBMRVRFX0dcIiwgdGhpcy5wb3B1bGF0ZS5iaW5kKHRoaXMpKVxuICAgIH0sXG4gICAgcG9wdWxhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoXCJkZXNrdG9wXCIgPT09IHRoaXMuZGV2aWNlIHx8IFwidGFibGV0XCIgPT09IHRoaXMuZGV2aWNlKVxuICAgICAgICAgICAgZm9yICgkKFwiI2Nhc3RuY3Jldy1oZWFkZXJcIikuaHRtbCgnPGRpdiBjbGFzcz1cImNvdmVyXCI+PGltZyBzcmM9XCInICsgXG4gICAgICAgICAgICAgICAgZGF0YS5jYXN0bmNyZXcuaGVhZGVyLmRlc2t0b3BCYWNrZ3JvdW5kSW1hZ2UgK1xuICAgICAgICAgICAgICAgICAnXCIgY2xhc3M9XCJjb3ZlclwiIC8+PGgxIGlkPVwiY2FzdG5jcmV3LWhlYWRlci10ZXh0XCI+JyArIFxuICAgICAgICAgICAgICAgICBkYXRhLmNhc3RuY3Jldy5oZWFkZXIudGV4dCArICc8L2gxPjxpbWcgc3JjPVwiJyArIFxuICAgICAgICAgICAgICAgICBkYXRhLmNhc3RuY3Jldy5oZWFkZXIuZGVza3RvcEZvcmVncm91bmRJbWFnZSArICdcIiBjbGFzcz1cImNvdmVyXCIgLz48L2Rpdj4nKSwgaSA9IDA7IGkgPCBkYXRhLmNhc3RuY3Jldy5saXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgICAgIHRoaXMuc2VjdGlvbnMucHVzaChcImNuY19cIiArIGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0ubGFiZWwpLCBcImhhbGZcIiA9PSBkYXRhLmNhc3RuY3Jldy5saXN0W2ldLnR5cGUgPyAodGhpcy5zcGxpdCAmJiAkKFwiI2Nhc3RuY3Jldy1saXN0XCIpLmFwcGVuZCgnPGxpIGNsYXNzPVwiY25jX3NwbGl0XCI+PC9saT4nKSxcbiAgICAgICAgICAgICAgICB0aGlzLnNwbGl0ID0gITEsICQoXCIuY25jX3NwbGl0XCIpLmFwcGVuZCgnPGRpdiBpZD1cImNuY18nICsgZGF0YS5jYXN0bmNyZXcubGlzdFtpXS5sYWJlbCArICdcIiBjbGFzcz1cImNuY18nICsgZGF0YS5jYXN0bmNyZXcubGlzdFtpXS50eXBlICsgJ1wiPjxkaXYgY2xhc3M9XCJjb3ZlciBjbmNfY292ZXJcIj48aW1nIHNyYz1cIicgKyBcbiAgICAgICAgICAgICAgICAgICAgYXBwLnByZWxvYWRlci5nZXRBc3NldChkYXRhLmNhc3RuY3Jldy5saXN0W2ldLmRlc2t0b3BJbWFnZSkuc3JjICsgJ1wiIGNsYXNzPVwiY292ZXJcIiAvPjwvZGl2PjxkaXYgY2xhc3M9XCJjbmNfdGV4dF9jb250YWluZXJcIj48ZGl2IGNsYXNzPVwiY25jX3RleHRcIj48aDEgY2xhc3M9XCJjbmNfYWN0b3JcIj4nICsgXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0ubmFtZSArICc8L2gxPjxoMSBjbGFzcz1cImNuY19jaGFyYWN0ZXJcIj4nICsgXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0ucm9sZSArICc8L2gxPjxkaXYgY2xhc3M9XCJjbmNfYnRuIGJ0bl9zY3JvbGxcIiBkYXRhLWJpbz1cIicgKyBcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jYXN0bmNyZXcubGlzdFtpXS5sYWJlbCArICdcIj48ZGl2IGNsYXNzPVwiYnRuX3Njcm9sbF9vdXRlclwiPjxkaXYgY2xhc3M9XCJidG5fc2Nyb2xsX21pZGRsZVwiPjxkaXYgY2xhc3M9XCJidG5fc2Nyb2xsX2lubmVyXCI+PC9kaXY+PC9kaXY+IDwvZGl2PjxoMSBjbGFzcz1cImJ0bl9zY3JvbGxfdGV4dFwiPkJpbzwvaDE+PC9kaXY+PC9kaXY+JykpIDogXG4gICAgICAgICAgICAgICAgICAgICQoXCIjY2FzdG5jcmV3LWxpc3RcIikuYXBwZW5kKCc8bGkgaWQ9XCJjbmNfJyArIGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0ubGFiZWwgKyAnXCI+PGRpdiBjbGFzcz1cImNvdmVyIGNuY19jb3ZlclwiPjxpbWcgc3JjPVwiJyArIFxuICAgICAgICAgICAgICAgICAgICBhcHAucHJlbG9hZGVyLmdldEFzc2V0KGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0uZGVza3RvcEltYWdlKS5zcmMgKyAnXCIgY2xhc3M9XCJjb3ZlclwiIC8+PC9kaXY+PGRpdiBjbGFzcz1cImNuY190ZXh0X2NvbnRhaW5lclwiPjxkaXYgY2xhc3M9XCJjbmNfdGV4dFwiPjxoMSBjbGFzcz1cImNuY19hY3RvclwiPicgKyBcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jYXN0bmNyZXcubGlzdFtpXS5uYW1lICsgJzwvaDE+PHA+aXM8L3A+PGgxIGNsYXNzPVwiY25jX2NoYXJhY3RlclwiPicgKyBcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jYXN0bmNyZXcubGlzdFtpXS5yb2xlICsgJzwvaDE+PGRpdiBjbGFzcz1cImNuY19idG4gYnRuX3Njcm9sbFwiIGRhdGEtYmlvPVwiJyArIFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNhc3RuY3Jldy5saXN0W2ldLmxhYmVsICsgJ1wiPjxkaXYgY2xhc3M9XCJidG5fc2Nyb2xsX291dGVyXCI+PGRpdiBjbGFzcz1cImJ0bl9zY3JvbGxfbWlkZGxlXCI+PGRpdiBjbGFzcz1cImJ0bl9zY3JvbGxfaW5uZXJcIj48L2Rpdj48L2Rpdj48L2Rpdj48aDEgY2xhc3M9XCJidG5fc2Nyb2xsX3RleHRcIj5CaW88L2gxPjwvZGl2PjwvZGl2PjwvZGl2PjwvbGk+Jyk7XG4gICAgICAgIFxuICAgICAgICBlbHNlIGlmIChcIm1vYmlsZVwiID09PSB0aGlzLmRldmljZSlcbiAgICAgICAgICAgIGZvciAoJChcIiNjYXN0bmNyZXctaGVhZGVyXCIpLmh0bWwoJzxkaXYgY2xhc3M9XCJjb3ZlclwiPjxpbWcgc3JjPVwiJyArIFxuICAgICAgICAgICAgZGF0YS5jYXN0bmNyZXcuaGVhZGVyLm1vYmlsZUJhY2tncm91bmRJbWFnZSArICdcIiBjbGFzcz1cImNvdmVyXCIgLz48aDEgaWQ9XCJjYXN0bmNyZXctaGVhZGVyLXRleHRcIj4nICtcbiAgICAgICAgICAgIGRhdGEuY2FzdG5jcmV3LmhlYWRlci50ZXh0ICsgJzwvaDE+PGltZyBzcmM9XCInICsgZGF0YS5jYXN0bmNyZXcuaGVhZGVyLm1vYmlsZUZvcmVncm91bmRJbWFnZSArICdcIiBjbGFzcz1cImNvdmVyXCIgLz48L2Rpdj4nKSwgaSA9IDA7IGkgPCBkYXRhLmNhc3RuY3Jldy5saXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgdGhpcy5zZWN0aW9ucy5wdXNoKFwiY25jX1wiICsgZGF0YS5jYXN0bmNyZXcubGlzdFtpXS5sYWJlbCksIFwiaGFsZlwiID09IGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0udHlwZSA/ICQoXCIjY2FzdG5jcmV3LWxpc3RcIikuYXBwZW5kKCc8bGkgaWQ9XCJjbmNfJyArIGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0ubGFiZWwgKyAnXCI+PGRpdiBjbGFzcz1cImNvdmVyXCI+PGltZyBzcmM9XCInICsgXG4gICAgICAgICAgICAgICAgYXBwLnByZWxvYWRlci5nZXRBc3NldChkYXRhLmNhc3RuY3Jldy5saXN0W2ldLm1vYmlsZUltYWdlKS5zcmMgKyAnXCIgY2xhc3M9XCJjb3ZlclwiIC8+PC9kaXY+PGRpdiBjbGFzcz1cImNuY190ZXh0X2NvbnRhaW5lclwiPjxkaXYgY2xhc3M9XCJjbmNfdGV4dFwiPjxoMSBjbGFzcz1cImNuY19hY3RvclwiPicgKyBcbiAgICAgICAgICAgICAgICBkYXRhLmNhc3RuY3Jldy5saXN0W2ldLm5hbWUgKyAnPC9oMT48L2JyPjwvYnI+IDxoMSBjbGFzcz1cImNuY19jaGFyYWN0ZXJcIj4nICsgZGF0YS5jYXN0bmNyZXcubGlzdFtpXS5yb2xlICsgXG4gICAgICAgICAgICAgICAgJzwvaDE+PGRpdiBjbGFzcz1cImNuY19idG5cIiBkYXRhLWJpbz1cIicgKyBkYXRhLmNhc3RuY3Jldy5saXN0W2ldLmxhYmVsICsgJ1wiPjxpbWcgc3JjPVwiaW1nL2J0bl9iaW8ucG5nXCI+PC9kaXY+PC9kaXY+PC9kaXY+PC9saT4nKSA6IFxuICAgICAgICAgICAgICAgICQoXCIjY2FzdG5jcmV3LWxpc3RcIikuYXBwZW5kKCc8bGkgaWQ9XCJjbmNfJyArIGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0ubGFiZWwgKyAnXCI+PGRpdiBjbGFzcz1cImNvdmVyXCI+PGltZyBzcmM9XCInICsgXG4gICAgICAgICAgICAgICAgYXBwLnByZWxvYWRlci5nZXRBc3NldChkYXRhLmNhc3RuY3Jldy5saXN0W2ldLm1vYmlsZUltYWdlKS5zcmMgKyAnXCIgY2xhc3M9XCJjb3ZlclwiIC8+PC9kaXY+PGRpdiBjbGFzcz1cImNuY190ZXh0X2NvbnRhaW5lclwiPjxkaXYgY2xhc3M9XCJjbmNfdGV4dFwiPjxoMSBjbGFzcz1cImNuY19hY3RvclwiPicgKyBcbiAgICAgICAgICAgICAgICBkYXRhLmNhc3RuY3Jldy5saXN0W2ldLm5hbWUgKyAnPC9oMT48cD5pczwvcD48aDEgY2xhc3M9XCJjbmNfY2hhcmFjdGVyXCI+JyArIFxuICAgICAgICAgICAgICAgIGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0ucm9sZSArICc8L2gxPjxkaXYgY2xhc3M9XCJjbmNfYnRuXCIgZGF0YS1iaW89XCInICsgXG4gICAgICAgICAgICAgICAgZGF0YS5jYXN0bmNyZXcubGlzdFtpXS5sYWJlbCArICdcIj48aW1nIHNyYz1cImltZy9idG5fYmlvLnBuZ1wiPjwvZGl2PjwvZGl2PjwvZGl2PjwvbGk+Jyk7XG5cbiAgICAgICAgJChcIiNjbmNfY2xvc2VcIikubW91c2VlbnRlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFR3ZWVuTWF4LnNldCgkKHRoaXMpLmZpbmQoXCIuY2xvc2Utb3V0ZXJcIiksIHtcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1PcmlnaW46IFwiNTAlIDUwJVwiXG4gICAgICAgICAgICB9KSwgVHdlZW5NYXguc2V0KCQodGhpcykuZmluZChcIi5jbG9zZS1pbm5lclwiKSwge1xuICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogXCI1MCUgNTAlXCJcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC5zZXQoJCh0aGlzKS5maW5kKFwiLmNsb3NlLWltZ1wiKSwge1xuICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogXCI1MCUgNTAlXCJcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuY2xvc2Utb3V0ZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgIHNjYWxlOiAxLjIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuY2xvc2UtaW5uZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgIHNjYWxlOiAxLjE1LFxuICAgICAgICAgICAgICAgIGJvcmRlcjogXCIxcHggc29saWQgcmdiYSgyNTUsIDI1NCwgMjM3LCAwLjc1KVwiLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiLmNsb3NlLWltZ1wiKSwgLjQsIHtcbiAgICAgICAgICAgICAgICByb3RhdGlvbjogOTAsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIzLmVhc2VPdXRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLm1vdXNlbGVhdmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuY2xvc2Utb3V0ZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgIHNjYWxlOiAxLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiLmNsb3NlLWlubmVyXCIpLCAuMjUsIHtcbiAgICAgICAgICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgICAgICAgICBib3JkZXI6IFwiMXB4IHNvbGlkIHJnYmEoMjU1LCAyNTQsIDIzNywgMC4yKVwiLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiLmNsb3NlLWltZ1wiKSwgLjQsIHtcbiAgICAgICAgICAgICAgICByb3RhdGlvbjogMCxcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSksICQoXCIuY25jX2J0blwiKS5jbGljayh0aGlzLnNob3cpLCAkKFwiI2NuY19jbG9zZVwiKS5jbGljayh0aGlzLmhpZGUpLCAkKFwiLmJ0bl9zY3JvbGxcIikubW91c2VlbnRlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFR3ZWVuTWF4LnRvKCQodGhpcykucGFyZW50cyhcImxpXCIpLmZpbmQoXCIuY25jX2NvdmVyXCIpLCAuNTUsIHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAuNSxcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5idG5fc2Nyb2xsX291dGVyXCIpLCAuMzUsIHtcbiAgICAgICAgICAgICAgICBzY2FsZTogMS4xLFxuICAgICAgICAgICAgICAgIGRlbGF5OiAuMDUsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIyLmVhc2VJbk91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5idG5fc2Nyb2xsX21pZGRsZVwiKSwgLjI1LCB7XG4gICAgICAgICAgICAgICAgc2NhbGU6IDEuMDUsXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogLjksXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIyLmVhc2VJbk91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5idG5fc2Nyb2xsX2lubmVyXCIpLCAuMjUsIHtcbiAgICAgICAgICAgICAgICBzY2FsZTogMS4xLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMi5lYXNlSW5PdXRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLm1vdXNlbGVhdmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBUd2Vlbk1heC50bygkKHRoaXMpLnBhcmVudHMoXCJsaVwiKS5maW5kKFwiLmNuY19jb3ZlclwiKSwgLjU1LCB7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi5idG5fc2Nyb2xsX291dGVyXCIpLCAuNSwge1xuICAgICAgICAgICAgICAgIHNjYWxlOiAxLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMi5lYXNlSW5PdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIuYnRuX3Njcm9sbF9taWRkbGVcIiksIC4zNSwge1xuICAgICAgICAgICAgICAgIHNjYWxlOiAxLFxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IC43NSxcbiAgICAgICAgICAgICAgICBkZWxheTogLjEsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXIyLmVhc2VJbk91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIiNidG5fc2Nyb2xsX2lubmVyXCIpLCAuMzUsIHtcbiAgICAgICAgICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgICAgICAgICBkZWxheTogLjE1LFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyMi5lYXNlSW5PdXRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLCB0aGlzLmNyZWF0ZVNjZW5lKFwiY25jX3RvbWNydWlzZVwiLCAyKSwgdGhpcy5jcmVhdGVTY2VuZShcImNuY19kb21oYWxsZ2xlZXNvblwiLCAxKSwgdGhpcy5jcmVhdGVTY2VuZShcImNuY19zYXJhaHdyaWdodFwiLCAxKSwgdGhpcy5jcmVhdGVTY2VuZShcImNuY19kb3VnbGltYW5cIiwgMSksIHRoaXMuY3JlYXRlU2NlbmUoXCJjbmNfZ2FyeXNwaW5lbGxpXCIsIDEpXG4gICAgfSxcbiAgICBjcmVhdGVTY2VuZTogZnVuY3Rpb24oZSwgdCkge1xuICAgICAgICB2YXIgZSA9IG5ldyBTY3JvbGxNYWdpYy5TY2VuZSh7XG4gICAgICAgICAgICB0cmlnZ2VyRWxlbWVudDogXCIjXCIgKyBlLFxuICAgICAgICAgICAgdHJpZ2dlckhvb2s6IFwib25MZWF2ZVwiLFxuICAgICAgICAgICAgb2Zmc2V0OiAtMSAqIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGUpLmNsaWVudEhlaWdodCAvIHQsXG4gICAgICAgICAgICBkdXJhdGlvbjogMyAqIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGUpLmNsaWVudEhlaWdodCxcbiAgICAgICAgICAgIHJldmVyc2U6ICEwXG4gICAgICAgIH0pLnNldFR3ZWVuKFR3ZWVuTWF4LmZyb21UbygkKFwiI1wiICsgZSkuZmluZChcIi5jbmNfY292ZXIgaW1nXCIpLCAxLCB7XG4gICAgICAgICAgICB0cmFuc2Zvcm06IFwidHJhbnNsYXRlWSgtNTBweClcIlxuICAgICAgICB9LCB7XG4gICAgICAgICAgICB0cmFuc2Zvcm06IFwidHJhbnNsYXRlWSg1MHB4KVwiXG4gICAgICAgIH0pKS5hZGRUbyh0aGlzLmNvbnRyb2xsZXIpO1xuICAgICAgICBlLmluZGljYXRvciA9IGUsIGUuaW5kZXggPSBpLCB0aGlzLnNjZW5lcy5wdXNoKGUpXG4gICAgfSxcbiAgICBzaG93OiBmdW5jdGlvbigpIHtcbiAgICBcblxuICAgICAgICAgICAgICAgIFxuICAgICAgICBmb3IgKCQoXCJib2R5XCIpLmFkZENsYXNzKFwibm9zY3JvbGxcIiksIFwiZGVza3RvcFwiICE9PSB0aGlzLmRldmljZSAmJiAoYXBwLmJvZHlQb3MgPSAkKFwiYm9keVwiKS5zY3JvbGxUb3AoKSksXG5cbiAgICAgICAgdGhpcy5sYWJlbCA9ICQodGhpcykuZGF0YShcImJpb1wiKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjbmNfY29udGFpbmVyXCIpLnNjcm9sbFRvcCA9IDAsIGkgPSAwOyBpIDwgZGF0YS5jYXN0bmNyZXcubGlzdC5sZW5ndGg7IGkrKykgXG4gICAgICAgIHRoaXMubGFiZWwgPT0gZGF0YS5jYXN0bmNyZXcubGlzdFtpXS5sYWJlbCAmJiAoJChcIiNjbmNfaGVhZGVyIGgxXCIpLmh0bWwoZGF0YS5jYXN0bmNyZXcubGlzdFtpXS5uYW1lKSxcbiAgICAgICAgJChcIiNjbmNfdGV4dFwiKS5odG1sKFwiPHA+XCIgKyBkYXRhLmNhc3RuY3Jldy5saXN0W2ldLnRleHQgICsgXCI8L3A+XCIpLFxuXG4gICBcbiAgICAgICAgJChcIiNjbmNfaW1hZ2UxXCIpLmF0dHIoXCJzcmNcIiwgYXBwLnByZWxvYWRlci5nZXRBc3NldChkYXRhLmNhc3RuY3Jldy5saXN0W2ldLnZpZGVvKS5zcmMgKSxcblxuICAgICAgICAkKFwiI2NuY19jaGFyXCIpLmNzcyhcImJhY2tncm91bmQtaW1hZ2VcIiwgXCJ1cmwoXCIgKyBhcHAucHJlbG9hZGVyLmdldEFzc2V0KGRhdGEuY2FzdG5jcmV3Lmxpc3RbaV0ub3ZlcmxheUltYWdlKS5zcmMgKyBcIilcIikpIDtcblxuICAgICAgICBUd2Vlbk1heC5zZXQoJChcIiNjbmNfb3ZlcmxheVwiKSwge1xuICAgICAgICAgICAgdmlzaWJpbGl0eTogXCJ2aXNpYmxlXCIsXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcyhcIm5vc2Nyb2xsXCIpXG4gICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgfSksIFR3ZWVuTWF4LmZyb21UbygkKFwiI2NuY19vdmVybGF5XCIpLCAuNzUsIHtcbiAgICAgICAgICAgIGxlZnQ6IFwiLTEwMHZ3XCJcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgbGVmdDogXCIwdndcIixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMy5lYXNlT3V0XG4gICAgICAgIH0pLCBUd2Vlbk1heC5mcm9tVG8oJChcIiNjbmNfY2hhclwiKSwgLjc1LCB7XG4gICAgICAgICAgICBsZWZ0OiBcIi02MCVcIlxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBsZWZ0OiBcIjAlXCIsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjIuZWFzZU91dFxuICAgICAgICB9KVxuICAgIH0sXG4gICAgaGlkZTogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgJChcImJvZHlcIikucmVtb3ZlQ2xhc3MoXCJub3Njcm9sbFwiKSwgXCJkZXNrdG9wXCIgIT09IHRoaXMuZGV2aWNlICYmICQoXCJib2R5XCIpLnNjcm9sbFRvcChhcHAuYm9keVBvcyksIFR3ZWVuTWF4LmZyb21UbygkKFwiI2NuY19jaGFyXCIpLCAuNzUsIHtcbiAgICAgICAgICAgIGxlZnQ6IFwiMCVcIlxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBsZWZ0OiBcIi02MCVcIixcbiAgICAgICAgICAgIGVhc2U6IFBvd2VyMi5lYXNlT3V0XG4gICAgICAgIH0pLCBUd2Vlbk1heC5mcm9tVG8oJChcIiNjbmNfb3ZlcmxheVwiKSwgLjc1LCB7XG4gICAgICAgICAgICBsZWZ0OiBcIjB2d1wiXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGxlZnQ6IFwiLTEwMHZ3XCIsXG4gICAgICAgICAgICBlYXNlOiBQb3dlcjMuZWFzZU91dCxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQoXCJib2R5XCIpLnJlbW92ZUNsYXNzKFwibm9zY3JvbGxcIiksIFR3ZWVuTWF4LnNldCgkKFwiI2NuY19vdmVybGF5XCIpLCB7XG4gICAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IFwiaGlkZGVuXCJcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgIH0pXG4gICAgfVxufSwgZ2FsbGVyeVZpZXcgPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5kaXNwYXRjaGVyID0gdm9pZCAwICE9PSBlID8gZSA6IG5ldyBEaXNwYXRjaGVyLCB0aGlzLmRldmljZSA9IERldGVjdGl6ci5kZXZpY2UudHlwZVxufSwgZ2FsbGVyeVZpZXcucHJvdG90eXBlID0ge1xuICAgIGNvbnN0cnVjdG9yOiBnYWxsZXJ5VmlldyxcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5iaW5kRXZlbnRzKClcbiAgICB9LFxuICAgIHBvcHVsYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIFxuICAgIH0sXG4gICAgYmluZEV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuY29tcGxldGVFdmVudCA9IHRoaXMuZGlzcGF0Y2hlci5hZGRFdmVudGxpc3RlbmVyKFwiQU1fQ09NUExFVEVfR1wiLCB0aGlzLnBvcHVsYXRlLmJpbmQodGhpcykpXG4gICAgfVxufSwgdmlkZW9zVmlldyA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLmRpc3BhdGNoZXIgPSB2b2lkIDAgIT09IGUgPyBlIDogbmV3IERpc3BhdGNoZXIsIHRoaXMuZGV2aWNlID0gRGV0ZWN0aXpyLmRldmljZS50eXBlXG59LCB2aWRlb3NWaWV3LnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogdmlkZW9zVmlldyxcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5iaW5kRXZlbnRzKClcbiAgICB9LFxuICAgIHBvcHVsYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKFwibW9iaWxlXCIgPT0gdGhpcy5kZXZpY2UpXG4gICAgICAgICAgICBmb3IgKCQoXCIjdmlkZW9zX2JnIGltZ1wiKS5hdHRyKFwic3JjXCIsIFwiaW1nL3ZpZGVvc19tb2JpbGVfYmcuanBnXCIpLCBpID0gMDsgaSA8IGRhdGEudmlkZW9zLmxpc3QubGVuZ3RoOyBpKyspIGRhdGEudmlkZW9zLmxpc3RbaV0uc2hvdyAmJiAkKFwiI3ZpZGVvcy1saXN0XCIpLmFwcGVuZCgnPGxpIGNsYXNzPVwidmlkZW9fYWN0aXZlXCI+PGRpdiBjbGFzcz1cInZpZGVvX2JvcmRlclwiPjwvZGl2PjxkaXYgY2xhc3M9XCJ2aWRlb19sYWJlbFwiPjxoMT4nICsgZGF0YS52aWRlb3MubGlzdFtpXS5uYW1lICsgJzwvaDE+PC9kaXY+PGltZyBjbGFzcz1cInZpZGVvX2J0bl9vdXRcIiBzcmM9XCJpbWcvYXJyb3dfdHJhaWxlcl9vdXQuc3ZnXCIgLz48ZGl2IGNsYXNzPVwidmlkZW9fYnRuX292ZXJcIj48aW1nIGNsYXNzPVwidmlkZW9fYXJyb3dcIiBzcmM9XCJpbWcvYXJyb3dfdHJhaWxlcl9vdmVyLnN2Z1wiIC8+PC9kaXY+PGltZyBjbGFzcz1cInZpZGVvX3Bvc3RlclwiIHNyYz1cIicgKyBkYXRhLnZpZGVvcy5saXN0W2ldLnBvc3RlciArICdcIiAvPjwvbGk+Jyk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBkYXRhLnZpZGVvcy5saXN0Lmxlbmd0aDsgaSsrKSBkYXRhLnZpZGVvcy5saXN0W2ldLnNob3cgPyAkKFwiI3ZpZGVvcy1saXN0XCIpLmFwcGVuZCgnPGxpIGNsYXNzPVwidmlkZW9fYWN0aXZlXCI+PGRpdiBjbGFzcz1cInZpZGVvX2JvcmRlclwiPjwvZGl2PjxkaXYgY2xhc3M9XCJ2aWRlb19sYWJlbFwiPjxoMT4nICsgZGF0YS52aWRlb3MubGlzdFtpXS5uYW1lICsgJzwvaDE+PC9kaXY+PGltZyBjbGFzcz1cInZpZGVvX2J0bl9vdXRcIiBzcmM9XCJpbWcvYXJyb3dfdHJhaWxlcl9vdXQuc3ZnXCIgLz48ZGl2IGNsYXNzPVwidmlkZW9fYnRuX292ZXJcIj48aW1nIGNsYXNzPVwidmlkZW9fYXJyb3dcIiBzcmM9XCJpbWcvYXJyb3dfdHJhaWxlcl9vdmVyLnN2Z1wiIC8+PC9kaXY+PHZpZGVvIGNsYXNzPVwidmlkZW9fdmlkZW9cIiBsb29wIG11dGVkIHBvc3Rlcj1cIicgKyBkYXRhLnZpZGVvcy5saXN0W2ldLnBvc3RlciArICdcIj48c291cmNlIHNyYz1cIicgKyBkYXRhLnZpZGVvcy5saXN0W2ldLnZpZGVvICsgJ1wiIHR5cGU9XCJ2aWRlby9tcDRcIj48L3ZpZGVvPjwvbGk+JykgOiAkKFwiI3ZpZGVvcy1saXN0XCIpLmFwcGVuZCgnPGxpIGNsYXNzPVwidmlkZW9faGlkZGVuXCI+PGRpdj48L2Rpdj48L2xpPicpO1xuICAgICAgICB0aGlzLmF0dGFjaEV2ZW50TGlzdGVuZXJzKClcbiAgICB9LFxuICAgIGJpbmRFdmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmNvbXBsZXRlRXZlbnQgPSB0aGlzLmRpc3BhdGNoZXIuYWRkRXZlbnRsaXN0ZW5lcihcIkFNX0NPTVBMRVRFX0dcIiwgdGhpcy5wb3B1bGF0ZS5iaW5kKHRoaXMpKVxuICAgIH0sXG4gICAgYXR0YWNoRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAkKFwiI3ZpZGVvcy1saXN0IGxpXCIpLm1vdXNlZW50ZXIoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgJCh0aGlzKS5oYXNDbGFzcyhcInZpZGVvX2hpZGRlblwiKSA9PT0gITEgJiYgJCh0aGlzKS5maW5kKFwiLnZpZGVvX3ZpZGVvXCIpLmdldCgwKS5wbGF5KCksIFR3ZWVuTWF4LnNldCgkKHRoaXMpLmZpbmQoXCIudmlkZW9fYnRuX292ZXJcIiksIHtcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1PcmlnbjogXCI1MCUgNTAlXCJcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIudmlkZW9fYm9yZGVyXCIpLCAuMjUsIHtcbiAgICAgICAgICAgICAgICBcImJvcmRlci13aWR0aFwiOiBcIjhweFwiLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyNC5lYXNlT3V0XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiLnZpZGVvX2J0bl9vdmVyXCIpLCAuMTUsIHtcbiAgICAgICAgICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgICAgICAgICBlYXNlOiBQb3dlcjQuZWFzZU91dFxuICAgICAgICAgICAgfSksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi52aWRlb19idG5fb3ZlciBpbWdcIiksIC4xNSwge1xuICAgICAgICAgICAgICAgIHg6IDM0LFxuICAgICAgICAgICAgICAgIGRlbGF5OiAuMTUsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXI0LmVhc2VPdXRcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLm1vdXNlbGVhdmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmhhc0NsYXNzKFwidmlkZW9faGlkZGVuXCIpID09PSAhMSAmJiAkKHRoaXMpLmZpbmQoXCIudmlkZW9fdmlkZW9cIikuZ2V0KDApLnBhdXNlKCksIFR3ZWVuTWF4LnRvKCQodGhpcykuZmluZChcIi52aWRlb19ib3JkZXJcIiksIC4yNSwge1xuICAgICAgICAgICAgICAgIFwiYm9yZGVyLXdpZHRoXCI6IFwiNXB4XCIsXG4gICAgICAgICAgICAgICAgZWFzZTogUG93ZXI0LmVhc2VPdXRcbiAgICAgICAgICAgIH0pLCBUd2Vlbk1heC50bygkKHRoaXMpLmZpbmQoXCIudmlkZW9fYnRuX292ZXIgaW1nXCIpLCAuMTUsIHtcbiAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyNC5lYXNlT3V0XG4gICAgICAgICAgICB9KSwgVHdlZW5NYXgudG8oJCh0aGlzKS5maW5kKFwiLnZpZGVvX2J0bl9vdmVyXCIpLCAuMTUsIHtcbiAgICAgICAgICAgICAgICBzY2FsZTogMCxcbiAgICAgICAgICAgICAgICBkZWxheTogLjE1LFxuICAgICAgICAgICAgICAgIGVhc2U6IFBvd2VyNC5lYXNlT3V0XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KSwgJChcIiN2aWRlb3MtbGlzdCBsaS52aWRlb19hY3RpdmVcIikuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlkZW9zLWxpc3RcIikuY2hpbGRyZW4pLFxuICAgICAgICAgICAgICAgIHQgPSBlLmluZGV4T2YodGhpcyk7XG4gICAgICAgICAgICBzd2l0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKDApLCBhcHAuZGlzcGF0Y2hlci5kaXNwYXRjaChcIkNVRV9QTEFZTElTVF9JTkRFWFwiLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygxKSwgYXBwLmRpc3BhdGNoZXIuZGlzcGF0Y2goXCJDVUVfUExBWUxJU1RfSU5ERVhcIiwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coMiksIGFwcC5kaXNwYXRjaGVyLmRpc3BhdGNoKFwiQ1VFX1BMQVlMSVNUX0lOREVYXCIsIDIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKDMpLCBhcHAuZGlzcGF0Y2hlci5kaXNwYXRjaChcIkNVRV9QTEFZTElTVF9JTkRFWFwiLCA1KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyg0KSwgYXBwLmRpc3BhdGNoZXIuZGlzcGF0Y2goXCJDVUVfUExBWUxJU1RfSU5ERVhcIiwgNik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coNSksIGFwcC5kaXNwYXRjaGVyLmRpc3BhdGNoKFwiQ1VFX1BMQVlMSVNUX0lOREVYXCIsIDExKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXBwLmRpc3BhdGNoZXIuZGlzcGF0Y2goXCJTSE9XX1RSQUlMRVJcIilcbiAgICAgICAgfSlcbiAgICB9XG59LCB0aWNrZXRzVmlldyA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLmRpc3BhdGNoZXIgPSB2b2lkIDAgIT09IGUgPyBlIDogbmV3IERpc3BhdGNoZXIsIHRoaXMuZGV2aWNlID0gRGV0ZWN0aXpyLmRldmljZS50eXBlXG59LCB0aWNrZXRzVmlldy5wcm90b3R5cGUgPSB7XG4gICAgY29uc3RydWN0b3I6IHRpY2tldHNWaWV3LFxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmJpbmRFdmVudHMoKVxuICAgIH0sXG4gICAgcG9wdWxhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgXG4gICAgfSxcbiAgICBiaW5kRXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5jb21wbGV0ZUV2ZW50ID0gdGhpcy5kaXNwYXRjaGVyLmFkZEV2ZW50bGlzdGVuZXIoXCJBTV9DT01QTEVURV9HXCIsIHRoaXMucG9wdWxhdGUuYmluZCh0aGlzKSlcbiAgICB9XG59OyJdLCJmaWxlIjoidmlld3MubWluLmpzIn0=
